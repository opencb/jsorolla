/*
 * Copyright (c) 2012 Francisco Salavert (ICM-CIPF)
 * Copyright (c) 2012 Ruben Sanchez (ICM-CIPF)
 * Copyright (c) 2012 Ignacio Medina (ICM-CIPF)
 *
 * This file is part of JS Common Libs.
 *
 * JS Common Libs is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * JS Common Libs is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with JS Common Libs. If not, see <http://www.gnu.org/licenses/>.
 */

function InfoWidget(a,b,c){this.id="InfoWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.species=b;this.featureId=this.title=null;this.width=800;this.height=400;null!=a&&(this.targetId=a);null!=c&&(null!=c.title&&(this.title=c.title),null!=c.width&&(this.width=c.width),null!=c.height&&(this.height=c.height));switch(b){case "hsa":this.ensemblSpecie="Homo_sapiens";this.reactomeSpecie="48887";this.wikipathwaysSpecie="Homo+sapiens";this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=
this.omimSpecie="";break;case "mmu":this.ensemblSpecies="Mus_musculus";this.reactomeSpecies="48892";this.wikipathwaysSpecie="Mus+musculus";this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie="";break;case "dre":this.ensemblSpecie="Danio_rerio",this.reactomeSpecie="68323",this.wikipathwaysSpecie="Danio+rerio",this.haphapSpecie=this.dbsnpSpecie=this.intactSpecie=this.uniprotSpecie=this.omimSpecie=""}this.notFoundPanel=Ext.create("Ext.panel.Panel",{id:this.id+"notFoundPanel",
cls:"panel-border-left",border:!1,flex:3,bodyPadding:"40",html:"No results found"})}InfoWidget.prototype.draw=function(a){console.log(a);this.query=a.query;this.feature=a.feature;this.panel=Ext.getCmp(this.title+" "+this.query);null==this.panel?(this.render(),this.panel.show(),this.getData()):this.panel.show()};
InfoWidget.prototype.render=function(){this.panel=Ext.create("Ext.ux.Window",{title:this.title+" "+this.query,id:this.title+" "+this.query,minimizable:!0,constrain:!0,closable:!0,height:this.height,width:this.width,layout:{type:"hbox",align:"stretch"},items:[this.getTreePanel()],buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}})};
InfoWidget.prototype.getTreePanel=function(){var a=this.getdataTypes();this.checkDataTypes(a);a=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,text:"Options",children:a}});return Ext.create("Ext.tree.Panel",{title:"Detailed information",bodyPadding:10,flex:1,border:!1,store:a,useArrows:!0,rootVisible:!1,listeners:{scope:this,itemclick:function(a,c){this.optionClick(c.data)}}})};
InfoWidget.prototype.doGrid=function(a,b,c,d){for(var e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{[values.name]} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})',startCollapsed:!0}),f=[],g=0;g<b.length;g++)f.push({type:"string",dataIndex:b[g]});f={ftype:"filters",local:!0,filters:f};Ext.define(c,{extend:"Ext.data.Model",fields:b});b=Ext.create("Ext.data.Store",{groupField:d,model:c});return Ext.create("Ext.grid.Panel",{id:this.id+c,store:b,title:c,border:!1,cls:"panel-border-left",
flex:3,features:[e,f],viewConfig:{enableTextSelection:!0},columns:a,bbar:["->",{text:"Clear Grouping",handler:function(){e.disable()}}]})};InfoWidget.prototype.checkDataTypes=function(a){for(var b=0;b<a.length;b++)null!=a[b].children?(a[b].iconCls="icon-box",a[b].expanded=!0,this.checkDataTypes(a[b].children)):(a[b].iconCls="icon-blue-box",a[b].leaf=!0)};InfoWidget.prototype.getdataTypes=function(){return[]};InfoWidget.prototype.optionClick=function(){};InfoWidget.prototype.getData=function(){};
InfoWidget.prototype.getGeneTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{externalName}</span> &nbsp; <span class="emph s120"> {stableId} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Location/View?g={stableId}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',
"</p><br>",'<p><span class="w75 dis s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" dis s90">Strand: </span> {strand}</p>','<p><span class="w75 dis s90">Biotype: </span> {biotype}</p>','<p><span class="w75 dis s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></p>',"<br>",'<p><span class="w75 dis s90">Source: </span> <span class="s110">{source}</span></p>','<p><span class="w75 dis s90">External DB: </span> {externalDb}</p>',
'<p><span class="w75 dis s90">Status: </span> {status}</p>')};
InfoWidget.prototype.getTranscriptTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{externalName}</span> &nbsp; <span class="emph s120"> {stableId} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={stableId}">Ensembl</a>',' &nbsp; <a target="_blank" href="http://wikipathways.org//index.php?query={externalName}&species='+this.wikipathwaysSpecie+'&title=Special%3ASearchPathways&doSearch=1">Wikipathways</a>',
"</p><br>",'<p><span class="w100 dis s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" dis s90">Strand: </span> {strand}</p>','<p><span class="w100 dis s90">Biotype: </span> {biotype}</p>','<p><span class="w100 dis s90">Description: </span> <span><tpl if="description == &quot;&quot;">No description available</tpl>{description}</span></p>',"<br>",'<p><span class="w100 dis s90">CDS &nbsp; (start-end): </span> {codingRegionStart}-{codingRegionEnd} <span style="margin-left:50px" class="w100 dis s90">CDNA (start-end): </span> {cdnaCodingStart}-{cdnaCodingEnd}</p>',
"<br>",'<p><span class="w100 dis s90">External DB: </span> {externalDb}</p>','<p><span class="w100 dis s90">Status: </span> {status}</p><br>')};
InfoWidget.prototype.getSnpTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{name}</span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Variation/Summary?v={name}">Ensembl</a>',"</p><br>",'<p><span class="w140 dis s90">Location: </span> <span class="">{chromosome}:{start}-{end} </span><span style="margin-left:50px" class=" dis s90">Strand: </span> {strand}</p>','<p><span class="w140 dis s90">Source: </span> <span class="s110">{source}</span></p>',
"<br>",'<p><span class="w140 dis s90">Map weight: </span> {mapWeight}</p>','<p><span class="w140 dis s90">Allele string: </span> {alleleString}</p>','<p><span class="w140 dis s90">Ancestral allele: </span> {ancestralAllele}</p>','<p><span class="w140 dis s90">Display So consequence: </span> {displaySoConsequence}</p>','<p><span class="w140 dis s90">So consequence type: </span> {soConsequenceType}</p>','<p><span class="w140 dis s90">Display consequence: </span> {displayConsequence}</p>','<p><span class="w140 dis s90">Sequence: </span> {sequence}</p>')};
InfoWidget.prototype.getExonTemplate=function(){return new Ext.XTemplate('<span><span class="panel-border-bottom"><span class="ssel s110">{stableId}</span></span></span>','<span><span style="margin-left:30px" class="dis s90"> Location: </span> <span class="">{chromosome}:{start}-{end} </span></span>','<span><span style="margin-left:30px" class="dis s90"> Strand: </span> {strand}</span>')};
InfoWidget.prototype.getProteinTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{name}</span> &nbsp; <span class="emph s120"> {primaryAccession} </span></span></p>',"<br>",'<p><span class="w100 dis s90">Full name: </span> <span class="">{fullName}</span></p>','<p><span class="w100 dis s90">Gene name: </span> <span class="">{geneName}</span></p>','<p><span class="w100 dis s90">Organism: </span> <span class="">{organism}</span></p>')};
InfoWidget.prototype.getVCFVariantTemplate=function(){return new Ext.XTemplate('<p><span><span class="panel-border-bottom"><span class="ssel s130">{chromosome}:{start}-{alt}</span> &nbsp; <span class="emph s120"> {label} </span></span></span></p><br>','<p><span class="w75 dis s90">Alt: </span> {alt}</p>','<p><span class="w75 dis s90">Ref: </span> {ref}</p>','<p><span class="w75 dis s90">Quality: </span> {quality}</p>','<p><span class="w75 dis s90">Format: </span> {format}</p>','<p><span class="w75 dis s90">Samples: </span> {samples}</p>',
'<p><span class="w75 dis s90">Info: </span> {info}</p>')};
InfoWidget.prototype.getPWMTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{accession}</span> &nbsp; <span class="emph s120"> {tfName} </span></span></p>',"<br>",'<p><span class="w100 dis s90">Type: </span> <span class="">{source}</span></p>','<p><span class="w100 dis s90">Source: </span> <span class="">{type}</span></p>','<p><span class="w100 dis s90">Description: </span> <span class="">{description}</span></p>','<p><span class="w100 dis s90">Length: </span> <span class="">{length}</span></p>',
'<p><span class="w100 dis s90">Frequencies: </span> <span class="">{[this.parseFrequencies(values.frequencies)]}</span></p>',{parseFrequencies:function(a){return"<p>"+a.replace(/,/gi,"<br>")+"</p>"}})};
InfoWidget.prototype.getProteinXrefTemplate=function(){return new Ext.XTemplate('<p><span class="w75 emph s100">{[values.source.toUpperCase()]}</span> &nbsp; <span class="emph w125 s100"> {[this.generateLink(values)]} <span class="info">&raquo;</span> </span></p>',{generateLink:function(a){if(null!=a.source)switch(a.source.toUpperCase()){case "GO":return'<a TARGET="_blank" href="http://amigo.geneontology.org/cgi-bin/amigo/term_details?term='+a.name+'">'+a.name+"</a>";case "REACTOME":return'<a TARGET="_blank" href="http://www.reactome.org/cgi-bin/eventbrowser_st_id?ST_ID='+
a.name+'">'+a.name+"</a>";case "KEGG":return'<a TARGET="_blank" href="http://www.genome.jp/dbget-bin/www_bget?'+a.name+'">'+a.name+"</a>";case "INTACT":return'<a TARGET="_blank" href="http://www.ebi.ac.uk/intact/pages/interactions/interactions.xhtml?query='+a.name+'">'+a.name+"</a>";case "MINT":return'<a TARGET="_blank" href="http://mint.bio.uniroma2.it/mint/search/search.do?queryType=protein&interactorAc='+a.name+'">'+a.name+"</a>";case "DIP":return'<a TARGET="_blank" href="http://dip.doe-mbi.ucla.edu/dip/Browse.cgi?ID='+
a.name+'">'+a.name+"</a>";case "STRING":return'<a TARGET="_blank" href="http://string-db.org/newstring_cgi/show_network_section.pl?identifier=P51587">'+a.name+"</a>";case "MIM":return'<a TARGET="_blank" href="http://www.omim.org/entry/'+a.name+'">'+a.name+"</a>";case "PHARMGKB":return'<a TARGET="_blank" href="http://www.pharmgkb.org/do/serve?objId='+a.name+'&objCls=Gene">'+a.name+"</a>";case "ORPHANET":return'<a TARGET="_blank" href="http://www.orpha.net/consor/cgi-bin/OC_Exp.php?lng=EN&Expert='+
a.name+'">'+a.name+"</a>"}else return""}})};
InfoWidget.prototype.getSnpTranscriptTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{[this.getStableId(values)]}</span> &nbsp; <span class="emph s120"> {stableId} </span></span>',' &nbsp; <a target="_blank" href="http://www.ensembl.org/'+this.ensemblSpecie+'/Transcript/Transcript?t={[this.getStableId(values)]}">Ensembl</a>',"</p><br>",'<p><span class="w140 dis s90">CDS &nbsp; (start : end): </span> {cdsStart} : {cdsEnd} <span style="margin-left:50px" class="w100 dis s90">cDNA (start : end): </span> {cdnaStart} : {cdnaEnd}</p>','<p><span class="w140 dis s90">Translation (start : end): </span> {translationStart} : {translationEnd}</p>',
'<p><span class="w140 dis s90">Peptide allele: </span> {peptideAlleleString}</p>','<p><span class="w140 dis s90">Alt. peptide allele: </span> {alternativePeptideAlleleString}</p>','<p><span class="w140 dis s90">Codon: </span> {codon}</p>','<p><span class="w140 dis s90">Reference codon: </span> {referenceCodon}</p>','<p><span class="w140 dis s90">Polyphen prediction: </span> {polyphenPrediction}','<span style="margin-left:50px" class="w140 dis s90">Polyphen score: </span> {polyphenScore}</p>','<p><span class="w140 dis s90">Sift prediction: </span> {siftPrediction}',
'<span style="margin-left:50px" class="w140 dis s90">Sift score: </span> {siftScore}</p>',{getStableId:function(a){return""!=a.transcript?a.transcript.stableId:"Intergenic SNP"}})};
InfoWidget.prototype.getConsequenceTypeTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{transcript.stableId}</span> &nbsp; <span class="emph s120"> {consequenceType.description} </span></span><br><br>','<p><span class="w100 dis s90">SO accesion: </span> {consequenceType.soAccession}</p>','<p><span class="w100 dis s90">SO term: </span> {consequenceType.soTerm}</p>','<p><span class="w100 dis s90">Feature So term: </span> {consequenceType.featureSoTerm}</p>',
'<p><span class="w100 dis s90">NCBI term: </span> {consequenceType.ncbiTerm}</p>','<p><span class="w100 dis s90">Rank: </span> {consequenceType.rank}</p><br>')};
InfoWidget.prototype.getPhenotypeTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{phenotypeDescription}</span> &nbsp; <span class="emph s120"> {source} </span></span><br><br>','<p><span class="w150 dis s90">PValue: </span>{PValue}</p>','<p><span class="w150 dis s90">Assoc. gene name: </span>{associatedGeneName}</p>','<p><span class="w150 dis s90">Assoc. variant risk allele: </span>{associatedVariantRiskAllele}</p>','<p><span class="w150 dis s90">Phenotype description: </span>{phenotypeDescription}</p>',
'<p><span class="w150 dis s90">Phenotype name: </span>{phenotypeName}</p>','<p><span class="w150 dis s90">Risk allele freq in controls: </span>{riskAlleleFrequencyInControls}</p>','<p><span class="w150 dis s90">Source: </span>{source}</p>','<p><span class="w150 dis s90">Study name: </span>{studyName}</p>','<p><span class="w150 dis s90">Study type: </span>{studyType}</p>','<p><span class="w150 dis s90">Study URL: </span>{studyUrl}</p>','<p><span class="w150 dis s90">Study description: </span>{studyDescription}</p>')};
InfoWidget.prototype.getPopulationTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{population}</span> &nbsp; <span class="emph s120"> {source} </span></span><br><br>','<p><span class="w140 dis s90">Ref allele:  </span>{refAllele} ({refAlleleFrequency})</p>','<p><span class="w140 dis s90">Other allele:  </span>{otherAllele} ({otherAlleleFrequency})</p>','<p><span class="w140 dis s90">Ref allele homozygote:  </span>{refAlleleHomozygote} ({refAlleleHomozygoteFrequency})</p>',
'<p><span class="w140 dis s90">Allele heterozygote:  </span>{alleleHeterozygote} ({alleleHeterozygoteFrequency})</p>','<p><span class="w140 dis s90">Other allele homozygote:  </span>{otherAlleleHomozygote} ({otherAlleleHeterozygoteFrequency})</p>','<p><span class="w140 dis s90">Source:  </span>{source}</p>','<p><span class="w140 dis s90">Population:  </span>{population}</p>')};InfoWidget.prototype.getVariantEffectTemplate=function(){return new Ext.XTemplate('<p><span class="panel-border-bottom"><span class="ssel s130">{consequenceTypeObo}</span> &nbsp; <span class="emph s120"> {featureBiotype} </span></span><br><br>')};
GeneInfoWidget.prototype.draw=InfoWidget.prototype.draw;GeneInfoWidget.prototype.render=InfoWidget.prototype.render;GeneInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;GeneInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;GeneInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;GeneInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate;GeneInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate;
function GeneInfoWidget(a,b,c){null==c&&(c={});c.title="Gene Info";InfoWidget.prototype.constructor.call(this,a,b,c)}GeneInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"3D protein"}]};
GeneInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Transcripts":this.panel.add(this.getTranscriptPanel(this.data.transcripts).show());break;case "GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case "Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,"Interpro").show());
break;case "Reactome":this.panel.add(this.getXrefGrid(this.data.reactome,"Reactome").show());break;case "3D protein":this.panel.add(this.get3Dprotein(this.data.snps).show())}};GeneInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getGeneTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
GeneInfoWidget.prototype.getTranscriptPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid};
GeneInfoWidget.prototype.getXrefGrid=function(a,b){if(0>=a.length)return this.notFoundPanel;null==this[b+"Grid"]&&(this[b+"Grid"]=this.doGrid([{header:"Display Id",dataIndex:"displayId",flex:1},{header:"Description",dataIndex:"description",flex:3}],["description","displayId"],b,""),this[b+"Grid"].store.loadData(a));return this[b+"Grid"]};
GeneInfoWidget.prototype.get3Dprotein=function(){var a=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var b=[];$.ajax({url:"http://ws.bioinfo.cipf.es/cellbase/rest/v1/hsa/feature/id/"+this.query+"/xref?dbname=pdb",async:!1,success:function(c){if(""!=c){b=c.trim().split("\n");for(c=0;c<b.length;c++){var d=b[c].trim(),d=Ext.create("Ext.panel.Panel",{title:d,bodyCls:"background-black",html:'<center><canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+
d+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas></center>',listeners:{afterrender:function(a){a=a.title;ChemDoodle.default_backgroundColor="#000000";var b=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+a,300,300);b.gl?(b.specs.set3DRepresentation("Ball and Stick"),b.specs.proteins_ribbonCartoonize=!0,b.handle=null,b.timeout=15,b.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,b.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,
b.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,b.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,b.nextFrame=function(a){var b=[];mat4.identity(b);var a=a/1E3,c=Math.PI/15;mat4.rotate(b,c*a,[1,0,0]);mat4.rotate(b,c*a,[0,1,0]);mat4.rotate(b,c*a,[0,0,1]);mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+a+".pdb",function(a){a=ChemDoodle.readPDB(a);b.loadMolecule(a);b.startAnimation()})):(b.emptyMessage="Your browser does not support WebGL",b.displayMessage())}}});
a.p3dProtein.add(d)}}else a.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein};GeneInfoWidget.prototype.getEnsembleId=function(){};GeneInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){console.log(d);a.dataReceived(JSON.parse(d.result))});b.get("feature","gene",this.query,"fullinfo")};
GeneInfoWidget.prototype.dataReceived=function(a){this.data=a[0][0];this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};ProteinInfoWidget.prototype.draw=InfoWidget.prototype.draw;ProteinInfoWidget.prototype.render=InfoWidget.prototype.render;ProteinInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;ProteinInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;ProteinInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
function ProteinInfoWidget(a,b,c){null==c&&(c={});c.title="Protein Info";InfoWidget.prototype.constructor.call(this,a,b,c)}ProteinInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Sumary",children:[{text:"Long"},{text:"Seq"}]},{text:"Functional information",children:[{text:"GO"},{text:"Reactome"},{text:"Interpro"}]},{text:"Interactions"},{text:"Variations"}]};
ProteinInfoWidget.prototype.optionClick=function(a){a.leaf&&null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1))};SnpInfoWidget.prototype.draw=InfoWidget.prototype.draw;SnpInfoWidget.prototype.render=InfoWidget.prototype.render;SnpInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;SnpInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;SnpInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
SnpInfoWidget.prototype.getSnpTemplate=InfoWidget.prototype.getSnpTemplate;SnpInfoWidget.prototype.getSnpTranscriptTemplate=InfoWidget.prototype.getSnpTranscriptTemplate;SnpInfoWidget.prototype.getConsequenceTypeTemplate=InfoWidget.prototype.getConsequenceTypeTemplate;SnpInfoWidget.prototype.getPhenotypeTemplate=InfoWidget.prototype.getPhenotypeTemplate;SnpInfoWidget.prototype.getPopulationTemplate=InfoWidget.prototype.getPopulationTemplate;
function SnpInfoWidget(a,b,c){null==c&&(c={});c.title="SNP Info";InfoWidget.prototype.constructor.call(this,a,b,c)}SnpInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Transcripts"}]},{text:"Consequence type"},{text:"Annotated phenotype"},{text:"Population frequency"}]};
SnpInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Transcripts":this.panel.add(this.getTranscriptPanel(this.data.snptotranscript).show());break;case "Consequence type":this.panel.add(this.getConsequenceTypePanel(this.data.snptotranscript).show());break;case "Annotated phenotype":this.panel.add(this.getPhenotypePanel(this.data.phenotype).show());
break;case "Population frequency":this.panel.add(this.getPopulationPanel(this.data.population).show())}};SnpInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getSnpTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
SnpInfoWidget.prototype.getTranscriptPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.transcriptGrid){for(var b=this.getSnpTranscriptTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.transcriptGrid=Ext.create("Ext.panel.Panel",{title:"Transcripts ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.transcriptGrid};
SnpInfoWidget.prototype.getConsequenceTypePanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.consequencePanel){for(var b=this.getConsequenceTypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.consequencePanel=Ext.create("Ext.panel.Panel",{title:"Consequence type ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.consequencePanel};
SnpInfoWidget.prototype.getPhenotypePanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.phenotypePanel){for(var b=this.getPhenotypeTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.phenotypePanel=Ext.create("Ext.panel.Panel",{title:"Phenotype ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.phenotypePanel};
SnpInfoWidget.prototype.getPopulationPanel=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.populationPanel){for(var b=this.getPopulationTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.populationPanel=Ext.create("Ext.panel.Panel",{title:"Population ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.populationPanel};
SnpInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.dataReceived(JSON.parse(d.result))});b.get("feature","snp",this.query,"fullinfo")};
SnpInfoWidget.prototype.dataReceived=function(a){for(var a=a[0],b=0;b<a.length;b++)a[b].chromosome==this.feature.chromosome&&a[b].start==this.feature.start&&a[b].end==this.feature.end&&(this.data=a[b],console.log(a[b]));this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};TranscriptInfoWidget.prototype.draw=InfoWidget.prototype.draw;TranscriptInfoWidget.prototype.render=InfoWidget.prototype.render;TranscriptInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;
TranscriptInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;TranscriptInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;TranscriptInfoWidget.prototype.getGeneTemplate=InfoWidget.prototype.getGeneTemplate;TranscriptInfoWidget.prototype.getTranscriptTemplate=InfoWidget.prototype.getTranscriptTemplate;TranscriptInfoWidget.prototype.getExonTemplate=InfoWidget.prototype.getExonTemplate;
function TranscriptInfoWidget(a,b,c){null==c&&(c={});c.title="Transcript";InfoWidget.prototype.constructor.call(this,a,b,c)}TranscriptInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Gene"},{text:"Exons"}]},{text:"Functional information",children:[{text:"GO"},{text:"Interpro"},{text:"Reactome"}]},{text:"Variation",children:[{text:"SNPs"},{text:"Mutations"}]},{text:"Regulatory",children:[]},{text:"3D protein"}]};
TranscriptInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data).show());break;case "Gene":this.panel.add(this.getGenePanel(this.data.gene).show());break;case "Exons":this.panel.add(this.getExonsGrid(this.data.exons).show());break;case "GO":this.panel.add(this.getXrefGrid(this.data.go,"GO").show());break;case "Interpro":this.panel.add(this.getXrefGrid(this.data.interpro,
"Interpro").show());break;case "Reactome":this.panel.add(this.getXrefGrid(this.data.reactome,"Reactome").show());break;case "SNPs":this.panel.add(this.getSnpsGrid(this.data.snps).show());break;case "3D protein":this.panel.add(this.get3Dprotein(this.data.snps).show())}};
TranscriptInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getTranscriptTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,autoScroll:!0,data:a,tpl:b})}return this.infoPanel};
TranscriptInfoWidget.prototype.getGenePanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.genePanel){var b=this.getGeneTemplate();this.genePanel=Ext.create("Ext.panel.Panel",{title:"Gene",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.genePanel};
TranscriptInfoWidget.prototype.getExonsGrid=function(a){if(0>=a.length)return this.notFoundPanel;if(null==this.exonsGrid){for(var b=this.getExonTemplate(),c=[],d=0;d<a.length;d++){var e=Ext.create("Ext.container.Container",{padding:5,data:a[d],tpl:b});c.push(e)}this.exonsGrid=Ext.create("Ext.panel.Panel",{title:"Exons ("+d+")",border:!1,cls:"panel-border-left",flex:3,bodyPadding:5,autoScroll:!0,items:c})}return this.exonsGrid};
TranscriptInfoWidget.prototype.getXrefGrid=function(a,b){if(0>=a.length)return this.notFoundPanel;null==this[b+"Grid"]&&(this[b+"Grid"]=this.doGrid([{header:"Display Id",dataIndex:"displayId",flex:1},{header:"Description",dataIndex:"description",flex:3}],["description","displayId"],b,""),this[b+"Grid"].store.loadData(a));return this[b+"Grid"]};
TranscriptInfoWidget.prototype.getSnpsGrid=function(a){if(0>=a.length)return this.notFoundPanel;null==this.snpsGrid&&(this.snpsGrid=this.doGrid([{header:"Name",dataIndex:"name",flex:2},{header:"Location",xtype:"templatecolumn",tpl:"{chromosome}:{start}-{end}",flex:2},{header:"Strand",dataIndex:"strand",flex:0.7},{header:"Sequence",dataIndex:"sequence",flex:2}],"chromosome,start,end,name,strand,sequence".split(","),"SNPs",""),this.snpsGrid.store.loadData(a));return this.snpsGrid};
TranscriptInfoWidget.prototype.get3Dprotein=function(){var a=this;if(null==this.p3dProtein){this.p3dProtein=Ext.create("Ext.tab.Panel",{title:"3D Protein Viewer",border:!1,cls:"panel-border-left",flex:3,autoScroll:!0});var b=[];$.ajax({url:"http://ws.bioinfo.cipf.es/cellbase/rest/v1/hsa/feature/id/"+this.feature.feature.stableId+"/xref?dbname=pdb",async:!1,success:function(c){if(""!=c){b=c.trim().split("\n");for(c=0;c<b.length;c++){var d=b[c].trim(),d=Ext.create("Ext.panel.Panel",{title:d,bodyCls:"background-black",
html:'<canvas class="ChemDoodleWebComponent" id="pdb_canvas_'+d+'" width="600" height="600" style="width: 600px; height: 600px; ">This browser does not support HTML5/Canvas.</canvas>',listeners:{afterrender:function(a){a=a.title;ChemDoodle.default_backgroundColor="#000000";var b=new ChemDoodle.TransformCanvas3D("pdb_canvas_"+a,300,300);b.gl?(b.specs.set3DRepresentation("Ball and Stick"),b.specs.proteins_ribbonCartoonize=!0,b.handle=null,b.timeout=15,b.startAnimation=ChemDoodle._AnimatorCanvas.prototype.startAnimation,
b.stopAnimation=ChemDoodle._AnimatorCanvas.prototype.stopAnimation,b.isRunning=ChemDoodle._AnimatorCanvas.prototype.isRunning,b.dblclick=ChemDoodle.RotatorCanvas.prototype.dblclick,b.nextFrame=function(a){var b=[];mat4.identity(b);var a=a/1E3,c=Math.PI/15;mat4.rotate(b,c*a,[1,0,0]);mat4.rotate(b,c*a,[0,1,0]);mat4.rotate(b,c*a,[0,0,1]);mat4.multiply(this.rotationMatrix,b)},$.get("http://www.rcsb.org/pdb/files/"+a+".pdb",function(a){a=ChemDoodle.readPDB(a);b.loadMolecule(a);b.startAnimation()})):(b.emptyMessage=
"Your browser does not support WebGL",b.displayMessage())}}});a.p3dProtein.add(d)}}else a.p3dProtein.setTitle("No proteins found")}})}return this.p3dProtein};TranscriptInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){console.log(d);a.dataReceived(JSON.parse(d.result))});b.get("feature","transcript",this.query,"fullinfo")};
TranscriptInfoWidget.prototype.dataReceived=function(a){this.data=a[0];this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};VCFVariantInfoWidget.prototype.draw=InfoWidget.prototype.draw;VCFVariantInfoWidget.prototype.render=InfoWidget.prototype.render;VCFVariantInfoWidget.prototype.getTreePanel=InfoWidget.prototype.getTreePanel;VCFVariantInfoWidget.prototype.checkDataTypes=InfoWidget.prototype.checkDataTypes;VCFVariantInfoWidget.prototype.doGrid=InfoWidget.prototype.doGrid;
VCFVariantInfoWidget.prototype.getVCFVariantTemplate=InfoWidget.prototype.getVCFVariantTemplate;VCFVariantInfoWidget.prototype.getVariantEffectTemplate=InfoWidget.prototype.getVariantEffectTemplate;function VCFVariantInfoWidget(a,b,c){null==c&&(c={});c.title="VCF variant Info";InfoWidget.prototype.constructor.call(this,a,b,c)}VCFVariantInfoWidget.prototype.getdataTypes=function(){return dataTypes=[{text:"Genomic",children:[{text:"Information"},{text:"Variant effect"}]}]};
VCFVariantInfoWidget.prototype.optionClick=function(a){if(a.leaf)switch(null!=this.panel.getComponent(1)&&(this.panel.getComponent(1).hide(),this.panel.remove(1,!1)),a.text){case "Information":this.panel.add(this.getInfoPanel(this.data.feature).show());break;case "Variant effect":this.panel.add(this.getEffectPanel(this.data.consequenceType).show())}};
VCFVariantInfoWidget.prototype.getInfoPanel=function(a){if(null==a)return this.notFoundPanel;if(null==this.infoPanel){var b=this.getVCFVariantTemplate();this.infoPanel=Ext.create("Ext.panel.Panel",{title:"Information",border:!1,cls:"panel-border-left",flex:3,bodyPadding:10,data:a,tpl:b})}return this.infoPanel};
VCFVariantInfoWidget.prototype.getEffectPanel=function(a){if(0>=a.length)return this.notFoundPanel;for(var b=0;b<a.length;b++)a[b].consequence=a[b].consequenceType+" - "+a[b].consequenceTypeObo,""==a[b].featureName&&(a[b].featureName="-"),""==a[b].geneId&&(a[b].geneId="-"),""==a[b].transcriptId&&(a[b].transcriptId="-"),""==a[b].featureBiotype&&(a[b].featureBiotype="-"),""==a[b].aaPosition&&(a[b].aaPosition="-"),""==a[b].aminoacidChange&&(a[b].aminoacidChange="-");null==this.effectGrid&&(this.effectGrid=
this.doGrid([{header:"Feature",dataIndex:"featureName",flex:1},{header:"Gene Id",dataIndex:"geneId",flex:1.5},{header:"Transcript Id",dataIndex:"transcriptId",flex:1.5},{header:"Feat.Biotype",dataIndex:"featureBiotype",flex:1},{header:"aa Position",dataIndex:"aaPosition",flex:1},{header:"aa Change",dataIndex:"aminoacidChange",flex:1}],"featureName,geneId,transcriptId,featureBiotype,aaPosition,aminoacidChange,consequence".split(","),"effectGridModel","consequence"),this.effectGrid.store.loadData(a));
return this.effectGrid};VCFVariantInfoWidget.prototype.getData=function(){var a=this;this.panel.disable();this.panel.setLoading("Getting information...");var b=new CellBaseDataAdapter(this.species);b.successed.addEventListener(function(){console.log(b.toJSON());a.dataReceived(b.toJSON())});console.log(this.feature.feature);b.fill("genomic","variant",this.feature.feature.chromosome+":"+this.feature.feature.start+":"+this.feature.feature.ref+":"+this.feature.feature.alt,"consequence_type")};
VCFVariantInfoWidget.prototype.dataReceived=function(a){this.data={};this.data.feature=this.feature.feature;this.data.consequenceType=a;this.optionClick({text:"Information",leaf:"true"});this.panel.enable();this.panel.setLoading(!1)};
function CellBaseManager(a,b){this.host="http://ws.bioinfo.cipf.es/cellbase/rest";this.host="http://ws-beta.bioinfo.cipf.es/cellbase/rest";if(-1!=window.location.host.indexOf("fsalavert")||-1!=window.location.host.indexOf("rsanchez")||-1!=window.location.host.indexOf("imedina")||-1!=window.location.href.indexOf("http://bioinfo.cipf.es/apps-beta"))this.host="http://ws-beta.bioinfo.cipf.es/cellbase/rest";null!=$.url().param("p")&&(this.host="http://ws.bioinfo.cipf.es/cellbase/rest");null!=b&&null!=
b.host&&(this.host=b.host);this.version="latest";this.species=a;CELLBASEHOST=this.host;this.subcategory=this.category=null;this.contentformat="json";this.fileformat="";this.outputcompress=!1;this.dataType="script";this.resource=this.originalQuery=this.query="";this.params={};this.async=!0;this.maxQuery=30;this.numberQueries=0;this.results=[];this.resultsCount=[];this.batching=!1;this.completed=new Event;this.success=new Event;this.batchSuccessed=new Event;this.error=new Event;this.setVersion=function(a){this.version=
a};this.setSpecies=function(a){this.species=a};this.getVersion=function(){return this.version};this.getSpecies=function(){return this.species};this.setAsync=function(a){this.async=a};this.getUrl=function(){return null!=this.query?this.host+"/"+this.version+"/"+this.species+"/"+this.category+"/"+this.subcategory+"/"+this.query+"/"+this.resource:this.host+"/"+this.version+"/"+this.species+"/"+this.category+"/"+this.subcategory+"/"+this.resource};this.get=function(a,b,e,f,g,j){null!=g&&(this.params=
g);e instanceof Array?(this.originalQuery=e,this.batching=!0,this.results=[],this.getMultiple(a,b,e,f)):(e=new String(e),e=e.replace(/\s/g,""),this.originalQuery=g=e.split(","),this.maxQuery<g.length?(this.batching=!0,this.getMultiple(a,b,g,f,j)):(this.batching=!1,this.getSingle(a,b,e,f,j)))};this._joinToResults=function(a){this.resultsCount.push(!0);this.results[a.id]=a.data;if(this.numberQueries==this.resultsCount.length){for(var a=[],b=0;b<this.results.length;b++)for(var e=0;e<this.results[b].length;e++)a.push(this.results[b][e]);
this.success.notify({result:a,category:this.category,subcategory:this.subcategory,query:this.originalQuery,resource:this.resource,params:this.params,error:""})}};this.getSingle=function(a,b,e,f,g,j){this.category=a;this.subcategory=b;this.query=e;this.resource=f;this._callServer(this.getUrl(),g,j)};this.getMultiple=function(a,b,e,f){var g=[];if(e.length>this.maxQuery)for(var j=0;j<e.length;j+=this.maxQuery)g.push(e.slice(j,j+this.maxQuery));else g.push(e);this.numberQueries=g.length;var h=this;this.batchSuccessed.addEventListener(function(a,
b){h._joinToResults(b)});for(j=0;j<g.length;j++)this.results.push([]),this.getSingle(a,b,g[j].toString(),f,j)};this._callServer=function(a,b){var e=this;this.params.of=this.contentformat;a+=this.getQuery(this.params,a);$.ajax({type:"GET",url:a,async:this.async,success:function(a){""==a&&(console.log("data is empty"),a="[]");a=JSON.parse(a);e.batching?e.batchSuccessed.notify({data:a,id:b}):e.success.notify({result:a,category:e.category,subcategory:e.subcategory,query:e.originalQuery,resource:e.resource,
params:e.params,error:""})},complete:function(){e.completed.notify()},error:function(a,b,c){console.log("CellBaseManager: Ajax call returned : "+c+"\t"+b+"\t"+a.statusText+" END");e.error.notify()}});console.log(a)}}CellBaseManager.prototype.getQuery=function(a,b){var c="?";-1!=b.indexOf("?")&&(c="&");var d="",e;for(e in a)null!=a[e]&&(d+=e+"="+a[e]+"&");""!=d&&(d=c+d.substring(0,d.length-1));return d};
Ext.define("Ext.ux.Window",{extend:"Ext.window.Window",minimizable:!0,constrain:!0,collapsible:!0,initComponent:function(){this.callParent();null!=this.taskbar&&(this.zIndexManager=this.taskbar.winMgr,this.iconCls="icon-grid",this.button=Ext.create("Ext.button.Button",{text:this.title,window:this,iconCls:this.iconCls,handler:function(){this.window.zIndexManager.front==this.window?this.window.minimize():this.window.show()}}),this.taskbar.add(this.button),this.contextMenu=new Ext.menu.Menu({items:[{text:"Close",
window:this,iconCls:"tools-icons x-tool-close",handler:function(){this.window.close()}}]}),this.button.getEl().on("contextmenu",function(a){a.preventDefault();this.contextMenu.showAt(a.getX(),a.getY()-10-25*this.contextMenu.items.length)},this),this.button.on("destroy",function(){this.window.close()}),this.on("destroy",function(){!0!=this.button.destroying&&this.button.destroy()}),this.on("minimize",function(){this.hide()}),this.on("deactivate",function(){this.zIndexManager&&this.zIndexManager.front.ghostPanel&&
this.zIndexManager.unregister(this.zIndexManager.front.ghostPanel);this.button.toggle(!1)}),this.on("activate",function(){this.button.toggle(!0)}))}});function ChartWidget(a){this.id="ChartWidget_"+Math.round(1E7*Math.random());this.title=null;this.width=750;this.height=300;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}ChartWidget.prototype.getStore=function(){return this.store};
ChartWidget.prototype.getChart=function(a){Ext.define("ChromosomeChart",{extend:"Ext.data.Model",fields:a});this.store=Ext.create("Ext.data.Store",{model:"ChromosomeChart",autoLoad:!1});return Ext.create("Ext.chart.Chart",{animate:!0,shadow:!0,store:this.store,width:this.width,height:this.height,axes:[{position:"left",fields:[a[0]],title:a[0],grid:!0,type:"Numeric",minimum:0},{title:a[1],type:"category",position:"bottom",fields:[a[1]],label:{rotate:{degrees:270}}}],series:[{type:"column",axis:"left",
gutter:80,yField:a[0],xField:a[1],style:{fill:"#38B8BF"}}]})};function TextWindowWidget(){this.windows=[]}TextWindowWidget.prototype.draw=function(a){myRef=window.open("data:text/csv,field1%2Cfield2%0Afoo%2Cbar%0Agoo%2Cgai%0A","mywin","left=20,top=20,width=500,height=200");myRef.document.write(a)};function ClienSideDownloaderWindowWidget(){this.windows=[]}
ClienSideDownloaderWindowWidget.prototype.draw=function(a,b){myRef=window.open("data:text/csv,"+b,"mywin","left=20,top=20,width=500,height=200");myRef.document.write(a)};
function InputListWidget(a){this.id="InputListWidget"+Math.round(1E7*Math.random());this.title="List";this.width=500;this.height=350;this.headerInfo="Write a list separated only by lines";this.args=a;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.headerInfo&&(this.headerInfo=a.headerInfo),null!=a.viewer&&(this.viewer=a.viewer));this.onOk=new Event(this)}
InputListWidget.prototype.draw=function(a){var b=this;null==a&&(a=new String);null==this.panel&&(this.infobar=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"}),this.infoLabel=Ext.create("Ext.toolbar.TextItem",{text:this.headerInfo}),this.infobar.add(this.infoLabel),this.editor=Ext.create("Ext.form.field.TextArea",{id:this.id+"genelist_preview",xtype:"textarea",name:"file",margin:"-1",width:this.width,height:this.height,enableKeyEvents:!0,cls:"dis",style:"normal 6px tahoma, arial, verdana, sans-serif",
value:a,listeners:{scope:this,change:function(){this.validate()}}}),a=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.editor]}),this.okButton=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,listeners:{scope:this,click:function(){this.onOk.notify(Ext.getCmp(this.id+"genelist_preview").getValue().split("\n"));b.panel.close()}}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),layout:"fit",resizable:!1,collapsible:!0,constrain:!0,
closable:!0,items:[a],buttons:[this.okButton,{text:"Cancel",handler:function(){b.panel.close()}}],listeners:{scope:this,destroy:function(){delete this.panel}}}));this.panel.show()};InputListWidget.prototype.validate=function(){""!=this.editor.getValue()?this.okButton.enable():this.okButton.disable()};
function ListPanel(a,b){this.targetId=null;this.id="ListPanel"+Math.round(1E5*Math.random());this.species=a;this.args=b;this.title="List of Genes";this.width=1E3;this.height=500;this.borderCls="panel-border-bottom";this.gridFields="externalName,stableId,biotype,position,strand,description,chromosome,start,end".split(",");null!=b&&(null!=b.title&&(this.title=b.title),null!=b.targetId&&(this.targetId=b.targetId),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.gridFields&&
(this.gridFields=b.gridFields),null!=b.borderCls&&(this.borderCls=b.borderCls),null!=b.viewer&&(this.viewer=b.viewer),null!=b.featureType&&(this.featureType=b.featureType));this.onSelected=new Event(this);this.onFilterResult=new Event(this)}
ListPanel.prototype._getGeneGrid=function(){for(var a=this,b=this.gridFields,c=[],d=[],e=0;e<b.length;e++)c.push({type:"string",dataIndex:b[e]}),d.push({header:this.gridFields[e],dataIndex:this.gridFields[e],flex:1});this.store=Ext.create("Ext.data.Store",{fields:b,groupField:"biotype",autoload:!1});c={ftype:"filters",local:!0,filters:c};this.infoToolBar=Ext.create("Ext.toolbar.Toolbar");this.infoLabelOk=Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"});this.infoLabelNotFound=Ext.create("Ext.toolbar.TextItem",
{text:"&nbsp;"});this.clearFilter=Ext.create("Ext.button.Button",{text:"Clear filters",listeners:{scope:this,click:function(){null!=this.grid.filters&&this.grid.filters.clearFilters()}}});this.found=Ext.create("Ext.button.Button",{text:"Features found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features found",headerInfo:"This features were found in the database",viewer:this.viewer})).draw(this.queriesFound.join("\n"))}}});this.notFound=Ext.create("Ext.button.Button",
{text:"Features not found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features not found",headerInfo:"This features were not found in the database",viewer:this.viewer})).draw(this.queriesNotFound.join("\n"))}}});this.exportButton=Ext.create("Ext.button.Button",{text:"Export to Text",handler:function(){(new InputListWidget({width:1100,title:"VCS content",headerInfo:"Export results",viewer:a.args.viewer})).draw(a._getStoreContent())}});this.localizeButton=Ext.create("Ext.button.Button",
{text:"Localize on karyotype",handler:function(){a._localize()}});this.infoToolBar.add(["->",this.exportButton,this.localizeButton,"-",this.found,this.notFound,this.clearFilter]);return this.grid=Ext.create("Ext.grid.Panel",{border:0,store:this.store,features:[c],bbar:this.infoToolBar,columns:d,selModel:{mode:"SINGLE"}})};
ListPanel.prototype._localize=function(){var a=this,b=Ext.create("Ext.window.Window",{id:this.id+"karyotypePanel",title:"Karyotype",width:1020,height:410,bodyStyle:"background:#fff;",html:'<div id="'+this.id+'karyotypeDiv" ><div>',buttons:[{text:"Close",handler:function(){b.close()}}],listeners:{afterrender:function(){var b=$("#"+a.id+"karyotypeDiv")[0],b=new KaryotypeWidget(b,{width:1E3,height:340,species:a.viewer.species,chromosome:a.viewer.chromosome,position:a.viewer.position});b.onClick.addEventListener(function(b,
c){a.viewer.onLocationChange.notify({position:c.position,chromosome:c.chromosome,sender:"KaryotypePanel"})});b.drawKaryotype();for(var d=0;d<a.features.length;d++)b.addMark(a.features[d])}}}).show()};ListPanel.prototype.setTextInfoBar=function(a,b,c){this.found.setText('<span class="dis">'+a+" results found </span> ");this.found.show();0<c&&(this.notFound.setText('<span class="err">'+c+" features not found</span>"),this.notFound.show())};
ListPanel.prototype._getStoreContent=function(){for(var a=new String,b=0;b<this.store.data.items.length;b++){var c=new String;if(0==b){for(var d=0;d<this.gridFields.length;d++)c=c+this.gridFields[d]+"\t";c+="\n"}for(d=0;d<this.gridFields.length;d++)c=c+this.store.data.items[b].data[this.gridFields[d]]+"\t";c+="\n";a+=c}return a};
ListPanel.prototype._render=function(){null==this.panel&&(this.panel=Ext.create("Ext.panel.Panel",{height:240,layout:"fit",cls:this.borderCls,title:this.title,border:!1}));this.panel.add(this._getGeneGrid())};
ListPanel.prototype.draw=function(a,b){this._render();this.queriesNotFound=[];this.queriesFound=[];this.features=[];if(!1!=b){this.adapter=new FeatureDataAdapter(null,{species:this.species});for(var c=0;c<a.result.length;c++){a.result[c].constructor!=Array&&(a.result[c]=[a.result[c]]);for(var d=0;d<a.result[c].length;d++){var e=a.result[c][d];e.position=e.chromosome+":"+e.start+"-"+e.end;e.featureType=a.resource;this.features.push(e)}0==a.result[c].length?this.queriesNotFound.push(a.query[c]):(this.queriesFound.push(a.query[c]),
this.adapter.addFeatures(a.result[c]))}}else for(c=0;c<a.result.length;c++){a.result[c].constructor!=Array&&(a.result[c]=[a.result[c]]);for(d=0;d<a.result[c].length;d++)e=a.result[c][d],e.position=e.chromosome+":"+e.start+"-"+e.end,e.featureType=a.resource,this.features.push(e);0==a.result[c].length?this.queriesNotFound.push(a.query[c]):this.queriesFound.push(a.query[c])}this.store.loadData(this.features);this.setTextInfoBar(this.queriesFound.length,this.queriesFound.length,this.queriesNotFound.length)};
function ListWidget(a,b){this.targetId=null;this.id="ListWidget"+Math.round(1E7*Math.random());this.species=a;this.width=1E3;this.height=500;this.action="localize";this.title="";this.args=b;null!=b&&(null!=b.title&&(this.title=b.title),null!=b.targetId&&(this.targetId=b.targetId),null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.action&&(this.action=b.action),null!=b.viewer&&(this.viewer=b.viewer));this.listPanel=new ListPanel(this.species,{title:!1,gridFields:b.gridFields,
viewer:this.args.viewer});this.onSelected=this.listPanel.onSelected;this.onFilterResult=this.listPanel.onFilterResult}
ListWidget.prototype._render=function(){var a=this;null==this.panel&&(this.localizeButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",disabled:!0,handler:function(){a.listPanel.onSelected.notify(a.listPanel.grid.getSelectionModel().getSelection()[0].data);a.panel.hide()}}),this.filterButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",handler:function(){a.listPanel.onFilterResult.notify(a.listPanel.store.getRange());a.panel.hide()}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,
taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),resizable:!1,constrain:!0,closable:!0,layout:"fit",minimizable:!0,width:this.width,height:this.height,items:[this.listPanel.grid],buttonAlign:"right",buttons:[this.getActionButton(this.action),{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}))};
ListWidget.prototype.draw=function(a,b){var c=this;this.listPanel.draw(a,b);this.listPanel.grid.getSelectionModel().on("selectionchange",function(){c.listPanel.grid.getSelectionModel().hasSelection()?c.localizeButton.enable():c.localizeButton.disable()});this._render();this.panel.show()};ListWidget.prototype.getActionButton=function(a){switch(a){case "localize":return this.localizeButton;case "filter":return this.listPanel.localizeButton.disable().hide(),this.filterButton}};
GenomicListWidget.prototype.draw=ListWidget.prototype.draw;GenomicListWidget.prototype.getActionButton=ListWidget.prototype.getActionButton;function GenomicListWidget(a,b){ListWidget.prototype.constructor.call(this,a,b);this.onSelected=this.listPanel.onSelected;this.onFilterResult=this.listPanel.onFilterResult;this.onTrackAddAction=new Event}
GenomicListWidget.prototype._render=function(){var a=this;null==this.panel&&(this.localizeButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",disabled:!0,handler:function(){a.listPanel.onSelected.notify(a.listPanel.grid.getSelectionModel().getSelection()[0].data);a.panel.hide()}}),this.filterButton=Ext.create("Ext.button.Button",{minWidth:80,text:"OK",handler:function(){a.listPanel.onFilterResult.notify(a.listPanel.store.getRange());a.panel.hide()}}),this.panel=Ext.create("Ext.ux.Window",
{title:this.title,taskbar:Ext.getCmp(this.viewer.id+"uxTaskbar"),resizable:!1,constrain:!0,closable:!0,layout:"fit",minimizable:!0,width:this.width,height:this.height,items:[this.listPanel.grid],buttonAlign:"left",buttons:[{text:"Add Track",handler:function(){var b="Search "+Math.round(1E3*Math.random());a.onTrackAddAction.notify({adapter:a.listPanel.adapter,fileName:b})}},"->",this.getActionButton(this.action),{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},
destroy:function(){delete this.panel}}}))};GenomicListPanel.prototype._getGeneGrid=ListPanel.prototype._getGeneGrid;GenomicListPanel.prototype._localize=ListPanel.prototype._localize;GenomicListPanel.prototype.setTextInfoBar=ListPanel.prototype.setTextInfoBar;GenomicListPanel.prototype._getStoreContent=ListPanel.prototype._getStoreContent;GenomicListPanel.prototype._render=ListPanel.prototype._render;GenomicListPanel.prototype.draw=ListPanel.prototype.draw;
function GenomicListPanel(a){ListPanel.prototype.constructor.call(this,a)}function FilterPanel(a){this.id="FilterPanel_"+Math.round(1E7*Math.random());this.height=this.width=this.title=this.targetId=null;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}
FilterPanel.prototype.draw=function(a){a="manzanas,pera,meloconton,sandia,melon,naranja,manzanas,pera,meloconton,sandia,melon,naranja,manzanas,pera,meloconton,sandia,melon,naranja".split(",");this.render(a);null!=this.targetId&&this.panel.render(this.targetId)};
FilterPanel.prototype.render=function(a){for(var b=[],c=0;c<a.length;c++)b.push({boxLabel:a[c],checked:!0});null==this.panel&&(this.panel=Ext.create("Ext.panel.Panel",{title:this.title,width:this.width,height:this.height,layout:"vbox",defaultType:"checkboxfield",items:b}))};
function AttributesWidget(a){this.id="AttributesWidget_"+Math.random();this.title="";this.width=1025;this.height=628;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.attributesPanel=new AttributesPanel({borderCls:a.borderCls,height:325})}AttributesWidget.prototype.draw=function(){this.render()};AttributesWidget.prototype.getDetailPanel=function(){return{}};
AttributesWidget.prototype.getButtons=function(){var a=this;return[{text:"Close",handler:function(){a.panel.close()}}]};
AttributesWidget.prototype.render=function(){null==this.panel&&(this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,collapsible:!0,layout:{type:"vbox",align:"stretch"},items:[this.attributesPanel.getPanel(),this.getDetailPanel()],width:this.width,height:this.height,buttonAlign:"right",buttons:this.getButtons(),listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.panel.setLoading());this.panel.show()};
GenotypeGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;GenotypeGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;GenotypeGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;GenotypeGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;GenotypeGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;
GenotypeGenomicAttributesWidget.prototype.dataChange=GenomicAttributesWidget.prototype.dataChange;GenotypeGenomicAttributesWidget.prototype.fill=GenomicAttributesWidget.prototype.fill;GenotypeGenomicAttributesWidget.prototype.onAdditionalInformationClick=GenomicAttributesWidget.prototype.onAdditionalInformationClick;
function GenotypeGenomicAttributesWidget(a,b){null==b&&(b={});b.title="Genotype";b.tags=["genotype"];b.featureType="snp";b.listWidgetArgs={title:"Filter",action:"filter",gridFields:"name,variantAlleles,ancestralAllele,mapWeight,position,sequence".split(",")};GenomicAttributesWidget.prototype.constructor.call(this,a,b)}
function AttributesPanel(a){var b=this;this.targetId=null;this.id="AttributesPanel_"+Math.round(1E7*Math.random());this.title=null;this.width=1023;this.height=628;this.wum=!0;this.tags=[];this.borderCls="panel-border-bottom";this.columnsCount=null;null!=a&&(null!=a.wum&&(this.wum=a.wum),null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height),null!=a.columnsCount&&(this.columnsCount=a.columnsCount),
null!=a.borderCls&&(this.borderCls=a.borderCls),null!=a.tags&&(this.tags=a.tags));this.browserData=new BrowserDataWidget;this.onDataChange=new Event(this);this.onFileRead=new Event(this);this.browserData.adapter.onReadData.addEventListener(function(a,d){var e=new TabularDataAdapter(new StringDataSource(d.data),{async:!1}),f=e.getLines();b.makeGrid(e);b.uptadeTotalFilteredRowsInfo(f.length);b.uptadeTotalRowsInfo(f.length);b.fileName=d.filename;b.fileNameLabel.setText('<span class="emph">'+d.filename+
'</span> <span class="info">(server)</span>',!1)})}AttributesPanel.prototype.draw=function(){var a=this.getPanel();null!=this.targetId&&a.render(this.targetId)};AttributesPanel.prototype.uptadeTotalRowsInfo=function(a){this.infoLabel.setText('<span class="dis">Total rows: </span><span class="emph">'+a+"</span>",!1)};AttributesPanel.prototype.uptadeTotalFilteredRowsInfo=function(a){this.infoLabel2.setText('<span class="dis">Filtered rows: </span><span class="emph">'+a+"</span>",!1)};
AttributesPanel.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};AttributesPanel.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
AttributesPanel.prototype.getPanel=function(){var a=this;null==this.panel&&(this.expresionAnalysisUploadFieldFile=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{scope:this,change:function(){a.panel.setLoading("Reading file");try{var b=new TabularFileDataAdapter({comment:"#"}),c=document.getElementById(this.expresionAnalysisUploadFieldFile.fileInputEl.id).files[0];a.fileName=c.name;a.fileNameLabel.setText('<span class="emph">'+
c.name+'</span> <span class="info">(local)</span>',!1);b.loadFromFile(c);b.onRead.addEventListener(function(){a.makeGrid(b);a.uptadeTotalFilteredRowsInfo(b.lines.length);a.uptadeTotalRowsInfo(b.lines.length);a.panel.setLoading(!1);a.onFileRead.notify()})}catch(d){alert(d),a.panel.setLoading(!1)}}}}),this.barField=Ext.create("Ext.toolbar.Toolbar"),this.barInfo=Ext.create("Ext.toolbar.Toolbar",{dock:"bottom"}),this.barHelp=Ext.create("Ext.toolbar.Toolbar",{dock:"top"}),this.clearFilter=Ext.create("Ext.button.Button",
{text:"Clear filters",disabled:!0,listeners:{scope:this,click:function(){null!=this.grid.filters&&(this.grid.filters.clearFilters(),this.store.clearFilter())}}}),this.helpLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">Click on the header down arrow to filter by column</span>'}),this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'}),this.infoLabel=
Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"}),this.infoLabel2=Ext.create("Ext.toolbar.TextItem",{text:"&nbsp;"}),this.barField.add(this.expresionAnalysisUploadFieldFile),this.barInfo.add("->",this.infoLabel,this.infoLabel2),this.barHelp.add(this.fileNameLabel,"->",this.helpLabel),this.store=Ext.create("Ext.data.Store",{fields:["1","2"],data:[]}),this.grid=Ext.create("Ext.grid.Panel",{store:this.store,disabled:!0,border:0,columns:[{header:"Column 1",dataIndex:"1"},{header:"Column 2",dataIndex:"2"}]}),
this.panel=Ext.create("Ext.panel.Panel",{title:this.title,border:!1,layout:"fit",cls:this.borderCls,items:[this.grid],tbar:this.barField,width:this.width,height:this.height,maxHeight:this.height,buttonAlign:"right",listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),this.panel.addDocked(this.barInfo),this.panel.addDocked(this.barHelp));this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,listeners:{scope:this,
click:function(){this.browserData.draw($.cookie("bioinfo_sid"),this.tags)}}}),this.barField.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?this.sessionInitiated():this.sessionFinished());this.barField.add("-",this.clearFilter);return this.panel};AttributesPanel.prototype.getData=function(){return this.data};
AttributesPanel.prototype.makeGrid=function(a){this.data=a.getLines();var b=[],c=[],d=[];null==this.columnsCount&&(this.columnsCount=this.data[0].length);for(var e=0;e<this.columnsCount;e++){var f=a.getHeuristicTypeByColumnIndex(e);b.push({name:e.toString(),type:f});c.push({header:"Column "+e.toString(),dataIndex:e.toString(),flex:1,filterable:!0,filter:{type:f}});d.push({type:f,dataIndex:e.toString()})}this.store=Ext.create("Ext.data.Store",{fields:b,data:this.data,listeners:{scope:this,datachanged:function(a){a.getRange();
this.uptadeTotalFilteredRowsInfo(a.getRange().length);this.onDataChange.notify(a.getRange())}}});a={ftype:"filters",local:!0,filters:d};null!=this.grid&&this.panel.remove(this.grid);this.grid=Ext.create("Ext.grid.Panel",{store:this.store,columns:c,border:0,features:[a]});this.panel.insert(0,this.grid);this.clearFilter.enable()};
function GenomicAttributesWidget(a,b){var c=this;this.id="GenomicAttributesWidget"+Math.round(1E4*Math.random());this.species=a;this.args=b;this.title="None";this.featureType="gene";this.columnsCount=null;null!=b&&(null!=b.title&&(this.title=b.title),null!=b.columnsCount&&(this.columnsCount=b.columnsCount),null!=b.featureType&&(this.featureType=b.featureType),null!=b.viewer&&(this.viewer=b.viewer,b.listWidgetArgs.viewer=b.viewer));this.listWidget=new ListWidget(this.species,b.listWidgetArgs);this.attributesPanel=
new AttributesPanel({height:240,columnsCount:this.columnsCount,wum:b.wum,tags:b.tags});this.onMarkerClicked=new Event(this);this.onTrackAddAction=new Event(this);this.attributesPanel.onDataChange.addEventListener(function(a,b){c.dataChange(b)})}
GenomicAttributesWidget.prototype.draw=function(){var a=this;null==this.panel&&(this.karyotypePanel=Ext.create("Ext.panel.Panel",{id:this.id+"karyotypePanel",height:350,maxHeight:350,border:0,padding:"0 0 0 0",html:'<div id="'+this.id+'karyotypeDiv" ><div>'}),this.karyotypePanel.on("afterrender",function(){var b=$("#"+a.id+"karyotypeDiv")[0];console.log(b);a.karyotypeWidget=new KaryotypeWidget(b,{width:1E3,height:340,species:a.viewer.species,chromosome:a.viewer.chromosome,position:a.viewer.position});
a.karyotypeWidget.onClick.addEventListener(function(b,d){a.viewer.onLocationChange.notify({position:d.position,chromosome:d.chromosome,sender:"KaryotypePanel"})});a.karyotypeWidget.drawKaryotype()}),this.filtersButton=Ext.create("Ext.button.Button",{text:"Additional Filters",disabled:!0,listeners:{scope:this,click:function(){this.onAdditionalInformationClick()}}}),this.addTrackButton=Ext.create("Ext.button.Button",{text:"Add Track",disabled:!0,handler:function(){a.onTrackAddAction.notify({adapter:a.adapter,
fileName:a.attributesPanel.fileName})}}),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,minimizable:!0,constrain:!0,closable:!0,bodyStyle:"background:#fff;",taskbar:Ext.getCmp(this.args.viewer.id+"uxTaskbar"),items:[this.attributesPanel.getPanel(),this.karyotypePanel],width:1035,height:653,buttonAlign:"left",buttons:[this.addTrackButton,"->",{text:"Close",handler:function(){a.panel.close()}}],listeners:{scope:this,minimize:function(){this.panel.hide()},destroy:function(){delete this.panel}}}),
this.attributesPanel.barField.add(this.filtersButton),this.panel.setLoading());this.panel.show()};GenomicAttributesWidget.prototype.dataChange=function(a){try{this.karyotypePanel.setLoading("Connecting to Database");this.karyotypeWidget.unmark();for(var b=[],c=0;c<a.length;c++)b.push(a[c].data[0]);0<a.length?this.fill(b):this.karyotypePanel.setLoading(!1)}catch(d){alert(d)}finally{this.karyotypePanel.setLoading(!1)}};
GenomicAttributesWidget.prototype.onAdditionalInformationClick=function(){var a=this;this.listWidget.draw(this.cbResponse,!1);this.listWidget.onFilterResult.addEventListener(function(b,c){debugger;a.karyotypeWidget.unmark();for(var d=0;d<c.length;d++)a.karyotypeWidget.addMark(c[d].data);a.attributesPanel.store.clearFilter();a.attributesPanel.store.filter(function(a){return a.data.cellBase})})};ExpressionGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;
ExpressionGenomicAttributesWidget.prototype.getMainPanel=GenomicAttributesWidget.prototype.getMainPanel;ExpressionGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;ExpressionGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;ExpressionGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;ExpressionGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;
ExpressionGenomicAttributesWidget.prototype.onAdditionalInformationClick=GenomicAttributesWidget.prototype.onAdditionalInformationClick;function ExpressionGenomicAttributesWidget(a,b){null==b&&(b={});b.columnsCount=2;b.title="Expression";b.tags=["expression"];b.featureType="gene";b.listWidgetArgs={title:"Filter",action:"filter"};GenomicAttributesWidget.prototype.constructor.call(this,a,b)}
ExpressionGenomicAttributesWidget.prototype.fill=function(a){for(var b=this,c=Normalizer.normalizeArray(values),d=[],e=0;e<c.length;e++)isNaN(parseFloat(values[e]))?d.push("#000000"):d.push(Colors.getColorByScoreValue(c[e]).HexString());if(null==this.cbResponse){var c=new CellBaseManager(this.species),f=new FeatureDataAdapter(null,{species:this.species});c.success.addEventListener(function(a,c){b.karyotypePanel.setLoading("Retrieving data");for(var e=0;e<c.result.length;e++){b.attributesPanel.store.data.items[e].data.cellBase=
0<c.result[e].length?!0:!1;for(var k=0;k<c.result[e].length;k++){var l=c.result[e][k];l.featureType="gene";b.karyotypeWidget.addMark(l,d[e]);f.addFeatures(l)}}b.adapter=f;b.filtersButton.enable();b.addTrackButton.enable();b.karyotypePanel.setLoading(!1);b.cbResponse=c;b.karyotypePanel.setLoading(!1)});this.karyotypePanel.setLoading("Connecting to Database");c.get("feature","gene",a.toString(),"info")}};
ExpressionGenomicAttributesWidget.prototype.dataChange=function(a){try{var b=[];values=[];for(var c=0;c<a.length;c++)b.push(a[c].data[0]),values.push(a[c].data[1]);0<a.length&&this.fill(b,values)}catch(d){alert(d),this.panel.setLoading(!1)}};NetworkAttributesWidget.prototype.render=AttributesWidget.prototype.render;NetworkAttributesWidget.prototype.getButtons=AttributesWidget.prototype.getButtons;
function NetworkAttributesWidget(a){null==a&&(a={});var b=0.5*a.height,c=0.5*a.width;a.borderCls="";a.tags=["sif|json"];AttributesWidget.prototype.constructor.call(this,{height:b+325+75,width:c+24,title:a.title});this.networkHeigth=b;this.networkWidth=c;this.networkPanelId="NetworkAttributesWidget_"+Math.ceil(1E3*Math.random())}NetworkAttributesWidget.prototype.getNetworkPanelId=function(){return this.networkPanelId};
NetworkAttributesWidget.prototype.getDetailPanel=function(){return Ext.create("Ext.container.Container",{padding:5,flex:1,height:this.networkHeigth,style:"background: #eee;",cls:"x-unselectable",html:'<div id="'+this.getNetworkPanelId()+'" style="border:1px solid #bbb;" ><div>'})};
NetworkAttributesWidget.prototype.drawNetwork=function(a,b,c,d){this.dataset=b.clone();this.formatter=new NetworkDataSetFormatter({width:400,height:200});this.formatter.loadFromJSON(this.dataset,c.toJSON());var c=this.dataset.getVertices(),e;for(e in c)b=this.formatter.getVertexById(e).getDefault().getSize(),this.formatter.getVertexById(e).getDefault().setSize(0.3*b);e=this.dataset.getEdges();for(var f in e)b=this.formatter.getEdgeById(f).getDefault().getStrokeWidth(),this.formatter.getEdgeById(f).getDefault().setStrokeWidth(0.3*
b);f=new LayoutDataset;f.loadFromJSON(this.dataset,d.toJSON());this.networkWidget=new NetworkWidget(null,{targetId:a,label:!1});this.networkWidget.draw(this.dataset,this.formatter,f);this.networkWidget.getFormatter().resize(this.networkWidth,this.networkHeigth)};
NetworkAttributesWidget.prototype.draw=function(a,b,c){var d=this;this.render();this.attributes={};this.verticesSelected=new Event(this);this.graphDataset=a;this.found=Ext.create("Ext.button.Button",{text:"Nodes found",hidden:!0,listeners:{scope:this,click:function(){(new InputListWidget({title:"Features found",headerInfo:"This nodes were found in the Graph"})).draw(this.foundNodes.join("\n"))}}});this.notFound=Ext.create("Ext.button.Button",{text:"nodes not found",hidden:!0,listeners:{scope:this,
click:function(){(new InputListWidget({title:"Features not found",headerInfo:"This nodes were not found in the grpah"})).draw(this.notFoundNodes.join("\n"))}}});this.attributesPanel.barInfo.insert(2,this.notFound);this.attributesPanel.barInfo.insert(2,this.found);this.attributesPanel.onDataChange.addEventListener(function(a,b){d.dataChanged(b)});this.drawNetwork(this.getNetworkPanelId(),a,b,c)};
NetworkAttributesWidget.prototype.getVertexAttributesByName=function(a){var b=this.attributesPanel.getData(),c=[];if(null!=b){for(var d=0;d<b.length;d++)b[d][0]==a&&c.push(b[d]);return c}return a};
NetworkAttributesWidget.prototype.dataChanged=function(a){this.foundNodes=[];this.notFoundNodes=[];for(var b=0;b<a.length;b++)null==this.graphDataset.getVertexByName(a[b].data["0"])?this.notFoundNodes.push(a[b].data["0"]):this.foundNodes.push(a[b].data["0"]);this.found.setText('<span class="dis">'+this.foundNodes.length+" results found </span> ");this.found.show();0<this.notFoundNodes.length&&(this.notFound.setText('<span class="err">'+this.notFoundNodes.length+" features not found</span>"),this.notFound.show());
this.onDataChanged(a)};NetworkAttributesWidget.prototype.onDataChanged=function(){this.verticesSelected.notify(this.getFoundVertices());this.networkWidget.deselectNodes();this.networkWidget.selectVerticesByName(this.getFoundVertices())};NetworkAttributesWidget.prototype.getFoundVertices=function(){return this.foundNodes};ExpressionNetworkAttributesWidget.prototype.draw=NetworkAttributesWidget.prototype.draw;ExpressionNetworkAttributesWidget.prototype.render=NetworkAttributesWidget.prototype.render;
ExpressionNetworkAttributesWidget.prototype.render=NetworkAttributesWidget.prototype.render;ExpressionNetworkAttributesWidget.prototype.makeGrid=NetworkAttributesWidget.prototype.makeGrid;ExpressionNetworkAttributesWidget.prototype.getDetailPanel=NetworkAttributesWidget.prototype.getDetailPanel;ExpressionNetworkAttributesWidget.prototype.getNetworkPanelId=NetworkAttributesWidget.prototype.getNetworkPanelId;ExpressionNetworkAttributesWidget.prototype.drawNetwork=NetworkAttributesWidget.prototype.drawNetwork;
ExpressionNetworkAttributesWidget.prototype.dataChanged=NetworkAttributesWidget.prototype.dataChanged;ExpressionNetworkAttributesWidget.prototype.getFoundVertices=NetworkAttributesWidget.prototype.getFoundVertices;ExpressionNetworkAttributesWidget.prototype.getVertexAttributesByName=NetworkAttributesWidget.prototype.getVertexAttributesByName;
function ExpressionNetworkAttributesWidget(a){null==a&&(a={});this.id="ExpressionNetworkAttributes_"+Math.random();a.columnsCount=2;a.title="Expression";a.tags=["expression"];NetworkAttributesWidget.prototype.constructor.call(this,a);this.applyColors=new Event}
ExpressionNetworkAttributesWidget.prototype.getButtons=function(){var a=this;this.rescaleCheckBox=Ext.create("Ext.form.field.Checkbox",{boxLabel:"Rescale",padding:"0 0 5 5",disabled:!0,listeners:{scope:this,change:function(){a.onDataChanged(a.attributesPanel.grid.store.getRange())}}});this.attributesPanel.barInfo.insert(0,this.rescaleCheckBox);this.attributesPanel.onFileRead.addEventListener(function(){a.rescaleCheckBox.enable()});return[{text:"Apply Colors",handler:function(){a.applyColors.notify();
a.panel.close()}},{text:"Close",handler:function(){a.panel.close()}}]};
ExpressionNetworkAttributesWidget.prototype.onDataChanged=function(a){var b=this.rescaleCheckBox.getValue();this.verticesSelected.notify(this.getFoundVertices());this.networkWidget.deselectNodes();this.networkWidget.selectVerticesByName(this.getFoundVertices());for(var c=[],d=[],e=0;e<a.length;e++){var f=this.graphDataset.getVertexByName(a[e].data["0"]),g=a[e].data["1"];null!=f&&!isNaN(parseFloat(g))&&(b&&(g=0>parseFloat(g)?-1*(Math.log(Math.abs(g))/Math.log(2)):Math.log(Math.abs(g))/Math.log(2)),
c.push(g),d.push(a[e].data["0"]))}b=Normalizer.normalizeArray(c);a=[];for(e=0;e<b.length;e++)isNaN(parseFloat(c[e]))?a.push("#000000"):a.push(Colors.getColorByScoreValue(b[e]).HexString());for(var j in d){c=this.dataset.getVertexByName(d[j]);for(e=0;e<c.length;e++)this.formatter.getVertexById(c[e].getId()).getDefault().setFill(a[j])}};ExpressionGenomicAttributesWidget.prototype.draw=GenomicAttributesWidget.prototype.draw;ExpressionGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;
ExpressionGenomicAttributesWidget.prototype.drawKaryotype=GenomicAttributesWidget.prototype.drawKaryotype;ExpressionGenomicAttributesWidget.prototype.render=GenomicAttributesWidget.prototype.render;ExpressionGenomicAttributesWidget.prototype.makeGrid=GenomicAttributesWidget.prototype.makeGrid;ExpressionGenomicAttributesWidget.prototype.getKaryotypePanelId=GenomicAttributesWidget.prototype.getKaryotypePanelId;ExpressionGenomicAttributesWidget.prototype.dataChange=GenomicAttributesWidget.prototype.dataChange;
function ExpressionGenomicAttributesWidget(a,b,c){GenomicAttributesWidget.prototype.constructor.call(this,a,b,c);this.karyotypeWidget=new KaryotypePanel(this.getKaryotypePanelId(),this.getKaryotypePanelId(),{top:10,width:1E3,height:300,trackWidth:15})}
ExpressionGenomicAttributesWidget.prototype.dataChange=function(a){try{console.log(a);var b=this;this.karyotypePanel.setLoading("Connecting to Database");this.karyotypeWidget.unmark();var b=this,c=[];if(0<a.length){for(var d=0;d<a.length;d++)c.push(a[d].data[0]);var e=new CellBaseDataAdapter;e.successed.addEventListener(function(){b.karyotypePanel.setLoading("Retrieving data");for(var a=0;a<e.dataset.toJSON().length;a++)b.karyotypeWidget.mark(e.dataset.toJSON()[a]);b.karyotypePanel.setLoading(!1)});
e.fill("feature","gene",c.toString(),"info")}}catch(f){alert(f),this.panel.setLoading(!1)}};function Event(a){this._sender=a;this._listeners=[]}Event.prototype={addEventListener:function(a){return this._listeners.push(a)-1},removeEventListener:function(a){this._listeners.splice(a,1)},notify:function(a){for(var b=0;b<this._listeners.length;b++)this._listeners[b](this._sender,a)}};
var SVG={addChild:function(a,b,c,d){var b=document.createElementNS("http://www.w3.org/2000/svg",b),e;for(e in c)b.setAttribute(e,c[e]);return this._insert(a,b,d)},addChildImage:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","image"),e;for(e in b)"xlink:href"==e&&d.setAttributeNS("http://www.w3.org/1999/xlink","href",b[e]),d.setAttribute(e,b[e]);return this._insert(a,d,c)},_insert:function(a,b,c){if(null==c)a.appendChild(b);else{var d=c+1;0==c&&(d=0);(c=a.childNodes[d])?
a.insertBefore(b,c):a.appendChild(b)}return b},init:function(a,b){return this.addChild(a,"svg",b)}},Normalizer=new function(){this.normalizeArray=function(a){return this.standardizeArray(this.normal(a))};this.normal=function(a){var b=this._getMean(a),c=this._getStdDeviation(a);this._getMaxAndMin(a);for(var d=[],e=0;e<a.length;e++)0!=c?d.push((a[e]-b)/c):d.push(a[e]);return d};this.standardizeArray=function(a){for(var b=this._getMaxAndMin(a),c=b[0],b=b[1],c=0>=c?Math.abs(c):-1*c,d=[],e=0;e<a.length;e++)0!=
b+c?d.push((a[e]+c)/(b+c)):d.push(a[e]+c);return d};this._getMean=function(a){for(var b=0,c=0;c<a.length;c++)b+=parseFloat(a[c]);return b/a.length};this._getStdDeviation=function(a){for(var b=this._getMean(a),c=0,d=0;d<a.length;d++)c+=Math.pow(parseFloat(a[d])-b,2);return Math.sqrt(c/a.length)};this._getMaxAndMin=function(a){for(var b=Number.MAX_VALUE,c=Number.MIN_VALUE,d=0;d<a.length;d++)a[d]<b&&(b=parseFloat(a[d])),a[d]>c&&(c=parseFloat(a[d]));return[b,c]}},Colors=new function(){function a(){var b=
0,c=0,d=0,e=0,f=0,g=0;this.SetRGB=function(a,h,k){b=a/255;c=h/255;d=k/255;a=Math.max(Math.max(b,c),d);h=Math.min(Math.min(b,c),d);g=a;f=0;0!=a&&(f=1-h/a);e=0;h!=a&&(h=a-h,e=b==a?(c-d)/h:c==a?2+(d-b)/h:4+(b-c)/h,e*=60,0>e&&(e+=360))};this.Red=function(){return Math.round(255*b)};this.Green=function(){return Math.round(255*c)};this.Blue=function(){return Math.round(255*d)};this.SetHSV=function(a,h,k){e=a;f=h;g=k;d=c=b=g;if(!(0==g||0==f)){var h=e/60,a=Math.floor(h),l=h-a,h=g*(1-f),k=g*(1-f*l),l=g*(1-
f*(1-l));switch(a){case 0:b=g;c=l;d=h;break;case 1:b=k;c=g;d=h;break;case 2:b=h;c=g;d=l;break;case 3:b=h;c=k;d=g;break;case 4:b=l;c=h;d=g;break;default:b=g,c=h,d=k}}};this.Hue=function(){return e};this.Saturation=function(){return f};this.Value=function(){return g};this.SetHexString=function(a){if(null==a||"string"!=typeof a)this.SetRGB(0,0,0);else if("#"==a.substr(0,1)&&(a=a.substr(1)),6!=a.length)this.SetRGB(0,0,0);else{var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),a=parseInt(a.substr(4,
2),16);isNaN(b)||isNaN(c)||isNaN(a)?this.SetRGB(0,0,0):this.SetRGB(b,c,a)}};this.HexString=function(){var a=this.Red().toString(16);1==a.length&&(a="0"+a);var b=this.Green().toString(16);1==b.length&&(b="0"+b);var c=this.Blue().toString(16);1==c.length&&(c="0"+c);return("#"+a+b+c).toUpperCase()};this.Complement=function(){var b=180<=e?e-180:e+180,c=g*(f-1)+1,d=g*f/c,l=new a;l.SetHSV(b,d,c);return l}}this.hashColor=[];this.getColorByScoreArrayValue=function(a){for(var c=[],d=0;d<a.length;d++){var e=
this.getColorByScoreValue(a[d]);c.push(e)}return c};this.getHexStringByScoreArrayValue=function(a){for(var a=this.getColorByScoreArrayValue(a),c=[],d=0;d<a.length;d++)c.push(a[d].HexString());return c};this.getColorByScoreValue=function(a){var c=a.toString().substr(0,4);if(null!=this.hashColor[c])return this.hashColor[c];if(isNaN(a))return Colors.ColorFromRGB(0,0,0);var d,e,f;0.5>a?(e=Colors.ColorFromRGB(0,0,255),f=Colors.ColorFromRGB(255,255,255),d=2*a):(e=Colors.ColorFromRGB(255,255,255),f=Colors.ColorFromRGB(255,
0,0),d=2*a-1);a=d;d=1-d;e=Colors.ColorFromRGB(d*e.Red()+a*f.Red(),d*e.Green()+a*f.Green(),d*e.Blue()+a*f.Blue());return this.hashColor[c]=e};this.ColorFromHSV=function(b,c,d){var e=new a;e.SetHSV(b,c,d);return e};this.ColorFromRGB=function(b,c,d){var e=new a;e.SetRGB(b,c,d);return e};this.ColorFromHex=function(b){var c=new a;c.SetHexString(b);return c}};
function FileWidget(a){var b=this;this.targetId=null;this.id="FileWidget_"+Math.round(1E5*Math.random());this.wum=!0;this.tags=[];this.args=a;null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title,this.id=this.title+this.id),null!=a.wum&&(this.wum=a.wum),null!=a.tags&&(this.tags=a.tags),null!=a.viewer&&(this.viewer=a.viewer));this.dataAdapter=null;this.onOk=new Event(this);this.browserData=new BrowserDataWidget;this.browserData.onSelect.addEventListener(function(a,
d){b.trackNameField.setValue(d.filename);b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.panel.setLoading()});this.browserData.adapter.onReadData.addEventListener(function(a,d){console.log(d);b.trackNameField.setValue(d.filename);b.fileNameLabel.setText('<span class="emph">'+d.filename+'</span> <span class="info">(server)</span>',!1);b.loadFileFromServer(d);b.panel.setLoading(!1)})}FileWidget.prototype.getTitleName=function(){return this.trackNameField.getValue()};
FileWidget.prototype.getFileFromServer=function(){};FileWidget.prototype.loadFileFromLocal=function(){};FileWidget.prototype.getChartItems=function(){return[]};
FileWidget.prototype.getFileUpload=function(){var a=this;return this.uploadField=Ext.create("Ext.form.field.File",{msgTarget:"side",width:75,emptyText:"Choose a local file",allowBlank:!1,buttonText:"Browse local",buttonOnly:!0,listeners:{change:{fn:function(){a.panel.setLoading();var b=document.getElementById(a.uploadField.fileInputEl.id).files[0];a.trackNameField.setValue(b.name);a.fileNameLabel.setText('<span class="emph">'+b.name+'</span> <span class="info">(local)</span>',!1);a.loadFileFromLocal(b);
a.panel.setLoading(!1)}}}})};
FileWidget.prototype.draw=function(){var a=this;if(null==this.openDialog){var b=Ext.create("Ext.toolbar.Toolbar");this.featureCountLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="dis">No file loaded</span>'});b.add([this.featureCountLabel]);var c=Ext.create("Ext.toolbar.Toolbar",{cls:"bio-border-false"});c.add(this.getFileUpload());this.panel=Ext.create("Ext.panel.Panel",{border:!1,cls:"panel-border-top panel-border-bottom",title:"Previsualization",items:this.getChartItems(),bbar:b});
this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",fieldLabel:"Track Name",allowBlank:!1,value:"New track from "+this.title+" file",emptyText:"Choose a name",flex:1});b=Ext.create("Ext.panel.Panel",{border:!1,layout:"hbox",bodyPadding:10,items:[this.trackNameField]});this.wum&&(this.btnBrowse=Ext.create("Ext.button.Button",{text:"Browse server",disabled:!0,handler:function(){a.browserData.draw($.cookie("bioinfo_sid"),a.tags)}}),c.add(this.btnBrowse),null!=$.cookie("bioinfo_sid")?this.sessionInitiated():
this.sessionFinished());this.fileNameLabel=Ext.create("Ext.toolbar.TextItem",{text:'<span class="emph">Select a <span class="info">local</span> file or a <span class="info">server</span> file from your account.</span>'});c.add(["->",this.fileNameLabel]);this.btnOk=Ext.create("Ext.button.Button",{text:"Ok",disabled:!0,handler:function(){a.onOk.notify({fileName:a.file.name,adapter:a.adapter});a.openDialog.close()}});this.openDialog=Ext.create("Ext.ux.Window",{title:"Open "+this.title+" file",taskbar:Ext.getCmp(this.args.viewer.id+
"uxTaskbar"),width:600,resizable:!1,items:[c,b],buttons:[this.btnOk,{text:"Cancel",handler:function(){a.openDialog.close()}}],listeners:{scope:this,minimize:function(){this.openDialog.hide()},destroy:function(){delete this.openDialog}}})}this.openDialog.show()};FileWidget.prototype.sessionInitiated=function(){null!=this.btnBrowse&&this.btnBrowse.enable()};FileWidget.prototype.sessionFinished=function(){null!=this.btnBrowse&&this.btnBrowse.disable()};
function LegendWidget(a){this.height=this.width=300;this.title="Legend";null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.legendPanel=new LegendPanel}
LegendWidget.prototype.draw=function(a){var b=this;null==this.panel&&(a=this.legendPanel.getPanel(a),this.panel=Ext.create("Ext.ux.Window",{title:this.title,resizable:!1,constrain:!0,closable:!0,width:a.width+10,height:a.height+70,items:[a],buttonAlign:"right",layout:{type:"hbox",align:"stretch"},buttons:[{text:"Close",handler:function(){b.panel.close()}}]}));this.panel.show()};
function LegendPanel(a){this.width=200;this.height=250;null!=a&&(null!=a.title&&(this.title=a.title),null!=a.targetId&&(this.targetId=a.targetId),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height))}
LegendPanel.prototype.getColorItems=function(a){panelsArray=[];for(var b in a){var c=Ext.create("Ext.draw.Component",{width:15,height:15,items:[{type:"rect",fill:a[b],x:0,y:0,width:15,height:15}]}),d=b.replace(/_/gi," "),d=d.charAt(0).toUpperCase()+d.slice(1),c=Ext.create("Ext.panel.Panel",{height:15,border:!1,flex:1,margin:"1 0 0 1",layout:{type:"hbox",align:"stretch"},items:[c,{xtype:"tbtext",text:d,margin:"1 0 0 3"}]});panelsArray.push(c)}return panelsArray};
LegendPanel.prototype.getPanel=function(a){null==this.panel&&(a=this.getColorItems(a),this.panel=Ext.create("Ext.panel.Panel",{bodyPadding:"0 0 0 2",border:!1,layout:{type:"vbox",align:"stretch"},items:a,width:this.width,height:20*a.length}));return this.panel};LegendPanel.prototype.getButton=function(a){null==this.button&&(this.button=Ext.create("Ext.button.Button",{text:this.title,menu:{items:[this.getPanel(a)]}}));return this.button};
function UrlWidget(a){this.id="UrlWidget_"+Math.round(1E7*Math.random());this.targetId=null;this.title="Custom url";this.width=500;this.height=400;null!=a&&(null!=a.targetId&&(this.targetId=a.targetId),null!=a.title&&(this.title=a.title),null!=a.width&&(this.width=a.width),null!=a.height&&(this.height=a.height));this.onAdd=new Event(this)}UrlWidget.prototype.draw=function(){null==this.panel&&this.render();this.panel.show()};
UrlWidget.prototype.render=function(){var a=this;this.urlField=Ext.create("Ext.form.field.Text",{margin:"0 2 2 0",labelWidth:30,width:this.width-55,fieldLabel:"URL",emptyText:"enter a valid url",value:"http://www.ensembl.org/das/Homo_sapiens.GRCh37.gene/features",listeners:{change:{fn:function(){var b=this.value.split("/das/")[1].split("/")[0];a.trackNameField.setValue(b)}}}});this.checkButton=Ext.create("Ext.button.Button",{text:"Check",handler:function(){a.form.setLoading();var b=new DasAdapter({url:a.urlField.getValue(),
featureCache:{gzip:!1,chunkSize:1E4}});b.onCheckUrl.addEventListener(function(b,d){console.log(d.data);a.contentArea.setValue(d.data);a.form.setLoading(!1)});b.onError.addEventListener(function(){a.contentArea.setValue("XMLHttpRequest cannot load. This server is not allowed by Access-Control-Allow-Origin");a.form.setLoading(!1)});b.checkUrl()}});this.trackNameField=Ext.create("Ext.form.field.Text",{name:"file",allowBlank:!1,value:a.urlField.value.split("/das/")[1].split("/")[0],emptyText:"Choose a name",
flex:1});this.panelSettings=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,title:"Track name",cls:"panel-border-top",bodyPadding:10,width:this.width-2,items:[this.trackNameField]});this.contentArea=Ext.create("Ext.form.field.TextArea",{margin:"-1",width:this.width,height:this.height});this.infobar=Ext.create("Ext.toolbar.Toolbar",{height:28,cls:"bio-border-false",items:[this.urlField,this.checkButton]});this.form=Ext.create("Ext.panel.Panel",{border:!1,items:[this.infobar,this.contentArea,
this.panelSettings]});this.panel=Ext.create("Ext.ux.Window",{title:this.title,layout:"fit",resizable:!1,items:[this.form],buttons:[{text:"Add",handler:function(){a.onAdd.notify({name:a.trackNameField.getValue(),url:a.urlField.getValue()});a.panel.close()}},{text:"Cancel",handler:function(){a.panel.close()}}],listeners:{destroy:function(){delete a.panel}}})};
GENE_BIOTYPE_COLORS={"3prime_overlapping_ncrna":"Orange",ambiguous_orf:"SlateBlue",antisense:"SteelBlue",disrupted_domain:"YellowGreen",IG_C_gene:"#FF7F50",IG_D_gene:"#FF7F50",IG_J_gene:"#FF7F50",IG_V_gene:"#FF7F50",lincRNA:"#8b668b",miRNA:"#8b668b",misc_RNA:"#8b668b",Mt_rRNA:"#8b668b",Mt_tRNA:"#8b668b",ncrna_host:"Fuchsia",nonsense_mediated_decay:"Chartreuse",non_coding:"orangered",non_stop_decay:"aqua",polymorphic_pseudogene:"#666666",processed_pseudogene:"#666666",processed_transcript:"#0000ff",
protein_coding:"#a00000",pseudogene:"#666666",retained_intron:"gold",retrotransposed:"lightsalmon",rRNA:"LawnGreen",sense_intronic:"#20B2AA",sense_overlapping:"#20B2AA",snoRNA:"#8b668b",snRNA:"#8b668b",transcribed_processed_pseudogene:"#666666",transcribed_unprocessed_pseudogene:"#666666",unitary_pseudogene:"#666666",unprocessed_pseudogene:"#666666",other:"#000000"};
SNP_BIOTYPE_COLORS={"2KB_upstream_variant":"#a2b5cd","5KB_upstream_variant":"#a2b5cd","500B_downstream_variant":"#a2b5cd","5KB_downstream_variant":"#a2b5cd","3_prime_UTR_variant":"#7ac5cd","5_prime_UTR_variant":"#7ac5cd",coding_sequence_variant:"#458b00",complex_change_in_transcript:"#00fa9a",frameshift_variant:"#ff69b4",incomplete_terminal_codon_variant:"#ff00ff",inframe_codon_gain:"#ffd700",inframe_codon_loss:"#ffd700",initiator_codon_change:"#ffd700",non_synonymous_codon:"#ffd700",intergenic_variant:"#636363",
intron_variant:"#02599c",mature_miRNA_variant:"#458b00",nc_transcript_variant:"#32cd32",splice_acceptor_variant:"#ff7f50",splice_donor_variant:"#ff7f50",splice_region_variant:"#ff7f50",stop_gained:"#ff0000",stop_lost:"#ff0000",stop_retained_variant:"#76ee00",synonymous_codon:"#76ee00",other:"#000000"};SEQUENCE_COLORS={A:"#009900",C:"#0000FF",G:"#857A00",T:"#aa0000",N:"#555555"};
FEATURE_TYPES={sequence:{color:SEQUENCE_COLORS},undefined:{getLabel:function(a){return a=""+(a.chromosome+":"+a.start+"-"+a.end)},getColor:function(){return"grey"},height:10},gene:{getLabel:function(a){var b;b=""+(0>a.strand?"<":"");b+=" "+a.externalName+" ";b+=0<a.strand?">":"";return b+=" ["+a.biotype+"]"},getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"stableId",height:4,histogramColor:"lightblue"},transcript:{getLabel:function(a){var b;b=""+(0>a.strand?"<":"");b+=" "+
a.externalName+" ";b+=0<a.strand?">":"";return b+=" ["+a.biotype+"]"},getColor:function(a){return GENE_BIOTYPE_COLORS[a.biotype]},infoWidgetId:"stableId",height:4,histogramColor:"lightblue"},exon:{getLabel:function(a){return a=""+a.stableId},getColor:function(){return"black"},infoWidgetId:"stableId",height:4,histogramColor:"lightblue"},snp:{getLabel:function(a){return a=""+a.name},getColor:function(a){return SNP_BIOTYPE_COLORS[a.displaySoConsequence]},infoWidgetId:"name",height:10,histogramColor:"orange"},
mutation:{getLabel:function(a){return a=""+a[Object.keys(a)[0]]},getColor:function(){return"Chartreuse"},infoWidgetId:"name",height:10,histogramColor:"Chartreuse"},cpg_island:{getLabel:function(a){return a=""+a[Object.keys(a)[0]]},getColor:function(){return"Aquamarine"},infoWidgetId:"name",height:10,histogramColor:"Aquamarine"},structural_variation:{getLabel:function(a){return a=""+a[Object.keys(a)[0]]},getColor:function(){return"indigo"},infoWidgetId:"name",height:10,histogramColor:"indigo"},mirna_targets:{getLabel:function(a){return a=
""+a[Object.keys(a)[0]]},getColor:function(){return"#8b668b"},infoWidgetId:"name",height:10,histogramColor:"#8b668b"},tfbs:{getLabel:function(a){return a=""+a[Object.keys(a)[0]]},getColor:function(){return"blue"},infoWidgetId:"name",height:10,histogramColor:"blue"},conserved_region:{getLabel:function(a){return a=""+a[Object.keys(a)[0]]},getColor:function(){return"DodgerBlue"},infoWidgetId:"name",height:10,histogramColor:"DodgerBlue"},file:{getLabel:function(a){return a=""+a.label},getColor:function(){return"black"},
height:10,histogramColor:"orange"},bed:{getLabel:function(a){return a=""+a.label},getColor:function(a){var b=[],b=a.itemRgb.split(","),a=function(a){var b="0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f".split(",");return isNaN(a)?"00":b[(a-a%16)/16]+b[a%16]};return"#"+(a(b[0])+a(b[1])+a(b[2]))},height:10,histogramColor:"orange"},das:{getLabel:function(a){return a=""+a.id},getColor:function(){return"black"},height:10,histogramColor:"orange"}};function FeatureBinarySearchTree(){this._root=null}
FeatureBinarySearchTree.prototype={constructor:FeatureBinarySearchTree,add:function(a){var a={value:a,left:null,right:null},b;if(null===this._root)return this._root=a,!0;for(b=this._root;;)if(a.value.end<b.value.start){if(null===b.left)return b.left=a,!0;b=b.left}else if(a.value.start>b.value.end){if(null===b.right)return b.right=a,!0;b=b.right}else return!1},contains:function(a){for(var b=!1,c=this._root;!b&&c;)a.end<c.value.start?c=c.left:a.start>c.value.end?c=c.right:b=!0;return b}};
(function(){var a,b,c,d,e=null,f,g,j,h,k,l,y,m,v,q,n,r,s,A,p,C,o,t,G,u,D,x,w,H,K,N,O,W,I,P,J,S,L,F,E,B,Q,aa,X,na,fa,ga,T,ha,oa,Y,ba,U,Z,ia,pa,ca=function(){this.dl=this.fc=0},qa=function(){this.extra_bits=this.static_tree=this.dyn_tree=null;this.max_code=this.max_length=this.elems=this.extra_base=0},R=function(a,b,c,d){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d},Ia=function(){this.next=null;this.len=0;this.ptr=Array(8192);this.off=0},ra=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,
3,3,3,3,4,4,4,4,5,5,5,5,0],da=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ja=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],wa=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],sa=[new R(0,0,0,0),new R(4,4,8,4),new R(4,5,16,8),new R(4,6,32,32),new R(4,4,16,16),new R(8,16,32,32),new R(8,16,128,128),new R(8,32,128,256),new R(32,128,258,1024),new R(32,258,258,4096)],ja=function(d){e[g+f++]=d;if(8192==g+f&&0!=f){var j;null!=a?(d=a,a=a.next):d=new Ia;d.next=null;d.len=d.off=0;null==b?
b=c=d:c=c.next=d;d.len=f-g;for(j=0;j<d.len;j++)d.ptr[j]=e[g+j];f=g=0}},ka=function(a){a&=65535;8190>g+f?(e[g+f++]=a&255,e[g+f++]=a>>>8):(ja(a&255),ja(a>>>8))},la=function(){n=(n<<5^h[o+3-1]&255)&8191;r=y[32768+n];y[o&32767]=r;y[32768+n]=o},V=function(a,b){M(b[a].fc,b[a].dl)},xa=function(a,b,c){return a[b].fc<a[c].fc||a[b].fc==a[c].fc&&Q[b]<=Q[c]},ya=function(a,b,c){var d;for(d=0;d<c&&pa<ia.length;d++)a[b+d]=ia.charCodeAt(pa++)&255;return d},za=function(a){var b=D,c=o,d,e=C,f=32506<o?o-32506:0,g=o+
258,j=h[c+e-1],l=h[c+e];C>=H&&(b>>=2);do if(d=a,!(h[d+e]!=l||h[d+e-1]!=j||h[d]!=h[c]||h[++d]!=h[c+1])){c+=2;d++;do;while(h[++c]==h[++d]&&h[++c]==h[++d]&&h[++c]==h[++d]&&h[++c]==h[++d]&&h[++c]==h[++d]&&h[++c]==h[++d]&&h[++c]==h[++d]&&h[++c]==h[++d]&&c<g);d=258-(g-c);c=g-258;if(d>e){t=a;e=d;if(258<=d)break;j=h[c+e-1];l=h[c+e]}}while((a=y[a&32767])>f&&0!=--b);return e},ta=function(){var a,b,c=65536-u-o;if(-1==c)c--;else if(65274<=o){for(a=0;32768>a;a++)h[a]=h[a+32768];t-=32768;o-=32768;q-=32768;for(a=
0;8192>a;a++)b=y[32768+a],y[32768+a]=32768<=b?b-32768:0;for(a=0;32768>a;a++)b=y[a],y[a]=32768<=b?b-32768:0;c+=32768}G||(a=ya(h,o+u,c),0>=a?G=!0:u+=a)},Ka=function(a,c,e){var z;if(!d){if(!G){v=m=0;var l,k;if(0==W[0].dl){P.dyn_tree=K;P.static_tree=O;P.extra_bits=ra;P.extra_base=257;P.elems=286;P.max_length=15;P.max_code=0;J.dyn_tree=N;J.static_tree=W;J.extra_bits=da;J.extra_base=0;J.elems=30;J.max_length=15;J.max_code=0;S.dyn_tree=I;S.static_tree=null;S.extra_bits=Ja;S.extra_base=0;S.elems=19;S.max_length=
7;for(k=l=S.max_code=0;28>k;k++){na[k]=l;for(z=0;z<1<<ra[k];z++)aa[l++]=k}aa[l-1]=k;for(k=l=0;16>k;k++){fa[k]=l;for(z=0;z<1<<da[k];z++)X[l++]=k}for(l>>=7;30>k;k++){fa[k]=l<<7;for(z=0;z<1<<da[k]-7;z++)X[256+l++]=k}for(z=0;15>=z;z++)L[z]=0;for(z=0;143>=z;)O[z++].dl=8,L[8]++;for(;255>=z;)O[z++].dl=9,L[9]++;for(;279>=z;)O[z++].dl=7,L[7]++;for(;287>=z;)O[z++].dl=8,L[8]++;Aa(O,287);for(z=0;30>z;z++)W[z].dl=5,W[z].fc=Ba(z,5);Ca()}for(z=0;8192>z;z++)y[32768+z]=0;x=sa[w].max_lazy;H=sa[w].good_length;D=sa[w].max_chain;
q=o=0;u=ya(h,0,65536);if(0>=u)G=!0,u=0;else{for(G=!1;262>u&&!G;)ta();for(z=n=0;2>z;z++)n=(n<<5^h[z]&255)&8191}b=null;g=f=0;3>=w?(C=2,p=0):(p=2,A=0);j=!1}d=!0;if(0==u)return j=!0,0}if((z=Da(a,c,e))==e)return e;if(j)return z;if(3>=w)for(;0!=u&&null==b;){la();0!=r&&32506>=o-r&&(p=za(r),p>u&&(p=u));if(3<=p)if(k=ea(o-t,p-3),u-=p,p<=x){p--;do o++,la();while(0!=--p);o++}else o+=p,p=0,n=h[o]&255,n=(n<<5^h[o+1]&255)&8191;else k=ea(0,h[o]&255),u--,o++;k&&(ma(0),q=o);for(;262>u&&!G;)ta()}else for(;0!=u&&null==
b;){la();C=p;s=t;p=2;0!=r&&C<x&&32506>=o-r&&(p=za(r),p>u&&(p=u),3==p&&4096<o-t&&p--);if(3<=C&&p<=C){k=ea(o-1-s,C-3);u-=C-1;C-=2;do o++,la();while(0!=--C);A=0;p=2;o++;k&&(ma(0),q=o)}else 0!=A?ea(0,h[o-1]&255)&&(ma(0),q=o):A=1,o++,u--;for(;262>u&&!G;)ta()}0==u&&(0!=A&&ea(0,h[o-1]&255),ma(1),j=!0);return z+Da(a,z+c,e-z)},Da=function(c,d,j){var h,k,l;for(h=0;null!=b&&h<j;){k=j-h;k>b.len&&(k=b.len);for(l=0;l<k;l++)c[d+h+l]=b.ptr[b.off+l];b.off+=k;b.len-=k;h+=k;0==b.len&&(k=b,b=b.next,k.next=a,a=k)}if(h==
j)return h;if(g<f){k=j-h;k>f-g&&(k=f-g);for(l=0;l<k;l++)c[d+h+l]=e[g+l];g+=k;h+=k;f==g&&(f=g=0)}return h},Ca=function(){var a;for(a=0;286>a;a++)K[a].fc=0;for(a=0;30>a;a++)N[a].fc=0;for(a=0;19>a;a++)I[a].fc=0;K[256].fc=1;Y=T=ha=oa=U=Z=0;ba=1},ua=function(a,b){for(var c=F[b],d=b<<1;d<=E;){d<E&&xa(a,F[d+1],F[d])&&d++;if(xa(a,c,F[d]))break;F[b]=F[d];b=d;d<<=1}F[b]=c},Aa=function(a,b){var c=Array(16),d=0,e;for(e=1;15>=e;e++)d=d+L[e-1]<<1,c[e]=d;for(d=0;d<=b;d++)e=a[d].dl,0!=e&&(a[d].fc=Ba(c[e]++,e))},
va=function(a){var b=a.dyn_tree,c=a.static_tree,d=a.elems,e,f=-1,g=d;E=0;B=573;for(e=0;e<d;e++)0!=b[e].fc?(F[++E]=f=e,Q[e]=0):b[e].dl=0;for(;2>E;)e=F[++E]=2>f?++f:0,b[e].fc=1,Q[e]=0,U--,null!=c&&(Z-=c[e].dl);a.max_code=f;for(e=E>>1;1<=e;e--)ua(b,e);do e=F[1],F[1]=F[E--],ua(b,1),c=F[1],F[--B]=e,F[--B]=c,b[g].fc=b[e].fc+b[c].fc,Q[g]=Q[e]>Q[c]+1?Q[e]:Q[c]+1,b[e].dl=b[c].dl=g,F[1]=g++,ua(b,1);while(2<=E);F[--B]=F[1];g=a.dyn_tree;e=a.extra_bits;var d=a.extra_base,c=a.max_code,j=a.max_length,h=a.static_tree,
k,l,m,n,J=0;for(l=0;15>=l;l++)L[l]=0;g[F[B]].dl=0;for(a=B+1;573>a;a++)k=F[a],l=g[g[k].dl].dl+1,l>j&&(l=j,J++),g[k].dl=l,k>c||(L[l]++,m=0,k>=d&&(m=e[k-d]),n=g[k].fc,U+=n*(l+m),null!=h&&(Z+=n*(h[k].dl+m)));if(0!=J){do{for(l=j-1;0==L[l];)l--;L[l]--;L[l+1]+=2;L[j]--;J-=2}while(0<J);for(l=j;0!=l;l--)for(k=L[l];0!=k;)e=F[--a],e>c||(g[e].dl!=l&&(U+=(l-g[e].dl)*g[e].fc,g[e].fc=l),k--)}Aa(b,f)},Ea=function(a,b){var c,d=-1,e,f=a[0].dl,g=0,j=7,h=4;0==f&&(j=138,h=3);a[b+1].dl=65535;for(c=0;c<=b;c++)e=f,f=a[c+
1].dl,++g<j&&e==f||(g<h?I[e].fc+=g:0!=e?(e!=d&&I[e].fc++,I[16].fc++):10>=g?I[17].fc++:I[18].fc++,g=0,d=e,0==f?(j=138,h=3):e==f?(j=6,h=3):(j=7,h=4))},Fa=function(a,b){var c,d=-1,e,f=a[0].dl,g=0,j=7,h=4;0==f&&(j=138,h=3);for(c=0;c<=b;c++)if(e=f,f=a[c+1].dl,!(++g<j&&e==f)){if(g<h){do V(e,I);while(0!=--g)}else 0!=e?(e!=d&&(V(e,I),g--),V(16,I),M(g-3,2)):10>=g?(V(17,I),M(g-3,3)):(V(18,I),M(g-11,7));g=0;d=e;0==f?(j=138,h=3):e==f?(j=6,h=3):(j=7,h=4)}},ma=function(a){var b,c,d,e;e=o-q;ga[oa]=Y;va(P);va(J);
Ea(K,P.max_code);Ea(N,J.max_code);va(S);for(d=18;3<=d&&!(0!=I[wa[d]].dl);d--);U+=3*(d+1)+14;b=U+3+7>>3;c=Z+3+7>>3;c<=b&&(b=c);if(e+4<=b&&0<=q){M(0+a,3);Ga();ka(e);ka(~e);for(d=0;d<e;d++)ja(h[q+d])}else if(c==b)M(2+a,3),Ha(O,W);else{M(4+a,3);e=P.max_code+1;b=J.max_code+1;d+=1;M(e-257,5);M(b-1,5);M(d-4,4);for(c=0;c<d;c++)M(I[wa[c]].dl,3);Fa(K,e-1);Fa(N,b-1);Ha(K,N)}Ca();0!=a&&Ga()},ea=function(a,b){l[T++]=b;0==a?K[b].fc++:(a--,K[aa[b]+256+1].fc++,N[(256>a?X[a]:X[256+(a>>7)])&255].fc++,k[ha++]=a,Y|=
ba);ba<<=1;0==(T&7)&&(ga[oa++]=Y,Y=0,ba=1);if(2<w&&0==(T&4095)){var c=8*T,d=o-q,e;for(e=0;30>e;e++)c+=N[e].fc*(5+da[e]);c>>=3;if(ha<parseInt(T/2)&&c<parseInt(d/2))return!0}return 8191==T||8192==ha},Ha=function(a,b){var c,d=0,e=0,f=0,g=0,j,h;if(0!=T){do 0==(d&7)&&(g=ga[f++]),c=l[d++]&255,0==(g&1)?V(c,a):(j=aa[c],V(j+256+1,a),h=ra[j],0!=h&&(c-=na[j],M(c,h)),c=k[e++],j=(256>c?X[c]:X[256+(c>>7)])&255,V(j,b),h=da[j],0!=h&&(c-=fa[j],M(c,h))),g>>=1;while(d<T)}V(256,a)},M=function(a,b){v>16-b?(m|=a<<v,ka(m),
m=a>>16-v,v+=b-16):(m|=a<<v,v+=b)},Ba=function(a,b){var c=0;do c|=a&1,a>>=1,c<<=1;while(0<--b);return c>>1},Ga=function(){8<v?ka(m):0<v&&ja(m);v=m=0};window.RawDeflate||(RawDeflate={});RawDeflate.deflate=function(f,g){var j,m;ia=f;pa=0;"undefined"==typeof g&&(g=6);(j=g)?1>j?j=1:9<j&&(j=9):j=6;w=j;G=d=!1;if(null==e){a=b=c=null;e=Array(8192);h=Array(65536);k=Array(8192);l=Array(32832);y=Array(65536);K=Array(573);for(j=0;573>j;j++)K[j]=new ca;N=Array(61);for(j=0;61>j;j++)N[j]=new ca;O=Array(288);for(j=
0;288>j;j++)O[j]=new ca;W=Array(30);for(j=0;30>j;j++)W[j]=new ca;I=Array(39);for(j=0;39>j;j++)I[j]=new ca;P=new qa;J=new qa;S=new qa;L=Array(16);F=Array(573);Q=Array(573);aa=Array(256);X=Array(512);na=Array(29);fa=Array(30);ga=Array(1024)}for(var n=Array(1024),r=[];0<(j=Ka(n,0,n.length));){var o=Array(j);for(m=0;m<j;m++)o[m]=String.fromCharCode(n[m]);r[r.length]=o.join("")}ia=null;return r.join("")}})();
(function(){var a,b,c=null,d,e,f,g,j,h,k,l,y,m,v,q,n,r,s=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],t=[16,17,18,0,8,7,9,6,10,
5,11,4,12,3,13,2,14,1,15],G=function(){this.list=this.next=null},u=function(){this.n=this.b=this.e=0;this.t=null},D=function(a,b,c,d,e,f){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var g=Array(this.BMAX+1),j,h,l,k,m,n,r,o=Array(this.BMAX+1),v,y,q,p=new u,A=Array(this.BMAX);k=Array(this.N_MAX);var w,t=Array(this.BMAX+1),x,s,C;C=this.root=null;for(m=0;m<g.length;m++)g[m]=0;for(m=0;m<o.length;m++)o[m]=0;for(m=0;m<A.length;m++)A[m]=null;for(m=0;m<k.length;m++)k[m]=0;for(m=0;m<t.length;m++)t[m]=
0;j=256<b?a[256]:this.BMAX;v=a;y=0;m=b;do g[v[y]]++,y++;while(0<--m);if(g[0]==b)this.root=null,this.status=this.m=0;else{for(n=1;n<=this.BMAX&&!(0!=g[n]);n++);r=n;f<n&&(f=n);for(m=this.BMAX;0!=m&&!(0!=g[m]);m--);l=m;f>m&&(f=m);for(x=1<<n;n<m;n++,x<<=1)if(0>(x-=g[n])){this.status=2;this.m=f;return}if(0>(x-=g[m]))this.status=2,this.m=f;else{g[m]+=x;t[1]=n=0;v=g;y=1;for(q=2;0<--m;)t[q++]=n+=v[y++];v=a;m=y=0;do if(0!=(n=v[y++]))k[t[n]++]=m;while(++m<b);b=t[l];t[0]=m=0;v=k;y=0;k=-1;w=o[0]=0;q=null;for(s=
0;r<=l;r++)for(a=g[r];0<a--;){for(;r>w+o[1+k];){w+=o[1+k];k++;s=(s=l-w)>f?f:s;if((h=1<<(n=r-w))>a+1){h-=a+1;for(q=r;++n<s&&!((h<<=1)<=g[++q]);)h-=g[q]}w+n>j&&w<j&&(n=j-w);s=1<<n;o[1+k]=n;q=Array(s);for(h=0;h<s;h++)q[h]=new u;C=null==C?this.root=new G:C.next=new G;C.next=null;C.list=q;A[k]=q;0<k&&(t[k]=m,p.b=o[k],p.e=16+n,p.t=q,n=(m&(1<<w)-1)>>w-o[k],A[k-1][n].e=p.e,A[k-1][n].b=p.b,A[k-1][n].n=p.n,A[k-1][n].t=p.t)}p.b=r-w;y>=b?p.e=99:v[y]<c?(p.e=256>v[y]?16:15,p.n=v[y++]):(p.e=e[v[y]-c],p.n=d[v[y++]-
c]);h=1<<r-w;for(n=m>>w;n<s;n+=h)q[n].e=p.e,q[n].b=p.b,q[n].n=p.n,q[n].t=p.t;for(n=1<<r-1;0!=(m&n);n>>=1)m^=n;for(m^=n;(m&(1<<w)-1)!=t[k];)w-=o[k],k--}this.m=o[1];this.status=0!=x&&1!=l?1:0}}},x=function(a){for(;g<a;)f|=(n.length==r?-1:n.charCodeAt(r++)&255)<<g,g+=8},w=function(a){return f&s[a]},H=function(a){f>>=a;g-=a},K=function(c,d,e){var f,g,h;if(0==e)return 0;for(h=0;;){x(v);g=y.list[w(v)];for(f=g.e;16<f;){if(99==f)return-1;H(g.b);f-=16;x(f);g=g.t[w(f)];f=g.e}H(g.b);if(16==f)b&=32767,c[d+h++]=
a[b++]=g.n;else{if(15==f)break;x(f);k=g.n+w(f);H(f);x(q);g=m.list[w(q)];for(f=g.e;16<f;){if(99==f)return-1;H(g.b);f-=16;x(f);g=g.t[w(f)];f=g.e}H(g.b);x(f);l=b-g.n-w(f);for(H(f);0<k&&h<e;)k--,l&=32767,b&=32767,c[d+h++]=a[b++]=a[l++]}if(h==e)return e}j=-1;return h},N=function(a,b,c){var d,e,f,g,j,h,k,l=Array(316);for(d=0;d<l.length;d++)l[d]=0;x(5);h=257+w(5);H(5);x(5);k=1+w(5);H(5);x(4);d=4+w(4);H(4);if(286<h||30<k)return-1;for(e=0;e<d;e++)x(3),l[t[e]]=w(3),H(3);for(;19>e;e++)l[t[e]]=0;v=7;e=new D(l,
19,19,null,null,v);if(0!=e.status)return-1;y=e.root;v=e.m;g=h+k;for(d=f=0;d<g;)if(x(v),j=y.list[w(v)],e=j.b,H(e),e=j.n,16>e)l[d++]=f=e;else if(16==e){x(2);e=3+w(2);H(2);if(d+e>g)return-1;for(;0<e--;)l[d++]=f}else{17==e?(x(3),e=3+w(3),H(3)):(x(7),e=11+w(7),H(7));if(d+e>g)return-1;for(;0<e--;)l[d++]=0;f=0}v=9;e=new D(l,h,257,A,p,v);0==v&&(e.status=1);if(0!=e.status)return-1;y=e.root;v=e.m;for(d=0;d<k;d++)l[d]=l[d+h];q=6;e=new D(l,k,0,C,o,q);m=e.root;q=e.m;return 0==q&&257<h||0!=e.status?-1:K(a,b,c)},
O=function(n,r,t){var s,u;for(s=0;s<t&&!(h&&-1==j);){if(0<k){if(0!=j)for(;0<k&&s<t;)k--,l&=32767,b&=32767,n[r+s++]=a[b++]=a[l++];else{for(;0<k&&s<t;)k--,b&=32767,x(8),n[r+s++]=a[b++]=w(8),H(8);0==k&&(j=-1)}if(s==t)break}if(-1==j){if(h)break;x(1);0!=w(1)&&(h=!0);H(1);x(2);j=w(2);H(2);y=null;k=0}switch(j){case 0:u=n;var G=r+s,F=t-s,E=void 0,E=g&7;H(E);x(16);E=w(16);H(16);x(16);if(E!=(~f&65535))u=-1;else{H(16);k=E;for(E=0;0<k&&E<F;)k--,b&=32767,x(8),u[G+E++]=a[b++]=w(8),H(8);0==k&&(j=-1);u=E}break;case 1:if(null!=
y)u=K(n,r+s,t-s);else a:{u=n;G=r+s;F=t-s;if(null==c){for(var B=void 0,E=Array(288),B=void 0,B=0;144>B;B++)E[B]=8;for(;256>B;B++)E[B]=9;for(;280>B;B++)E[B]=7;for(;288>B;B++)E[B]=8;e=7;B=new D(E,288,257,A,p,e);if(0!=B.status){alert("HufBuild error: "+B.status);u=-1;break a}c=B.root;e=B.m;for(B=0;30>B;B++)E[B]=5;zip_fixed_bd=5;B=new D(E,30,0,C,o,zip_fixed_bd);if(1<B.status){c=null;alert("HufBuild error: "+B.status);u=-1;break a}d=B.root;zip_fixed_bd=B.m}y=c;m=d;v=e;q=zip_fixed_bd;u=K(u,G,F)}break;case 2:u=
null!=y?K(n,r+s,t-s):N(n,r+s,t-s);break;default:u=-1}if(-1==u)return h?0:-1;s+=u}return s};window.RawDeflate||(RawDeflate={});RawDeflate.inflate=function(c){var d;null==a&&(a=Array(65536));g=f=b=0;j=-1;h=!1;k=l=0;y=null;n=c;r=0;for(var e=Array(1024),m=[];0<(c=O(e,0,e.length));){var o=Array(c);for(d=0;d<c;d++)o[d]=String.fromCharCode(e[d]);m[m.length]=o.join("")}n=null;return m.join("")}})();
function GenomeViewer(a,b,c){var d=this;this.id="GenomeViewer"+Math.round(1E4*Math.random());this.menuBar=null;this.width=$(document).width();this.height=$(document).height();this.targetId=null;this.species="hsa";this.speciesName="Homo sapiens";this.increment=5;this.zoom=100;null!=a&&(this.targetId=a);null!=b&&(this.species=b.species,this.speciesName=b.name,this.chromosome=b.chromosome,this.position=parseInt(b.position));null!=c&&(null!=c.toolbar&&(this.toolbar=c.toolbar),null!=c.width&&(this.width=
c.width),null!=c.height&&(this.height=c.height),null!=c.availableSpecies&&this.setSpeciesMenu(c.availableSpecies),null!=c.chromosome&&(this.chromosome=c.chromosome),null!=c.position&&(this.position=parseInt(c.position)));this.onSpeciesChange=new Event;this.onLocationChange=new Event;this.afterLocationChange=new Event;this.afterRender=new Event;this.onLocationChange.addEventListener(function(a,b){d.setLoc(b)});console.log(this.width+"x"+this.height);console.log(this.targetId);console.log(this.id)}
GenomeViewer.prototype.draw=function(){this.render()};
GenomeViewer.prototype.render=function(){var a=this,b=Ext.create("Ext.container.Container",{id:this.id+"container",renderTo:this.targetId,width:this.width,height:this.height,cls:"x-unselectable",layout:{type:"vbox",align:"stretch"},region:"center",margins:"0 0 0 0"});null!=this.toolbar&&b.insert(0,this.toolbar);var c=this._drawRegionPanel();c.on("afterrender",function(){var b=$("#"+a.id+"tracksSvg")[0];a.trackSvgLayout=new TrackSvgLayout(b,{width:a.width-18,position:a.position,chromosome:a.chromosome,
zoom:a.zoom});a.trackSvgLayout.onMove.addEventListener(function(b,c){a.onLocationChange.notify({position:c,sender:"trackSvgLayout"})});b=$("#"+a.id+"regionSvg")[0];a.trackSvgLayout2=new TrackSvgLayout(b,{width:a.width-18,position:a.position,chromosome:a.chromosome,zoom:a.zoom,zoomOffset:40,parentLayout:a.trackSvgLayout});a.afterRender.notify()});b.insert(1,this._getNavigationBar());b.insert(2,this._drawKaryotypePanel().hide());b.insert(3,this._drawChromosomePanel());b.insert(4,this._drawTracksPanel());
b.insert(5,this._getBottomBar());b.insert(3,c);Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position))};GenomeViewer.prototype.setSize=function(a,b){Ext.getCmp(this.id+"container").setSize(a,b)};
GenomeViewer.prototype.setLoc=function(a){console.log(a.sender);switch(a.sender){case "setSpecies":this.species=a.species;this.speciesName=a.name;this.position=a.position;this.chromosome=a.chromosome;Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome);Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));Ext.getCmp(this.id+"speciesMenuButton").setText(this.speciesName);
Ext.example.msg("Species",this.speciesName+" selected.");this._updateChrStore();this.trackSvgLayout.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});this.trackSvgLayout2.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});this.chromosomeWidget.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});this.karyotypeWidget.setLocation({chromosome:this.chromosome,species:this.species,position:this.position});
this.onSpeciesChange.notify();break;case "_getChromosomeMenu":this.chromosome!=a.chromosome&&(this.chromosome=a.chromosome,this.trackSvgLayout.setLocation({chromosome:this.chromosome}),this.trackSvgLayout2.setLocation({chromosome:this.chromosome}),this.chromosomeWidget.setLocation({chromosome:this.chromosome}),this.karyotypeWidget.setLocation({chromosome:this.chromosome,position:this.position}));Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));Ext.getCmp(this.id+
"chromosomeMenuButton").setText("Chromosome "+this.chromosome);Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome);break;case "GoButton":var b={};null!=a.position&&this.position!=a.position&&(this.position=a.position,b.position=this.position);null!=a.chromosome&&this.chromosome!=a.chromosome&&(this.chromosome=a.chromosome,b.chromosome=this.chromosome,Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome),Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+
this.chromosome));0<Object.keys(b).length&&(this.trackSvgLayout.setLocation(b),this.trackSvgLayout2.setLocation(b),this.chromosomeWidget.setLocation(b),this.karyotypeWidget.setLocation(b));break;case "KaryotypePanel":b={};null!=a.position&&this.position!=a.position&&(this.position=a.position,b.position=this.position);null!=a.chromosome&&this.chromosome!=a.chromosome&&(this.chromosome=a.chromosome,b.chromosome=this.chromosome,Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome),
Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome));0<Object.keys(b).length&&(this.trackSvgLayout.setLocation(b),this.trackSvgLayout2.setLocation(b),this.chromosomeWidget.setLocation(b),Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position)),this.karyotypeWidget.updatePositionBox({chromosome:this.chromosome,position:this.position}));break;case "ChromosomeWidget":this.position=a.position;this.trackSvgLayout.setLocation({position:this.position});
this.trackSvgLayout2.setLocation({position:this.position});this.karyotypeWidget.setLocation({position:this.position});Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));break;case "trackSvgLayout":this.position-=a.position;Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position));this.chromosomeWidget.setLocation({position:this.position});this.karyotypeWidget.setLocation({position:this.position});break;default:b={},null!=a.species&&
(this.species=a.species,b.species=this.species,Ext.example.msg("Species",this.speciesName+" selected."),this.onSpeciesChange.notify()),null!=a.name&&(this.speciesName=a.name,b.speciesName=this.speciesName),null!=a.position&&(this.position=a.position,b.position=this.position),null!=a.chromosome&&(this.chromosome=a.chromosome,b.chromosome=this.chromosome),Ext.getCmp(this.id+"chromosomeMenuButton").setText("Chromosome "+this.chromosome),Ext.getCmp(this.id+"chromosomePanel").setTitle("Chromosome "+this.chromosome),
Ext.getCmp(this.id+"tbCoordinate").setValue(this.chromosome+":"+Math.ceil(this.position)),Ext.getCmp(this.id+"speciesMenuButton").setText(this.speciesName),this._updateChrStore(),this.trackSvgLayout.setLocation(b),this.trackSvgLayout2.setLocation(b),this.chromosomeWidget.setLocation(b),this.karyotypeWidget.setLocation(b)}};
GenomeViewer.prototype._getNavigationBar=function(){var a=this,b=Ext.create("Ext.data.Store",{fields:["xrefId","displayId","description"]}),c=Ext.create("Ext.form.field.ComboBox",{id:this.id+"quickSearch",displayField:"displayId",valueField:"displayId",emptyText:"Quick search: gene, transcript",hideTrigger:!0,width:200,store:b,queryMode:"local",queryDelay:500,listeners:{change:function(){var c=this.getValue(),e=2;c&&"ENS"==c.substring(0,3).toUpperCase()&&(e=10);c&&c.length>e&&$.ajax({url:(new CellBaseManager).host+
"/latest/"+a.species+"/feature/id/"+this.getValue()+"/starts_with?of=json",success:function(a){a=JSON.parse(a);b.loadData(a[0])},error:function(a,b){console.log(b)}})},select:function(){a._handleNavigationBar("GoToGene")}}});return Ext.create("Ext.toolbar.Toolbar",{id:this.id+"navToolbar",cls:"bio-toolbar",border:!0,height:35,enableOverflow:!0,items:[{id:this.id+"speciesMenuButton",text:this.speciesName,menu:this._getSpeciesMenu()},{id:this.id+"chromosomeMenuButton",text:"Chromosome",menu:this._getChromosomeMenu()},
"-",{id:this.id+"karyotypeButton",text:"Karyotype",enableToggle:!0,pressed:!1,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"karyotypePanel").show():Ext.getCmp(a.id+"karyotypePanel").hide()}},{id:this.id+"ChromosomeToggleButton",text:"Chromosome",enableToggle:!0,pressed:!0,toggleHandler:function(){this.pressed?Ext.getCmp(a.id+"chromosomePanel").show():Ext.getCmp(a.id+"chromosomePanel").hide()}},{id:this.id+"RegionToggleButton",text:"Region",enableToggle:!0,pressed:!0,toggleHandler:function(){this.pressed?
Ext.getCmp(a.id+"regionPanel").show():Ext.getCmp(a.id+"regionPanel").hide()}},"-",{id:this.id+"zoomOutButton",margin:"0 0 0 10",iconCls:"icon-zoom-out",listeners:{click:{fn:function(){var b=Ext.getCmp(a.id+"zoomSlider").getValue();Ext.getCmp(a.id+"zoomSlider").setValue(b-a.increment)}}}},this._getZoomSlider(),{id:this.id+"zoomInButton",margin:"0 5 0 0",iconCls:"icon-zoom-in",listeners:{click:{fn:function(){var b=Ext.getCmp(a.id+"zoomSlider").getValue();Ext.getCmp(a.id+"zoomSlider").setValue(b+a.increment)}}}},
"-",{id:this.id+"positionLabel",xtype:"label",text:"Position:",margins:"0 0 0 10"},{id:this.id+"tbCoordinate",xtype:"textfield",width:120,text:this.chromosome+":"+this.position,listeners:{specialkey:function(b,c){c.getKey()==c.ENTER&&a._handleNavigationBar("Go")}}},{id:this.id+"GoButton",text:"Go",handler:function(){a._handleNavigationBar("Go")}},"->",c,{id:this.id+"GoToGeneButton",iconCls:"icon-find",handler:function(){a._handleNavigationBar("GoToGene")}}]})};
GenomeViewer.prototype._getSpeciesMenu=function(){null==this._specieMenu&&(this._specieMenu=Ext.create("Ext.menu.Menu",{id:this.id+"_specieMenu",margin:"0 0 10 0",floating:!0,items:[]}));return this._specieMenu};GenomeViewer.prototype.setSpeciesMenu=function(a){var b=this,c=this._getSpeciesMenu();c.hide();c.removeAll();for(var d=0;d<a.length;d++)c.add({id:this.id+a[d].name,text:a[d].name,speciesObj:a[d],handler:function(a){b.setSpecies(a.speciesObj)}})};
GenomeViewer.prototype.setSpecies=function(a){a.sender="setSpecies";this.onLocationChange.notify(a)};
GenomeViewer.prototype._getChromosomeMenu=function(){var a=this,b=Ext.create("Ext.data.Store",{id:this.id+"chrStore",fields:["name"],autoLoad:!1}),c=Ext.create("Ext.view.View",{id:this.id+"chrView",width:125,style:"background-color:#fff",store:b,selModel:{mode:"SINGLE",listeners:{selectionchange:function(b,c){0<c.length&&a.onLocationChange.notify({sender:"_getChromosomeMenu",chromosome:c[0].data.name});d.hide()}}},cls:"list",trackOver:!0,overItemCls:"list-item-hover",itemSelector:".chromosome-item",
tpl:'<tpl for="."><div style="float:left" class="chromosome-item">{name}</div></tpl>'}),d=Ext.create("Ext.menu.Menu",{id:this.id+"chromosomeMenu",almacen:b,items:[c]});this._updateChrStore();return d};
GenomeViewer.prototype._updateChrStore=function(){var a=Ext.getStore(this.id+"chrStore");Ext.getCmp(this.id+"chrView");var b=new CellBaseManager(this.species);b.get("feature","karyotype","none","chromosome");b.success.addEventListener(function(b,d){var e=[];d.result.sort(function(a,b){for(var c=!0,d=0;d<a.length&&!0==c;d++)isNaN(a[d])&&(c=!1);return!c?1:a-b});for(var f=0;f<d.result.length;f++)e.push({name:d.result[f]});a.loadData(e)})};
GenomeViewer.prototype._getZoomSlider=function(){var a=this;null==this._zoomSlider&&(this._zoomSlider=Ext.create("Ext.slider.Single",{id:this.id+"zoomSlider",width:200,minValue:0,maxValue:100,value:this.zoom,useTips:!0,increment:this.increment,tipText:function(a){return Ext.String.format("<b>{0}%</b>",a.value)}}),this._zoomSlider.on({change:{fn:function(b,c){a._handleNavigationBar("ZOOM",c)},buffer:300}}));return this._zoomSlider};
GenomeViewer.prototype._disableZoomElements=function(){Ext.getCmp(this.id+"zoomSlider").disable();Ext.getCmp(this.id+"zoomOutButton").disable();Ext.getCmp(this.id+"zoomInButton").disable()};GenomeViewer.prototype._enableZoomElements=function(){Ext.getCmp(this.id+"zoomSlider").enable();Ext.getCmp(this.id+"zoomOutButton").enable();Ext.getCmp(this.id+"zoomInButton").enable()};
GenomeViewer.prototype.setZoom=function(a){this.zoom=a;this._getZoomSlider().setValue(a);null!=this.trackSvgLayout&&(this.trackSvgLayout.setZoom(a),this.trackSvgLayout2.setZoom(a));this.chromosomeWidget.setZoom(a)};
GenomeViewer.prototype._handleNavigationBar=function(a,b){"OptionMenuClick"==a&&(this.genomeWidget.showTranscripts=Ext.getCmp("showTranscriptCB").checked,this.genomeWidgetProperties.setShowTranscripts(Ext.getCmp("showTranscriptCB").checked),this.refreshMasterGenomeViewer());"ZOOM"==a&&this.setZoom(b);"GoToGene"==a&&this.openGeneListWidget(Ext.getCmp(this.id+"quickSearch").getValue());if("+"==a){var c=this.zoom;100>c&&this.setZoom(c+this.increment)}"-"==a&&(c=this.zoom,5<=c&&this.setZoom(c-this.increment));
if("Go"==a){var d=Ext.getCmp(this.id+"tbCoordinate").getValue(),c=parseInt(d.split(":")[1]),d=d.split(":")[0];isNaN(c)||0>c?Ext.getCmp(this.id+"tbCoordinate").markInvalid("Position must be a positive number"):-1==Ext.getCmp(this.id+"chromosomeMenu").almacen.find("name",d)?Ext.getCmp(this.id+"tbCoordinate").markInvalid("Invalid chromosome"):this.onLocationChange.notify({chromosome:d,position:c,sender:"GoButton"})}};
GenomeViewer.prototype._drawKaryotypePanel=function(){var a=this;return Ext.create("Ext.panel.Panel",{id:this.id+"karyotypePanel",height:200,title:"Karyotype",border:!1,margin:"0 0 1 0",cls:"border-bot panel-border-top",html:'<div id="'+this.id+'karyotypeSvg" style="margin-top:2px"></div>',listeners:{afterrender:function(){var b=$("#"+a.id+"karyotypeSvg")[0];a.karyotypeWidget=new KaryotypeWidget(b,{width:a.width,height:168,species:a.species,chromosome:a.chromosome,zoom:a.zoom,position:a.position});
a.karyotypeWidget.onClick.addEventListener(function(b,d){a.onLocationChange.notify({position:d.position,chromosome:d.chromosome,sender:"KaryotypePanel"})});a.karyotypeWidget.drawKaryotype()}}})};
GenomeViewer.prototype._drawChromosomePanel=function(){var a=this;return Ext.create("Ext.panel.Panel",{id:this.id+"chromosomePanel",height:95,title:"Chromosome",border:!1,margin:"0 0 1 0",cls:"border-bot panel-border-top",html:'<div id="'+this.id+'chromosomeSvg" style="margin-top:2px"></div>',listeners:{afterrender:function(){var b=$("#"+a.id+"chromosomeSvg")[0];a.chromosomeWidget=new ChromosomeWidget(b,{width:a.width,height:65,species:a.species,chromosome:a.chromosome,zoom:a.zoom,position:a.position});
a.chromosomeWidget.onClick.addEventListener(function(b,d){a.onLocationChange.notify({position:d,sender:"ChromosomeWidget"})});a.chromosomeWidget.drawChromosome()}}})};GenomeViewer.prototype._drawRegionPanel=function(){return Ext.create("Ext.panel.Panel",{id:this.id+"regionPanel",height:150,title:"Region",border:!1,autoScroll:!0,margin:"0 0 1 0",cls:"border-bot panel-border-top x-unselectable",html:'<div id="'+this.id+'regionSvg" style="margin-top:2px"></div>'})};
GenomeViewer.prototype._drawTracksPanel=function(){return Ext.create("Ext.panel.Panel",{id:this.id+"tracksPanel",title:"Detailed Information",autoScroll:!0,cls:"x-unselectable",flex:1,html:'<div id = "'+this.id+'tracksSvg"></div>'})};GenomeViewer.prototype.addTrack=function(a,b){this.trackSvgLayout.addTrack(a,b)};GenomeViewer.prototype.removeTrack=function(a){this.trackSvgLayout.removeTrack(a)};GenomeViewer.prototype.showTrack=function(a){this.trackSvgLayout._showTrack(a)};
GenomeViewer.prototype.hideTrack=function(a){this.trackSvgLayout._hideTrack(a)};GenomeViewer.prototype.checkRenderedTrack=function(a){return this.trackSvgLayout.swapHash[a]?!0:!1};
GenomeViewer.prototype._getBottomBar=function(){var a=new LegendPanel({title:"Gene legend"}),b=new LegendPanel({title:"SNP legend"}),c=Ext.create("Ext.toolbar.TextItem",{id:this.id+"versionLabel",text:""}),d=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"uxTaskbar",winMgr:new Ext.ZIndexManager,enableOverflow:!0,cls:"bio-hiddenbar",height:28,flex:1}),a=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"legendBar",cls:"bio-hiddenbar",width:220,height:28,items:["-",a.getButton(GENE_BIOTYPE_COLORS),b.getButton(SNP_BIOTYPE_COLORS),
"->",c]});return Ext.create("Ext.container.Container",{id:this.id+"bottomBar",layout:"hbox",cls:"bio-botbar x-unselectable",height:30,border:!0,items:[d,a]})};
GenomeViewer.prototype.openListWidget=function(a){var b=this;console.log(a.query);var c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){var f=new GenomicListWidget(b.species,{title:a.title,gridFields:a.gridField,viewer:b});f.draw(e);f.onSelected.addEventListener(function(a,c){null!=c&&null!=c.chromosome&&(b.chromosome!=c.chromosome||b.position!=c.start)&&b.setLoc({sender:"",chromosome:c.chromosome,position:c.start})});f.onTrackAddAction.addEventListener(function(a,c){var d=
new TrackData(c.fileName,{adapter:c.adapter});b.trackSvgLayout.addTrack(d,{id:c.fileName,featuresRender:"MultiFeatureRender",height:150,visibleRange:{start:0,end:100},featureTypes:FEATURE_TYPES})})});c.get(a.category,a.subcategory,a.query,a.resource,a.params)};GenomeViewer.prototype.openGeneListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"gene",title:"Gene List"})};GenomeViewer.prototype.openTranscriptListWidget=function(){};
GenomeViewer.prototype.openExonListWidget=function(){};GenomeViewer.prototype.openSNPListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"snp",title:"SNP List",gridField:"name,variantAlleles,ancestralAllele,mapWeight,position,sequence".split(",")})};GenomeViewer.prototype.openGOListWidget=function(a){this.openListWidget({category:"feature",subcategory:"id",query:a.toString(),resource:"gene",title:"Gene List by GO"})};
function TrackSvg(a,b){this.args=b;this.parent=a;this.y=25;this.height=50;this.width=200;this.title="track";this.renderedArea={};this.lienzo=7E6;this.pixelPosition=this.lienzo/2;this.histogramZoom=-1E3;this.titleVisibility="visible";this.settings={};this.closable=!0;this.types=FEATURE_TYPES;if(null!=b&&(null!=b.title&&(this.title=b.title),null!=b.id&&(this.id=b.id),null!=b.trackData&&(this.trackData=b.trackData),null!=b.clase&&(this.clase=b.clase),null!=b.width&&(this.width=b.width),null!=b.height&&
(this.height=b.height),null!=b.position&&(this.position=b.position),null!=b.zoom&&(this.zoom=b.zoom),null!=b.pixelBase&&(this.pixelBase=b.pixelBase),null!=this.closable&&(this.closable=b.closable),null!=b.histogramZoom&&(this.histogramZoom=b.histogramZoom),null!=b.transcriptZoom&&(this.transcriptZoom=b.transcriptZoom),null!=b.featureTypes&&(this.featureTypes=b.featureTypes),null!=b.titleVisibility&&(this.titleVisibility=b.titleVisibility),null!=b.featuresRender)){switch(b.featuresRender){case "MultiFeatureRender":this.featuresRender=
this.MultiFeatureRender;break;case "SequenceRender":this.featuresRender=this.SequenceRender;break;default:this.featuresRender=this.MultiFeatureRender}this.defaultRender=this.featuresRender}null==this.settings.closable&&(this.settings.closable=!0);this.rendered=!1;this.transcript=this.histogram=this.interval=null}TrackSvg.prototype.setY=function(a){this.y=a};TrackSvg.prototype.getHeight=function(){return this.height};
TrackSvg.prototype.setHeight=function(a){this.height=a;this.rendered&&(this.main.setAttribute("height",a),this.features.setAttribute("height",a))};
TrackSvg.prototype.draw=function(){var a=this,b=SVG.addChild(this.parent,"svg",{id:this.id,x:0,y:this.y,width:this.width,height:this.height}),c=SVG.addChild(b,"svg",{x:-this.pixelPosition,width:this.lienzo,height:this.height}),d=SVG.addChild(b,"g",{visibility:this.titleVisibility}),e=25+5*this.id.length,f=SVG.addChild(d,"rect",{x:0,y:0,width:e,height:22,stroke:"deepSkyBlue","stroke-width":"1",opacity:"0.6",fill:"honeydew"}),g=SVG.addChild(d,"text",{x:4,y:14,"font-size":10,opacity:"0.4",fill:"black"});
g.textContent=this.id;var j=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAPJJREFUOI2llD0OgkAQhb/QExuPQGWIB/A63IAbGLwG0dNQWxPt6GmoELMWzuJk3IUYJ5mQnXlv/nYWnHOEFCgAp7SIYRPiclg5f0SyJkCmqtgBrankBuwVJwMS59xsKAV4Bc7AwwTwOgEXwTmgFD5boI+QnkAn35C/Fz7HSMYTkErXqZynAPYIkAN346giI6wM7g7kfiYbYFAtpJYtuFS1NggPvRejODtLNvvTCW60GaKVmADhSpZmEqgiPBNWbkdVsHg7/+/Jjxv7EP+8sXqwCe+34CX0dlqxe8mE9zV9LbUJUluAl+CvQAI2xtxYjE/8Ak/JC4Cb6l5eAAAAAElFTkSuQmCC",
x:4+e,y:3,width:17,height:17,opacity:"0.6",visibility:"hidden"}),h=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAD9JREFUOI1jYKAhEGBgYJgPxWSB+QwMDP+hmGRDkDWTbAg2zUQbgk8zQUOI0Uyyd2AacAImYk0aNWAwG0AxAABRBSdztC0IxQAAAABJRU5ErkJggg==",x:22+e,y:4,width:16,height:16,opacity:"0.6",visibility:"hidden"}),k=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAERJREFUOI1jYKAx+A/FOAETpTaMGjDYDJjPgIh39PhHF5+Py0BshhCtmRhDCGrGZwjRmrEZQrJmZEPmMzAwCJBrAEEAANCqJXdWrFuyAAAAAElFTkSuQmCC",
x:36+e,y:4,width:16,height:16,opacity:"0.6",visibility:"hidden"}),l=SVG.addChildImage(d,{"xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAJFJREFUOI2tks0NgzAMhb+wAFP05FM2aCdjtDBCLjkxBRO4F4JoAONIfVKkyHk/sl4CQIyRFqpKzvk0/zvCMRSYgU9LEpH9XkpJwFtEgqr+8NJmkozAR45F2N+WcTQyrk3c4lYwbadLXFGFCkx34sHr9lrXrvTLFXrFx509Fd+K3SaeqkwTb1XV5Axvz73/wcQXYitIjMzG550AAAAASUVORK5CYII=",x:52+e,y:4,width:16,height:16,opacity:"0.6",visibility:"hidden"});$(d).mouseenter(function(){f.setAttribute("width",
74+e);f.setAttribute("opacity","1.0");g.setAttribute("opacity","1.0");h.setAttribute("visibility","visible");k.setAttribute("visibility","visible");!0==a.closable&&l.setAttribute("visibility","visible");j.setAttribute("visibility","visible")});$(d).mouseleave(function(){f.setAttribute("width",e);f.setAttribute("opacity","0.6");g.setAttribute("opacity","0.4");h.setAttribute("visibility","hidden");k.setAttribute("visibility","hidden");l.setAttribute("visibility","hidden");j.setAttribute("visibility",
"hidden")});$([h,k,l,j]).mouseover(function(){this.setAttribute("opacity","1.0")});$([h,k,l,j]).mouseleave(function(){this.setAttribute("opacity","0.6")});$(j).mouseover(function(){f.setAttribute("height",44)});$(j).mouseleave(function(){f.setAttribute("height",22)});$(l).click(function(){f.setAttribute("width",e);f.setAttribute("opacity","0.6");g.setAttribute("opacity","0.4");h.setAttribute("visibility","hidden");k.setAttribute("visibility","hidden");l.setAttribute("visibility","hidden");j.setAttribute("visibility",
"hidden")});this.invalidZoomText=SVG.addChild(b,"text",{x:154,y:14,"font-size":10,opacity:"0.6",fill:"black",visibility:"hidden"});this.invalidZoomText.textContent="This level of zoom isn't appropiate for this track";this.main=b;this.titleGroup=d;this.upRect=h;this.downRect=k;this.hideRect=l;this.settingsRect=j;this.features=c;this.rendered=!0};
TrackSvg.prototype.MultiFeatureRender=function(a){var b=this;console.time("Multirender");for(var c=this.width/2,d=function(a,d,e){e=e-d+1;console.log(e);0>e&&(e=Math.abs(e));0==e&&(e=1);var f=b.types[a.featureType],g=f.getColor(a),e=e*b.pixelBase,d=b.pixelPosition+c-(b.position-d)*b.pixelBase;try{var m=Math.max(e,8*f.getLabel(a).length)}catch(v){m=72}for(var q=0,n=12+f.height;;){null==b.renderedArea[q]&&(b.renderedArea[q]=new FeatureBinarySearchTree);var r,s=!1;if("gene"==a.featureType&&null!=a.transcripts){for(var A=
q,s=!0,p=0,C=a.transcripts.length+1;p<C;p++){null==b.renderedArea[A]&&(b.renderedArea[A]=new FeatureBinarySearchTree);s=!b.renderedArea[A].contains({start:d,end:d+m-1});if(!1==s){r=!1;break}A+=24}!0==s&&(r=!0)}else r=b.renderedArea[q].add({start:d,end:d+m-1});if(r){r=SVG.addChild(b.features,"rect",{x:d,y:q,width:e,height:f.height,stroke:"#3B0B0B","stroke-width":0.5,fill:g,cursor:"pointer"});var o=SVG.addChild(b.features,"text",{i:p,x:d,y:n,"font-size":10,opacity:null,fill:"black",cursor:"pointer"});
o.textContent=f.getLabel(a);$([r,o]).qtip({content:{text:b.formatTip({feature:a}),title:b.formatTitleTip({feature:a})},position:{target:"mouse",adjust:{x:15,y:15},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$([r,o]).click(function(){b.showInfoWidget({query:a[f.infoWidgetId],feature:a,featureType:a.featureType})});if(!0==s){A=q+24;q=n+24;p=0;for(C=a.transcripts.length;p<C;p++){null==b.renderedArea[A]&&(b.renderedArea[A]=new FeatureBinarySearchTree);var t=
a.transcripts[p],n=b.pixelPosition+c-(b.position-t.start)*b.pixelBase,s=(t.end-t.start+1)*b.pixelBase,f=b.types[t.featureType],g=f.getColor(t);try{m=Math.max(e,e-(a.end-t.start)*b.pixelBase+7*f.getLabel(t).length)}catch(G){m=72}r=b.renderedArea[A].add({start:d,end:d+m-1});r=SVG.addChild(b.features,"rect",{widgetId:t[f.infoWidgetId],x:n,y:A+2,width:s,height:f.height-3,fill:"gray",cursor:"pointer"});o=SVG.addChild(b.features,"text",{widgetId:t[f.infoWidgetId],x:n,y:q,"font-size":10,opacity:null,fill:"black",
cursor:"pointer"});o.textContent=f.getLabel(t);$([r,o]).qtip({content:{text:b.formatTip({feature:t}),title:b.formatTitleTip({feature:t})},position:{target:"mouse",adjust:{x:15,y:15},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip ui-tooltip-shadow"}});$([r,o]).click(function(){var a=this.getAttribute("widgetId");b.showInfoWidget({query:a,featureType:t.featureType})});r=0;for(n=a.transcripts[p].exonToTranscripts.length;r<n;r++){var s=a.transcripts[p].exonToTranscripts[r],f=b.types[s.exon.featureType],
o=parseInt(s.exon.start),u=parseInt(s.exon.end);SVG.addChild(b.features,"rect",{i:p,x:b.pixelPosition+c-(b.position-o)*b.pixelBase,y:A-1,width:(u-o+1)*b.pixelBase,height:f.height+3,stroke:"gray","stroke-width":1,fill:"white",cursor:"pointer"});var D,x;D=parseInt(s.genomicCodingStart);x=parseInt(s.genomicCodingEnd);t.codingRegionStart>o&&t.codingRegionStart<u?D=parseInt(t.codingRegionStart):t.codingRegionEnd>o&&t.codingRegionEnd<u&&(x=parseInt(t.codingRegionEnd));o=b.pixelPosition+c-(b.position-D)*
b.pixelBase;D=(x-D+1)*b.pixelBase;D=Math.max(0,D);0<D&&SVG.addChild(b.features,"rect",{i:p,x:o,y:A-1,width:D,height:f.height+3,stroke:g,"stroke-width":1,fill:g,cursor:"pointer"});D=0;for(x=3-s.phase;D<x&&10==b.pixelBase&&-1!=s.phase;D++)SVG.addChild(b.features,"rect",{i:p,x:o+10*D,y:A-1,width:b.pixelBase,height:f.height+3,stroke:g,"stroke-width":1,fill:"white",cursor:"pointer"})}A+=24;q+=24}}break}q+=24;n+=24}},e=0,f=a.length;e<f;e++){var g=a[e];d(g,g.start,g.end)}a=24*Object.keys(this.renderedArea).length;
0<a&&this.setHeight(a+10);console.timeEnd("Multirender")};
TrackSvg.prototype.SequenceRender=function(a){var b=this.width/2;if(0<a.length){var c=a[0].sequence,d=a[0].start,a=a[0].start;if(jQuery.browser.mozilla){var e=this.pixelPosition+b-(this.position-a)*this.pixelBase,e=SVG.addChild(this.features,"text",{x:e+1,y:13,"font-size":16,"font-family":"monospace"});e.textContent=c}else for(var f=0;f<c.length;f++)e=this.pixelPosition+b-(this.position-a)*this.pixelBase,a++,e=SVG.addChild(this.features,"text",{x:e+1,y:12,"font-size":12,fill:SEQUENCE_COLORS[c.charAt(f)]}),
e.textContent=c.charAt(f),$(e).qtip({content:(d+f).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),position:{target:"mouse",adjust:{x:15,y:15},viewport:$(window),effect:!1},style:{width:!0,classes:"ui-tooltip-light ui-tooltip-shadow"}})}console.timeEnd("all")};
TrackSvg.prototype.HistogramRender=function(a){var b=this.width/2,c="";if(0<a.length)var d=this.pixelPosition+b-(this.position-a[0].start)*this.pixelBase,c=d+",50 ";for(var d=0,e=a.length;d<e;d++){var f=a[d],g=f.end-f.start,j=this.types[f.featureType].histogramColor,g=g*this.pixelBase,f=this.pixelPosition+b-(this.position-f.start)*this.pixelBase,h=50*a[d].value;null==a[d].value&&console.log(a[d]);c+=f+g/2+","+(50-h)+" "}0<a.length&&(d=this.pixelPosition+b-(this.position-a[a.length-1].start)*this.pixelBase,
c+=d+",50 ");SVG.addChild(this.features,"polyline",{points:c,stroke:"#000000","stroke-width":0.2,fill:j,cursor:"pointer"});this.setHeight(60);console.timeEnd("all")};TrackSvg.prototype.SnpRender=function(){};
TrackSvg.prototype.formatTip=function(a){var b=this.types[a.feature.featureType],c="";switch(a.feature.featureType){case "snp":c+='alleles:&nbsp;<span class="ssel">'+a.feature.alleleString+'</span><br>SO:&nbsp;<span class="emph" style="color:'+b.getColor(a.feature)+';">'+a.feature.displaySoConsequence+"</span><br>";break;case "gene":c+='Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+a.feature.stableId+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+b.getColor(a.feature)+';">'+a.feature.biotype+
"</span><br>";break;case "transcript":c+='Ensembl&nbsp;ID:&nbsp;<span class="ssel">'+a.feature.stableId+'</span><br>biotype:&nbsp;<span class="emph" style="color:'+b.getColor(a.feature)+';">'+a.feature.biotype+"</span><br>"}return c+='start:&nbsp;<span class="emph">'+a.feature.start+'</span><br>end:&nbsp;<span class="emph">'+a.feature.end+'</span><br>strand:&nbsp;<span class="emph">'+a.feature.strand+'</span><br>length:&nbsp;<span class="info">'+(a.feature.end-a.feature.start+1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,
"$1,")+"</span><br>"};
TrackSvg.prototype.formatTitleTip=function(a){var b="",c=function(a){a=a.replace(/_/gi," ");return a=a.charAt(0).toUpperCase()+a.slice(1)};switch(a.feature.featureType){case "snp":b+=c(a.feature.featureType)+' - <span class="ok">'+a.feature.name+"</span>";break;case "gene":b+=c(a.feature.featureType)+' - <span class="ok">'+a.feature.externalName+"</span>";break;case "transcript":b+=c(a.feature.featureType)+' - <span class="ok">'+a.feature.externalName+"</span>";break;case void 0:b+="Feature";break;
default:b+=c(a.feature.featureType)}return b};TrackSvg.prototype.showInfoWidget=function(a){console.log(a);switch(a.featureType){case "gene":(new GeneInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "transcript":(new TranscriptInfoWidget(null,this.trackData.adapter.species)).draw(a);break;case "snp":(new SnpInfoWidget(null,this.trackData.adapter.species)).draw(a)}};
function TrackSvgLayout(a,b){var c=this;this.args=b;this.id=Math.round(1E7*Math.random());this.trackDataList=[];this.trackSvgList=[];this.swapHash={};this.zoomOffset=0;this.parentLayout=null;this.height=25;null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.position&&(this.position=b.position),null!=b.chromosome&&(this.chromosome=b.chromosome),null!=b.zoomOffset&&(this.zoomOffset=b.zoomOffset),null!=b.zoom&&(this.zoom=b.zoom-this.zoomOffset),null!=b.parentLayout&&
(this.parentLayout=b.parentLayout));this._createPixelsbyBase();this.pixelBase=this._getPixelsbyBase(this.zoom);this.halfVirtualBase=3*this.width/2/this.pixelBase;this.onZoomChange=new Event;this.onChromosomeChange=new Event;this.onMove=new Event;this.onFeaturesRendered=new Event;this.svg=SVG.init(a,{width:this.width,height:this.height});var d=SVG.addChild(this.svg,"pattern",{id:this.id+"gridPatt",patternUnits:"userSpaceOnUse",x:0,y:0,width:10,height:2E3});SVG.addChild(d,"rect",{x:0,y:25,width:1,height:2E3,
opacity:"0.1",fill:"grey"});SVG.addChild(this.svg,"rect",{width:this.width,height:2E3,x:0,fill:"url(#"+this.id+"gridPatt)"});d=this.width/2;this.positionText=SVG.addChild(this.svg,"text",{x:d-30,y:22,"font-size":10,fill:"green"});this.firstPositionText=SVG.addChild(this.svg,"text",{x:0,y:22,"font-size":10,fill:"green"});this.lastPositionText=SVG.addChild(this.svg,"text",{x:this.width-70,y:22,"font-size":10,fill:"green"});this._setTextPosition();this.viewNtsArrow=SVG.addChild(this.svg,"rect",{x:16,
y:2,width:this.width-32,height:10,opacity:"0.7",fill:"grey"});this.viewNtsArrowLeft=SVG.addChild(this.svg,"polyline",{points:"0,7 16,0 16,14",opacity:"0.7",fill:"grey"});this.viewNtsArrowRight=SVG.addChild(this.svg,"polyline",{points:this.width+",7 "+(this.width-16)+",0 "+(this.width-16)+",14",opacity:"0.7",fill:"grey"});this.viewNtsText=SVG.addChild(this.svg,"text",{x:d-30,y:11,"font-size":10,fill:"white"});this.viewNtsText.textContent="Viewing "+Math.ceil(this.width/this.pixelBase).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,
"$1,")+" nts";this.currentLine=SVG.addChild(this.svg,"rect",{x:d,y:this.height,width:this.pixelBase,height:this.height,"stroke-width":"2",stroke:"orangered",opacity:"0.5",fill:"orange"});if(null==this.parentLayout){$(this.svg).mousedown(function(a){var b=a.clientX,d=0;$(this).mousemove(function(a){a=(b-a.clientX)/c.pixelBase|0;if(a!=d){var e=d-a;c.position-=e;c._setTextPosition();c.onMove.notify(e);d=a}})});$(this.svg).mouseup(function(){$(this).off("mousemove")});$(this.svg).mouseleave(function(){$(this).off("mousemove")});
var e=function(){$("body").keydown(function(a){var b=0;switch(a.keyCode){case 37:b=a.ctrlKey?100/c.pixelBase:10/c.pixelBase;break;case 39:b=a.ctrlKey?-100/c.pixelBase:-10/c.pixelBase;break;case 109:a.shiftKey&&console.log("zoom out");break;case 107:a.shiftKey&&console.log("zoom in")}0!=b&&(c.position-=b,c._setTextPosition(),c.onMove.notify(b))})};$(this.svg).focusin(function(){e()});$(this.svg).click(function(){$("body").off("keydown");e()});$(this.svg).focusout(function(){$("body").off("keydown")});
$(this.svg).focus()}else c.parentLayout.onMove.addEventListener(function(a,b){c.position-=b;c._setTextPosition();c.onMove.notify(b)})}TrackSvgLayout.prototype.setHeight=function(a){this.height=a;this.svg.setAttribute("height",a);this.currentLine.setAttribute("height",parseInt(a)-25)};
TrackSvgLayout.prototype.setZoom=function(a){this.zoom=Math.max(a-this.zoomOffset,-5);this.pixelBase=this._getPixelsbyBase(this.zoom);this.halfVirtualBase=3*this.width/2/this.pixelBase;this.currentLine.setAttribute("width",this.pixelBase);this.viewNtsText.textContent="Viewing "+Math.ceil(this.width/this.pixelBase).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" nts";this._setTextPosition();this.onZoomChange.notify()};
TrackSvgLayout.prototype.setLocation=function(a){null!=a.chromosome&&(this.chromosome=a.chromosome);null!=a.position&&(this.position=parseInt(a.position),this._setTextPosition());if(null!=a.species)for(i in this.trackDataList)this.trackDataList[i].adapter instanceof CellBaseAdapter&&(this.trackDataList[i].adapter.species=a.species,this.trackDataList[i].adapter.featureCache.clear());this.onChromosomeChange.notify()};
TrackSvgLayout.prototype.addTrack=function(a,b){var c=this,d=b.visibleRange;b.position=this.position;b.trackData=a;b.zoom=this.zoom;b.pixelBase=this.pixelBase;b.width=this.width;var e=this.trackDataList.push(a),f=new TrackSvg(this.svg,b);this.trackSvgList.push(f);this.swapHash[f.id]={index:e-1,visible:!0};f.setY(this.height);f.draw();this.setHeight(this.height+f.getHeight());var g,j,h,k,l=function(){g=parseInt(c.position-2*c.halfVirtualBase);j=parseInt(c.position+2*c.halfVirtualBase);h=parseInt(c.position-
c.halfVirtualBase);k=parseInt(c.position+c.halfVirtualBase)},y=function(){c.zoom<=f.histogramZoom?(f.histogram=!0,f.interval=Math.max(512,5/c.pixelBase)):f.histogram=null},m=function(){f.transcript=null!=f.transcriptZoom&&c.zoom>=f.transcriptZoom?!0:null},v=function(){$(f.features).empty();a.adapter.featureCache.featuresAdded={};f.renderedArea={}};f.onGetDataIdx=a.adapter.onGetData.addEventListener(function(a,b){f.featuresRender=!0==b.params.histogram?f.HistogramRender:f.defaultRender;console.timeEnd("insertCache");
c.setHeight(c.height-f.getHeight());f.featuresRender(b.data);c.setHeight(c.height+f.getHeight());c._redraw()});y();m();l();a.retrieveData({chromosome:this.chromosome,start:h,end:k,histogram:f.histogram,interval:f.interval,transcript:f.transcript});f.onZoomChangeIdx=this.onZoomChange.addEventListener(function(){f.zoom=c.zoom;f.pixelBase=c.pixelBase;y();m();v();l();c.zoom>=d.start-c.zoomOffset&&c.zoom<=d.end?(a.retrieveData({chromosome:c.chromosome,start:h,end:k,histogram:f.histogram,interval:f.interval,
transcript:f.transcript}),f.invalidZoomText.setAttribute("visibility","hidden")):f.invalidZoomText.setAttribute("visibility","visible")});f.onChromosomeChangeIdx=this.onChromosomeChange.addEventListener(function(){f.position=c.position;v();l();c.zoom>=d.start-c.zoomOffset&&c.zoom<=d.end&&a.retrieveData({chromosome:c.chromosome,start:h,end:k,histogram:f.histogram,interval:f.interval,transcript:f.transcript})});f.onMoveIdx=this.onMove.addEventListener(function(b,e){f.position-=e;var m=e*c.pixelBase;
f.pixelPosition-=m;m=parseFloat(f.features.getAttribute("x"))+m;f.features.setAttribute("x",m);c.zoom>=d.start&&c.zoom<=d.end&&(h=parseInt(f.position-c.halfVirtualBase),virtualEnd=parseInt(f.position+c.halfVirtualBase),0>e&&virtualEnd>j&&(a.retrieveData({chromosome:c.chromosome,start:j,end:parseInt(j+c.halfVirtualBase),histogram:f.histogram,interval:f.interval,transcript:f.transcript}),j=parseInt(j+c.halfVirtualBase)),0<e&&h<g&&(a.retrieveData({chromosome:c.chromosome,start:parseInt(g-c.halfVirtualBase),
end:g,histogram:f.histogram,interval:f.interval,transcript:f.transcript}),g=parseInt(g-c.halfVirtualBase)))});$(f.upRect).bind("click",function(){c._reallocateAbove(this.parentNode.parentNode.id)});$(f.downRect).bind("click",function(){c._reallocateUnder(this.parentNode.parentNode.id)});$(f.hideRect).bind("click",function(){c._hideTrack(this.parentNode.parentNode.id)});$(f.settingsRect).bind("click",function(){console.log("settings click")})};
TrackSvgLayout.prototype.removeTrack=function(a){this._hideTrack(a);var b=this.swapHash[a].index;this.onZoomChange.removeEventListener(this.trackSvgList[b].onZoomChangeIdx);this.onChromosomeChange.removeEventListener(this.trackSvgList[b].onChromosomeChangeIdx);this.onMove.removeEventListener(this.trackSvgList[b].onMoveIdx);this.trackSvgList.splice(b,1);this.trackDataList.splice(b,1);delete this.swapHash[a]};
TrackSvgLayout.prototype._redraw=function(){for(var a=null,b=25,c=0;c<this.trackSvgList.length;c++)a=this.trackSvgList[c],this.swapHash[a.id].visible&&(a.main.setAttribute("y",b),b+=a.getHeight())};
TrackSvgLayout.prototype._reallocateAbove=function(a){a=this.swapHash[a].index;console.log(a+" quiere moverse 1 posicion arriba");if(0<a){var b=this.trackSvgList[a-1],c=this.trackSvgList[a],d=parseInt(b.main.getAttribute("y")),e=parseInt(c.main.getAttribute("height"));b.main.setAttribute("y",d+e);c.main.setAttribute("y",d);this.trackSvgList[a]=b;this.trackSvgList[a-1]=c;this.swapHash[b.id].index=a;this.swapHash[c.id].index=a-1}else console.log("ya esta en la mas alta")};
TrackSvgLayout.prototype._reallocateUnder=function(a){a=this.swapHash[a].index;console.log(a+" quiere moverse 1 posicion abajo");if(a+1<this.trackDataList.length){var b=this.trackSvgList[a],c=this.trackSvgList[a+1],d=parseInt(b.main.getAttribute("y")),e=parseInt(c.main.getAttribute("height"));b.main.setAttribute("y",d+e);c.main.setAttribute("y",d);this.trackSvgList[a]=c;this.trackSvgList[a+1]=b;this.swapHash[c.id].index=a;this.swapHash[b.id].index=a+1}else console.log("abajo del todo")};
TrackSvgLayout.prototype._hideTrack=function(a){this.swapHash[a].visible=!1;a=this.trackSvgList[this.swapHash[a].index];this.svg.removeChild(a.main);this.setHeight(this.height-a.getHeight());this._redraw()};TrackSvgLayout.prototype._showTrack=function(a){this.swapHash[a].visible=!0;a=this.trackSvgList[this.swapHash[a].index];this.svg.appendChild(a.main);this.setHeight(this.height+a.getHeight());this._redraw()};TrackSvgLayout.prototype._getPixelsbyBase=function(a){return this.zoomLevels[a]};
TrackSvgLayout.prototype._createPixelsbyBase=function(){this.zoomLevels=[];for(var a=10,b=100;-40<=b;b-=5)this.zoomLevels[b]=a,a/=2};
TrackSvgLayout.prototype._setTextPosition=function(){this.positionText.textContent=this.position.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");var a=Math.floor(this.width/this.pixelBase/2);this.firstPositionText.textContent=(this.position-a).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");this.lastPositionText.textContent=(this.position+a-1).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")};
function TrackData(a,b){this.id=a;null!=b&&(null!=b.adapter&&(this.adapter=b.adapter),null!=b.gzip&&(this.gzip=b.gzip))}TrackData.prototype.retrieveData=function(a){this.adapter.getData(a)};function FeatureCache(a){this.args=a;this.id=Math.round(1E7*Math.random());this.chunkSize=5E4;this.gzip=!0;this.maxSize=10485760;this.size=0;null!=a&&(null!=a.chunkSize&&(this.chunkSize=a.chunkSize),null!=a.gzip&&(this.gzip=a.gzip));this.cache={};this.featuresAdded={};this.maxFeaturesInterval=0}
FeatureCache.prototype._getChunk=function(a){return Math.floor(a/this.chunkSize)};FeatureCache.prototype.getChunkRegion=function(a){start=this._getChunk(a.start)*this.chunkSize;end=this._getChunk(a.end)*this.chunkSize+this.chunkSize-1;return{start:start,end:end}};
FeatureCache.prototype.getFeaturesByChunk=function(a,b){var c=[],d;if(null!=this.cache[a]&&null!=this.cache[a][b]){for(var e=0,f=this.cache[a][b].length;e<f;e++)d=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[a][b][e])):this.cache[a][b][e],!0!=this.featuresAdded[d.chromosome+":"+d.start+"-"+d.end]&&(c.push(d),this.featuresAdded[d.chromosome+":"+d.start+"-"+d.end]=!0);return c}return null};
FeatureCache.prototype.putFeaturesByRegion=function(a,b,c,d){var e,f,g;e=this._getChunk(b.start);f=this._getChunk(b.end);for(var j=e;j<=f;j++)e=b.chromosome+":"+j,null==this.cache[e]&&(this.cache[e]={}),null==this.cache[e][d]&&(this.cache[e][d]=[]);a.constructor!=Array&&(a=[a]);for(var h=0,k=a.length;h<k;h++){g=a[h];g.featureType=c;e=this._getChunk(g.start);f=this._getChunk(g.end);for(j=e;j<=f;j++)e=g.chromosome+":"+j,null==g.chromosome&&(e=b.chromosome+":"+j),null!=this.cache[e]&&null!=this.cache[e][d]&&
(this.gzip?this.cache[e][d].push(RawDeflate.deflate(JSON.stringify(g))):this.cache[e][d].push(g))}};
FeatureCache.prototype.getFeaturesByRegion=function(a,b){for(var c=this._getChunk(a.start),d=this._getChunk(a.end),e=[],f,g=!0,j=c;j<=d;j++)if(f=a.chromosome+":"+j,null!=this.cache[f]&&null!=this.cache[f][b])for(var h=0,k=this.cache[f][b].length;h<k;h++)c=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[f][b][h])):this.cache[f][b][h],!0!=this.featuresAdded[c.chromosome+":"+c.start+"-"+c.end]&&(c.end>a.start&&c.start<a.end&&(e.push(c),g=!1),this.featuresAdded[c.chromosome+":"+c.start+"-"+c.end]=
!0);return g?null:e};FeatureCache.prototype.remove=function(a){for(var b=this._getChunk(a.start),c=this._getChunk(a.end);b<=c;b++)this.cache[a.chromosome+":"+b]=null};FeatureCache.prototype.clear=function(){this.size=0;this.cache={}};FeatureCache.prototype.clearType=function(a){this.cache[a]=null};
FeatureCache.prototype.putFeatures=function(a,b){var c,d,e;a.constructor!=Array&&(a=[a]);for(var f=0,g=a.length;f<g;f++){c=a[f];d=this._getChunk(c.start);e=this._getChunk(c.end);for(var j=d;j<=e;j++)d=c.chromosome+":"+j,null==this.cache[d]&&(this.cache[d]=[]),null==this.cache[d][b]&&(this.cache[d][b]=[]),this.gzip?this.cache[d][b].push(RawDeflate.deflate(JSON.stringify(c))):this.cache[d][b].push(c)}};
FeatureCache.prototype.putChunk=function(a,b,c){var d;d=this._getChunk(b.start);d=b.chromosome+":"+d;null==this.cache[d]&&(this.cache[d]=[]);null==this.cache[d][c]&&(this.cache[d][c]=[]);if(a.constructor==Object)this.gzip?this.cache[d][c].push(RawDeflate.deflate(JSON.stringify(a))):this.cache[d][c].push(a);else for(var e=0,f=a.length;e<f;e++)b=a[e],this.gzip?this.cache[d][c].push(RawDeflate.deflate(JSON.stringify(b))):this.cache[d][c].push(b)};
FeatureCache.prototype.histogram=function(a,b){for(var c=(a.end-a.start+1)/b,d=[],e=0;e<c;e++){var f=0,g=(e+1)*b-1,j=this._getChunk(e*b+a.start),g=this._getChunk(g+a.start);for(console.log(this.cache);j<=g;j++){var h=a.chromosome+":"+j;console.log(h);console.log(this.cache[h]);for(var k=0,l=this.cache[h].length;k<l;k++)feature=this.gzip?JSON.parse(RawDeflate.inflate(this.cache[h][k])):this.cache[h][k],f++}d[e]=f;this.maxFeaturesInterval<f&&(this.maxFeaturesInterval=f)}for(var y in d)d[y]/=this.maxFeaturesInterval};
function FeatureDataAdapter(a,b){this.dataSource=a;this.gzip=!0;null!=b&&null!=b.gzip&&(this.gzip=b.gzip);null!=b.species&&(this.species=b.species);this.featureCache=new FeatureCache({chunkSize:1E4,gzip:this.gzip});this.onLoad=new Event;this.onGetData=new Event}FeatureDataAdapter.prototype.getData=function(a){a=this.featureCache.getFeaturesByRegion(a,"data");null!=a&&this.onGetData.notify({data:a,cached:!0})};FeatureDataAdapter.prototype.addFeatures=function(a){this.featureCache.putFeatures(a,"data")};
function ChromosomeWidget(a,b){this.id=Math.round(1E7*Math.random());null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.species&&(this.species=b.species),null!=b.chromosome&&(this.chromosome=b.chromosome),null!=b.zoom&&(this.zoom=b.zoom),null!=b.position&&(this.position=b.position));this._createPixelsbyBase();this.tracksViewedRegion=this.width/this._getPixelsbyBase(this.zoom);this.onClick=new Event;this.svg=SVG.init(a,{width:this.width,height:this.height});
this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"}}
ChromosomeWidget.prototype.drawChromosome=function(){var a=this,b=new CellBaseManager(this.species);b.success.addEventListener(function(b,d){a.pixelBase=(a.width-40)/d.result[0][d.result[0].length-1].end;var e=20,f=!0,g=a.position*a.pixelBase+20,j=SVG.addChild(a.svg,"g",{cursor:"pointer"});$(j).click(function(b){var c=parseInt((b.clientX-20)/a.pixelBase),d=parseFloat(a.positionBox.getAttribute("width"));a.positionBox.setAttribute("x",b.clientX-d/2);a.onClick.notify(c)});for(var h=0;h<d.result[0].length;h++){var k=
a.pixelBase*(d.result[0][h].end-d.result[0][h].start),l=a.colors[d.result[0][h].stain];null==l&&(l="purple");var y=d.result[0][h].cytoband,m=e+k/2;if("acen"==d.result[0][h].stain){var v="",v=e+k;f?(v=e+",10 "+m+",10 "+v+",19 "+m+",28 "+e+",28",f=!1):v=e+",19 "+m+",10 "+v+",10 "+v+",28 "+m+",28";SVG.addChild(j,"polyline",{points:v,stroke:"black",opacity:0.8,fill:l})}else SVG.addChild(j,"rect",{x:e,y:10,width:k,height:18,stroke:"black",opacity:0.8,fill:l});SVG.addChild(a.svg,"text",{x:m,y:30,"font-size":10,
transform:"rotate(90, "+m+", 30)",fill:"black"}).textContent=y;e+=k}e=a.tracksViewedRegion*a.pixelBase;a.positionBox=SVG.addChild(j,"rect",{x:g-e/2,y:2,width:e,height:a.height-2,stroke:"orangered","stroke-width":2,opacity:0.5,fill:"orange"})});b.get("genomic","region",this.chromosome,"cytoband")};
ChromosomeWidget.prototype.setLocation=function(a){var b=!1;null!=a.species&&(this.species=a.species,b=!0);null!=a.chromosome&&(this.chromosome=a.chromosome,b=!0);if(null!=a.position){this.position=a.position;var a=this.position*this.pixelBase+20,c=parseFloat(this.positionBox.getAttribute("width"));this.positionBox.setAttribute("x",a-c/2)}b&&($(this.svg).empty(),this.drawChromosome())};
ChromosomeWidget.prototype.setZoom=function(a){this.zoom=a;this.tracksViewedRegion=this.width/this._getPixelsbyBase(this.zoom);a=this.tracksViewedRegion*this.pixelBase;this.positionBox.setAttribute("width",a);this.positionBox.setAttribute("x",this.position*this.pixelBase+20-a/2)};ChromosomeWidget.prototype._getPixelsbyBase=function(a){return this.zoomLevels[a]};ChromosomeWidget.prototype._createPixelsbyBase=function(){this.zoomLevels=[];for(var a=10,b=100;-40<=b;b-=5)this.zoomLevels[b]=a,a/=2};
function CircularChromosomeWidget(a,b){var c=this;this.coord_x=400;this.coord_y=250;this.radius=200;this.stroke_width=20;null!=b&&(null!=b.coord_x&&(this.coord_x=b.coord_x),null!=b.coord_y&&(this.coord_y=b.coord_y),null!=b.radius&&(this.radius=b.radius),null!=b.stroke_width&&(this.stroke_width=b.stroke_width));this.circleLength=2*Math.PI*this.radius;this.d;this.chroLength;this.pixelRatio;this.angle_click;this.x_point;this.y_point;this.x_point2;this.y_point2;this.sep=27;this.angle_lines=Math.PI/6;
this.colors={gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"};this.mySvg=document.createElementNS("http://www.w3.org/2000/svg","svg");console.log(this.mySvg);this.mySvg.setAttribute("width","1000");this.mySvg.setAttribute("height","600");a.appendChild(this.mySvg);$.ajax({url:"http://ws-beta.bioinfo.cipf.es/cellbase/rest/latest/hsa/genomic/region/13/cytoband?of=json"}).done(function(a){c.d=
JSON.parse(a);c.chroLength=c.d[0][c.d[0].length-1].end;c.pixelRatio=c.chroLength/c.circleLength;$(c.mySvg).click(function(a){var d,h,k,l;d=c.coord_x;h=c.radius+c.coord_y+c.stroke_width/2;k=c.coord_x;l=c.radius+c.coord_y-c.stroke_width/2;d=Math.sqrt(Math.pow(d-c.coord_x,2)+Math.pow(h-c.coord_y,2));k=Math.sqrt(Math.pow(k-c.coord_x,2)+Math.pow(l-c.coord_y,2));l=Math.sqrt(Math.pow(a.clientX-c.coord_x,2)+Math.pow(a.clientY-c.coord_y,2));h=!1;l>=k&&l<=d&&(h=!0);if(h){c.angle_click=0;a.clientX>c.coord_x&&
a.clientY<c.coord_y?c.angle_click=Math.atan((a.clientX-c.coord_x)/(c.coord_y-a.clientY)):a.clientX>c.coord_x&&a.clientY>c.coord_y?c.angle_click=Math.PI/2+Math.atan((a.clientY-c.coord_y)/(a.clientX-c.coord_x)):a.clientX<c.coord_x&&a.clientY>c.coord_y?c.angle_click=Math.PI+Math.atan((c.coord_x-a.clientX)/(a.clientY-c.coord_y)):a.clientX<c.coord_x&&a.clientY<c.coord_y&&(c.angle_click=3*Math.PI/2+Math.atan((c.coord_y-a.clientY)/(c.coord_x-a.clientX)));a=2*Math.PI;d=c.angle_click*c.circleLength/a*c.pixelRatio;
k=0;for(l=!0;k<c.d[0].length&&l;)c.d[0][k].start<=d&&c.d[0][k].end>=d&&(l=!1),k++;console.log(parseInt(d));c.x_point=(c.radius+c.sep)*Math.cos(c.angle_click)+c.coord_x;c.y_point=(c.radius+c.sep)*Math.sin(c.angle_click)+c.coord_y;c.x_point2=(c.radius-c.sep)*Math.cos(c.angle_click)+c.coord_x;c.y_point2=(c.radius-c.sep)*Math.sin(c.angle_click)+c.coord_y;b.setAttribute("x1",c.x_point);b.setAttribute("y1",c.y_point);b.setAttribute("x2",c.x_point2);b.setAttribute("y2",c.y_point2);d=[];0>c.angle_click-c.angle_lines?
(d.push((c.angle_click+c.angle_lines)*c.circleLength/a),d.push((a-2*c.angle_lines)*c.circleLength/a),d.push((c.angle_lines-c.angle_click)*c.circleLength/a+2)):c.angle_click+c.angle_lines>a?(d.push((c.angle_lines-(a-c.angle_click))*c.circleLength/a),d.push((a-2*c.angle_lines)*c.circleLength/a),d.push((c.angle_lines+(a-c.angle_click))*c.circleLength/a+2)):(d.push(0),d.push((c.angle_click-c.angle_lines)*c.circleLength/a),d.push(2*c.angle_lines*c.circleLength/a),d.push((a-(c.angle_click-c.angle_lines)+
2*c.angle_lines)*c.circleLength/a));f.setAttribute("cx",c.coord_x);f.setAttribute("cy",c.coord_y);f.setAttribute("r",c.radius);f.setAttribute("stroke-dasharray",d.toString())}});var b=document.createElementNS("http://www.w3.org/2000/svg","line");b.setAttribute("stroke","red");b.setAttribute("stroke-width",1);b.setAttribute("transform","rotate(-90,"+c.coord_x+","+c.coord_y+")");c.mySvg.appendChild(b);c.drawChromosome();var f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("fill",
"transparent");f.setAttribute("stroke","orange");f.setAttribute("opacity","0.2");f.setAttribute("stroke-width",55);f.setAttribute("transform","rotate(-90,"+c.coord_x+","+c.coord_y+")");c.mySvg.appendChild(f)})}
CircularChromosomeWidget.prototype.drawChromosome=function(){this.chroLength=this.d[0][this.d[0].length-1].end;var a=[],b=0,c=[],d=!0;c.push(this.d[0][0].stain);for(b=1;b<=this.d[0].length-1;b++){for(var e=0;e<=c.length-1;e++)c[e]==this.d[0][b].stain&&(d=!1);d&&c.push(this.d[0][b].stain);d=!0}for(var d=null,f=!0,e=0;e<c.length;e++){for(var g=0;g<this.d[0].length;g++)this.d[0][g].stain==c[e]&&(f?(0==g&&1==this.d[0][g].start||(a.push(0),b=this.d[0][g].start-1,b/=this.pixelRatio,a.push(b)),b=this.d[0][g].end-
this.d[0][g].start,b/=this.pixelRatio,a.push(b),d=g,f=!1):(b=this.d[0][g].start-this.d[0][d].end,b/=this.pixelRatio,"blue"==this.colors[c[e]]?a.push(2):a.push(b),b=this.d[0][g].end-this.d[0][g].start,b/=this.pixelRatio,a.push(b),d=g));b=this.chroLength-this.d[0][d].end;b/=this.pixelRatio;a=a+","+b;b=e;f=c;g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("cx",this.coord_x);g.setAttribute("cy",this.coord_y);g.setAttribute("r",this.radius);g.setAttribute("fill","transparent");
g.setAttribute("stroke",this.colors[f[b]]);g.setAttribute("stroke-width",this.stroke_width);g.setAttribute("transform","rotate(-90,"+this.coord_x+","+this.coord_y+")");g.setAttribute("stroke-dasharray",a.toString());this.mySvg.appendChild(g);a=[];f=!0}};
function KaryotypeWidget(a,b){this.parent=a;this.id=Math.round(1E7*Math.random());null!=b&&(null!=b.width&&(this.width=b.width),null!=b.height&&(this.height=b.height),null!=b.species&&(this.species=b.species),null!=b.chromosome&&(this.chromosome=b.chromosome),null!=b.position&&(this.position=b.position));this.onClick=new Event;this.afterRender=new Event;this.rendered=!1;this.svg=SVG.init(a,{width:this.width,height:this.height});this.markGroup=SVG.addChild(this.svg,"g",{cursor:"pointer"});this.colors=
{gneg:"white",stalk:"#666666",gvar:"#CCCCCC",gpos25:"silver",gpos33:"lightgrey",gpos50:"gray",gpos66:"dimgray",gpos75:"darkgray",gpos100:"black",gpos:"gray",acen:"blue"}}
KaryotypeWidget.prototype.drawKaryotype=function(){var a=this,b=function(a,b){for(var c=!0,g=0;g<a.length&&!0==c;g++)isNaN(a[g])&&(c=!1);return!c?1:a-b},c=new CellBaseManager(this.species);c.success.addEventListener(function(c,e){var f=e.result;f.sort(b);var g=20,j=a.width/f.length,h=new CellBaseManager(a.species);h.success.addEventListener(function(b,c){for(var d=0,e=0,h=f.length;e<h;e++){var q=c.result[e][c.result[e].length-1].end;q>d&&(d=q)}a.pixelBase=(a.height-10)/d;a.chrOffsetY={};a.chrOffsetX=
{};e=0;for(h=f.length;e<h;e++){q=c.result[e][0].chromosome;chrSize=c.result[e][c.result[e].length-1].end*a.pixelBase;var n=2+d*a.pixelBase-chrSize;a.chrOffsetY[q]=n;var r=!0,s=a.position*a.pixelBase,A=SVG.addChild(a.svg,"g",{cursor:"pointer",chr:f[e]});$(A).click(function(b){var c=this.getAttribute("chr"),b=b.pageY-$(a.svg).offset().top;a.positionBox.setAttribute("x1",a.chrOffsetX[c]-10);a.positionBox.setAttribute("x2",a.chrOffsetX[c]+23);a.positionBox.setAttribute("y1",b);a.positionBox.setAttribute("y2",
b);b=parseInt((b-a.chrOffsetY[c])/a.pixelBase);a.chromosome=c;a.onClick.notify({chromosome:a.chromosome,position:b})});for(var p=0,C=c.result[e].length;p<C;p++){var o=a.pixelBase*(c.result[e][p].end-c.result[e][p].start),t=a.colors[c.result[e][p].stain];null==t&&(t="purple");if("acen"==c.result[e][p].stain){var G="",G=g+6.5,u=n+o/2,D=g+13,x=n+o;r?(G=g+","+n+" "+D+","+n+" "+D+","+u+" "+G+","+x+" "+g+","+u,r=!1):G=g+","+x+" "+g+","+u+" "+G+","+n+" "+D+","+u+" "+D+","+x;SVG.addChild(A,"polyline",{points:G,
stroke:"black",opacity:0.8,fill:t})}else SVG.addChild(A,"rect",{x:g,y:n,width:13,height:o,stroke:"grey",opacity:0.8,fill:t});n+=o}SVG.addChild(a.svg,"text",{x:g+1,y:a.height,"font-size":9,fill:"black"}).textContent=q;a.chrOffsetX[q]=g;g+=j}a.positionBox=SVG.addChild(a.svg,"line",{x1:a.chrOffsetX[a.chromosome]-10,y1:s+a.chrOffsetY[a.chromosome],x2:a.chrOffsetX[a.chromosome]+23,y2:s+a.chrOffsetY[a.chromosome],stroke:"orangered","stroke-width":2,opacity:0.5});a.rendered=!0;a.afterRender.notify()});h.get("genomic",
"region",f.toString(),"cytoband")});c.get("feature","karyotype","none","chromosome")};
KaryotypeWidget.prototype.setLocation=function(a){var b=!1;null!=a.species&&(this.species=a.species,b=!0);null!=a.chromosome&&(this.chromosome=a.chromosome,null==a.species&&(this.positionBox.setAttribute("x1",this.chrOffsetX[this.chromosome]-10),this.positionBox.setAttribute("x2",this.chrOffsetX[this.chromosome]+23)));null!=a.position&&(this.position=a.position,null==a.species&&(a=this.position*this.pixelBase+this.chrOffsetY[this.chromosome],this.positionBox.setAttribute("y1",a),this.positionBox.setAttribute("y2",
a)));b&&($(this.svg).empty(),this.drawKaryotype())};KaryotypeWidget.prototype.updatePositionBox=function(a){this.chromosome=a.chromosome;this.position=a.position;this.positionBox.setAttribute("x1",this.chrOffsetX[this.chromosome]-10);this.positionBox.setAttribute("x2",this.chrOffsetX[this.chromosome]+23);a=this.position*this.pixelBase+this.chrOffsetY[this.chromosome];this.positionBox.setAttribute("y1",a);this.positionBox.setAttribute("y2",a)};
KaryotypeWidget.prototype.addMark=function(a){var b=this,c=function(){if(null!=a.chromosome&&null!=a.start&&null!=b.chrOffsetX[a.chromosome]){var c=b.chrOffsetX[a.chromosome]-10,e=a.start*b.pixelBase+b.chrOffsetY[a.chromosome]-4;SVG.addChild(b.markGroup,"polyline",{points:c+","+e+" "+b.chrOffsetX[a.chromosome]+","+(a.start*b.pixelBase+b.chrOffsetY[a.chromosome])+" "+c+","+(a.start*b.pixelBase+b.chrOffsetY[a.chromosome]+4)+" "+c+","+e,stroke:"black",opacity:0.8,fill:"#33FF33"})}};this.rendered?c():
this.afterRender.addEventListener(function(){c()})};KaryotypeWidget.prototype.unmark=function(){$(this.markGroup).empty()};function DataSource(){}DataSource.prototype.fetch=function(){};
function CellBaseAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a&&(null!=a.host&&(this.host=a.host),null!=a.species&&(this.species=a.species),null!=a.category&&(this.category=a.category),null!=a.subCategory&&(this.subCategory=a.subCategory),null!=a.resource&&(this.resource=a.resource),null!=a.featureCache))var b=a.featureCache;this.featureCache=new FeatureCache(b);this.onGetData=new Event}
CellBaseAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);a.transcript&&(c="withTranscripts");for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=new CellBaseManager(this.species,{host:this.host}),g=[],j=[];d<=e;d++){var h=a.chromosome+":"+d;null==this.featureCache.cache[h]||
null==this.featureCache.cache[h][c]?g.push(d):(h=this.featureCache.getFeaturesByChunk(h,c),j=j.concat(h))}0<j.length&&this.onGetData.notify({data:j,params:this.params,cached:!0});f.success.addEventListener(function(a,c){console.timeEnd("cellbase");console.time("insertCache");var d="data";c.params.histogram&&(d="histogram"+c.params.interval);c.params.transcript&&(d="withTranscripts");!0==c.params.histogram&&(c.result=[c.result]);for(var e=[],f=0;f<c.query.length;f++){var g=c.query[f].split(":"),h=
g[1].split("-");e.push({chromosome:g[0],start:h[0],end:h[1]})}for(f=0;f<c.result.length;f++){c.result[f].constructor!=Array&&(c.result[f]=[c.result[f]]);g=0;for(h=c.result[f].length;g<h;g++)if("gene"==c.resource&&null!=c.result[f][g].transcripts)for(var j=0,k=c.result[f][g].transcripts.length;j<k;j++){c.result[f][g].transcripts[j].featureType="transcript";for(var l=0,o=c.result[f][g].transcripts[j].exonToTranscripts.length;l<o;l++)c.result[f][g].transcripts[j].exonToTranscripts[l].exon.featureType=
"exon"}b.featureCache.putFeaturesByRegion(c.result[f],e[f],c.resource,d);g=b.featureCache.getFeaturesByRegion(e[f],d);null!=g&&b.onGetData.notify({data:g,params:b.params,cached:!1})}});c=[];j=e=!0;if(0<g.length){for(d=0;d<g.length;d++){if(e)var k=parseInt(g[d]*this.featureCache.chunkSize),e=!1;if(j)var l=parseInt(g[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),j=!1;null!=g[d+1]?g[d]+1!=g[d+1]&&(e=a.chromosome+":"+k+"-"+l,c.push(e),e=!0):(e=a.chromosome+":"+k+"-"+l,c.push(e),e=!0);
j=!0}console.time("cellbase");f.get(this.category,this.subCategory,c,this.resource,this.params)}};FileDataSource.prototype.fetch=DataSource.prototype.fetch;function FileDataSource(a){DataSource.prototype.constructor.call(this);this.file=a;this.success=new Event;this.error=new Event}FileDataSource.prototype.error=function(){alert("File is too big. Max file size is 50 Mbytes.")};
FileDataSource.prototype.fetch=function(a){var b=this;if(52428800>=this.file.size)if(a)a=new FileReader,a.onload=function(a){b.success.notify(a.target.result)},a.readAsText(this.file,"UTF-8");else return a=new FileReaderSync,a.readAsText(this.file,"UTF-8");else b.error(),b.error.notify()};StringDataSource.prototype.fetch=DataSource.prototype.fetch;function StringDataSource(a){DataSource.prototype.constructor.call(this);this.str=a;this.success=new Event}
StringDataSource.prototype.fetch=function(a){if(a)this.success.notify(this.str);else return this.str};UrlDataSource.prototype.fetch=DataSource.prototype.fetch;
function UrlDataSource(a,b){DataSource.prototype.constructor.call(this);this.url=a;this.proxy="http://ws-beta.bioinfo.cipf.es/cellbase/rest/v1/utils/proxy?url=";null!=b&&null!=b.proxy&&("boolean"==typeof b.proxy?!1==b.proxy?this.proxy=!1:this.url=this.proxy+a:"string"==typeof b.proxy&&(this.url=b.proxy+a));this.success=new Event;this.error=new Event}
UrlDataSource.prototype.fetch=function(a){var b=this,c=null;if(this.url)return $.ajax({type:"GET",url:this.url,async:a,success:function(d){a?b.success.notify(d):c=d},error:function(a,c,f){console.log("URL Data source: Ajax call returned : "+f+"\t"+c+"\t"+a.statusText+" END");b.error.notify()}}),c};VCFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function VCFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;null!=b&&null!=b.async&&(this.async=b.async);this.async?(this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async)):this.parse(this.dataSource.fetch(this.async))}
VCFDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");null!=c&&0<c.length&&(c=c.split("\t"),"#"!=c[0].substr(0,1)&&this.featureCache.putFeatures({chromosome:c[0],position:parseFloat(c[1]),start:parseFloat(c[1]),end:parseFloat(c[1]),id:c[2],ref:c[3],alt:c[4],quality:c[5],filter:c[6],info:c[7],format:c[8],record:c,label:c[2]+" "+c[3]+"/"+c[4]+" Q:"+c[5],featureType:"file"},"data"))}};GFFDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function GFFDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;null!=b&&null!=b.async&&(this.async=b.async);this.async?(this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async)):this.parse(this.dataSource.fetch(this.async))}
GFFDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");null!=c&&0<c.length&&(c=c.split("\t"),this.featureCache.putFeatures({chromosome:c[0].replace("chr",""),label:c[2],start:parseFloat(c[3]),end:parseFloat(c[4]),score:parseFloat(c[5]),strand:c[6],frame:c[7],group:c[8],featureType:"file"},"data"))}};BEDDataAdapter.prototype.getData=FeatureDataAdapter.prototype.getData;
function BEDDataAdapter(a,b){FeatureDataAdapter.prototype.constructor.call(this,a,b);var c=this;this.async=!0;null!=b&&null!=b.async&&(this.async=b.async);this.async?(this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async)):this.parse(this.dataSource.fetch(this.async))}
BEDDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,"");null!=c&&0<c.length&&(c=c.split("\t"),this.featureCache.putFeatures({label:c[3],chromosome:c[0].replace("chr",""),start:parseFloat(c[1]),end:parseFloat(c[2]),score:c[4],strand:c[5],thickStart:c[6],thickEnd:c[7],itemRgb:c[8],blockCount:c[9],blockSizes:c[10],blockStarts:c[11],featureType:"bed"},"data"))}};
function TabularDataAdapter(a,b){var c=this;this.dataSource=a;this.async=!0;null!=b&&null!=b.async&&(this.async=b.async);this.fileLines=[];this.async?(this.dataSource.success.addEventListener(function(a,b){c.parse(b);c.onLoad.notify()}),this.dataSource.fetch(this.async)):this.parse(this.dataSource.fetch(this.async));this.onLoad=new Event}TabularDataAdapter.prototype.getLines=function(){return this.fileLines};
TabularDataAdapter.prototype.parse=function(a){for(var a=a.split("\n"),b=0;b<a.length;b++){var c=a[b].replace(/^\s+|\s+$/g,""),c=c.replace(/\//gi,"");null!=c&&0<c.length&&"#"!=c.charAt(0)&&this.fileLines.push(c.split("\t"))}};TabularDataAdapter.prototype.getLinesCount=function(){return this.fileLines.length};TabularDataAdapter.prototype.getValuesByColumnIndex=function(a){for(var b=[],c=0;c<this.getLinesCount();c++)null!=this.getLines()[c][a]&&b.push(this.getLines()[c][a]);return b};
TabularDataAdapter.prototype.getHeuristicTypeByColumnIndex=function(a){return this.getHeuristicTypeByValues(this.getValuesByColumnIndex(a))};TabularDataAdapter.prototype.getHeuristicTypeByValues=function(a){for(var b=/^[-+]?[0-9]*\.?[0-9]+$/,c=0;c<a.length;c++)if(!b.test((new String(a[c])).replace(",",".")))return"string";return"numeric"};
function DasAdapter(a){this.gzip=!0;this.proxy="http://ws-beta.bioinfo.cipf.es/cellbase/rest/v1/utils/proxy?url=";if(null!=a&&(null!=a.url&&(this.url=a.url),null!=a.species&&(this.species=a.species),null!=a.featureCache))var b=a.featureCache;this.featureCache=new FeatureCache(b);this.onGetData=new Event;this.onCheckUrl=new Event;this.onError=new Event}
DasAdapter.prototype.getData=function(a){console.time("all");var b=this;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=[],g=[];d<=e;d++){var j=a.chromosome+":"+d;null==this.featureCache.cache[j]||null==this.featureCache.cache[j][c]?f.push(d):(j=this.featureCache.getFeaturesByChunk(j,c),g=g.concat(j))}0<g.length&&this.onGetData.notify({data:g,cached:!0});g=e=!0;
if(0<f.length)for(d=0;d<f.length;d++){j=null;if(e)var h=parseInt(f[d]*this.featureCache.chunkSize),e=!1;if(g)var k=parseInt(f[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),g=!1;null!=f[d+1]?f[d]+1!=f[d+1]&&(j=a.chromosome+":"+h+","+k,e=!0):(j=a.chromosome+":"+h+","+k,e=!0);g=!0;j&&(j=this.proxy+this.url+"?segment="+j,console.log("fullURL: "+j),$.ajax({url:j,type:"GET",dataType:"xml",error:function(){alert("error");b.onError.notify("It is not allowed by Access-Control-Allow-Origin ")},
success:function(d){b.xml=(new XMLSerializer).serializeToString(d);var e=(new XMLSerializer).serializeToString(d),d=xml2json.parser(e),e=[];if("undefined"!=typeof d.dasgff.gff.segment)if("undefined"!=typeof d.dasgff.gff.segment.feature)e=d.dasgff.gff.segment.feature;else if("undefined"!=typeof d.dasgff.gff.segment[0])if(null!=d.dasgff.gff.segment[0].feature)for(var f=0;f<d.dasgff.gff.segment.length;f++)for(var g=0;g<d.dasgff.gff.segment[f].feature.length;g++)d.dasgff.gff.segment[f].feature[g].chromosome=
a.chromosome,e.push(d.dasgff.gff.segment[f].feature[g]);else e.push([]);d={chromosome:a.chromosome,start:h,end:k};b.featureCache.putFeaturesByRegion(e,d,"das",c);console.log(b.featureCache.cache);e=b.featureCache.getFeaturesByRegion(d,c);null!=e&&b.onGetData.notify({data:e,cached:!1})}}))}};
DasAdapter.prototype.checkUrl=function(){var a=this,b=this.proxy+this.url+"?segment=1:1,1";console.log("Checking URL: "+b);$.ajax({url:b,type:"GET",dataType:"xml",error:function(){alert("error");a.onError.notify("It is not allowed by Access-Control-Allow-Origin ")},success:function(b){a.xml=(new XMLSerializer).serializeToString(b);a.onCheckUrl.notify({data:a.xml})}})};
function CellBaseAdapter(a){this.host=null;this.gzip=!0;this.params={};if(null!=a&&(null!=a.host&&(this.host=a.host),null!=a.species&&(this.species=a.species),null!=a.category&&(this.category=a.category),null!=a.subCategory&&(this.subCategory=a.subCategory),null!=a.resource&&(this.resource=a.resource),null!=a.featureCache))var b=a.featureCache;this.featureCache=new FeatureCache(b);this.onGetData=new Event}
CellBaseAdapter.prototype.getData=function(a){var b=this;this.params.histogram=a.histogram;this.params.interval=a.interval;this.params.transcript=a.transcript;1>a.start&&(a.start=1);3E8<a.end&&(a.end=3E8);var c="data";a.histogram&&(c="histogram"+a.interval);a.transcript&&(c="withTranscripts");for(var d=this.featureCache._getChunk(a.start),e=this.featureCache._getChunk(a.end),f=new CellBaseManager(this.species,{host:this.host}),g=[],j=[];d<=e;d++){var h=a.chromosome+":"+d;null==this.featureCache.cache[h]||
null==this.featureCache.cache[h][c]?g.push(d):(h=this.featureCache.getFeaturesByChunk(h,c),j=j.concat(h))}0<j.length&&this.onGetData.notify({data:j,params:this.params,cached:!0});f.success.addEventListener(function(a,c){console.timeEnd("cellbase");console.time("insertCache");var d="data";c.params.histogram&&(d="histogram"+c.params.interval);c.params.transcript&&(d="withTranscripts");!0==c.params.histogram&&(c.result=[c.result]);for(var e=[],f=0;f<c.query.length;f++){var g=c.query[f].split(":"),h=
g[1].split("-");e.push({chromosome:g[0],start:h[0],end:h[1]})}for(f=0;f<c.result.length;f++){c.result[f].constructor!=Array&&(c.result[f]=[c.result[f]]);g=0;for(h=c.result[f].length;g<h;g++)if("gene"==c.resource&&null!=c.result[f][g].transcripts)for(var j=0,k=c.result[f][g].transcripts.length;j<k;j++){c.result[f][g].transcripts[j].featureType="transcript";for(var l=0,o=c.result[f][g].transcripts[j].exonToTranscripts.length;l<o;l++)c.result[f][g].transcripts[j].exonToTranscripts[l].exon.featureType=
"exon"}b.featureCache.putFeaturesByRegion(c.result[f],e[f],c.resource,d);g=b.featureCache.getFeaturesByRegion(e[f],d);null!=g&&b.onGetData.notify({data:g,params:b.params,cached:!1})}});c=[];j=e=!0;if(0<g.length){for(d=0;d<g.length;d++){if(e)var k=parseInt(g[d]*this.featureCache.chunkSize),e=!1;if(j)var l=parseInt(g[d]*this.featureCache.chunkSize+this.featureCache.chunkSize-1),j=!1;null!=g[d+1]?g[d]+1!=g[d+1]&&(e=a.chromosome+":"+k+"-"+l,c.push(e),e=!0):(e=a.chromosome+":"+k+"-"+l,c.push(e),e=!0);
j=!0}console.time("cellbase");f.get(this.category,this.subCategory,c,this.resource,this.params)}};VCFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;VCFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;VCFFileWidget.prototype.draw=FileWidget.prototype.draw;VCFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;VCFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;
function VCFFileWidget(a){null==a&&(a={});a.title="VCF";a.tags=["vcf"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget;this.chartWidgetQuality=new ChartWidget({height:300})}VCFFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"]),this.chartWidgetQuality.getChart(["features","quality"])]};
VCFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new VCFDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){b.btnOk.enable()})};VCFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new VCFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this.btnOk.enable()};GFFFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;
GFFFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;GFFFileWidget.prototype.draw=FileWidget.prototype.draw;GFFFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;GFFFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;function GFFFileWidget(a){null==a&&(a={});a.title="GFF";a.tags=["gff"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget;this.chartWidgetQuality=new ChartWidget({height:300})}
GFFFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};GFFFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new GFFDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){b.btnOk.enable()})};
GFFFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new GFFDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this.btnOk.enable()};BEDFileWidget.prototype.getTitleName=FileWidget.prototype.getTitleName;BEDFileWidget.prototype.getFileUpload=FileWidget.prototype.getFileUpload;BEDFileWidget.prototype.draw=FileWidget.prototype.draw;BEDFileWidget.prototype.sessionInitiated=FileWidget.prototype.sessionInitiated;
BEDFileWidget.prototype.sessionFinished=FileWidget.prototype.sessionFinished;function BEDFileWidget(a){null==a&&(a={});a.title="BED";a.tags=["bed"];FileWidget.prototype.constructor.call(this,a);this.chartWidgetByChromosome=new ChartWidget;this.chartWidgetQuality=new ChartWidget({height:300})}BEDFileWidget.prototype.getChartItems=function(){return[this.chartWidgetByChromosome.getChart(["features","chromosome"])]};
BEDFileWidget.prototype.loadFileFromLocal=function(a){var b=this;this.file=a;this.adapter=new BEDDataAdapter(new FileDataSource(a),{species:this.viewer.species});this.adapter.onLoad.addEventListener(function(){b.btnOk.enable()})};BEDFileWidget.prototype.loadFileFromServer=function(a){this.file={name:a.filename};this.adapter=new BEDDataAdapter(new StringDataSource(a.data),{async:!1,species:this.viewer.species});this.btnOk.enable()};
