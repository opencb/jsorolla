<dom-module id="jso-variant-phenotype-grid">
    <style>
        :host {
            display: block;
            position: relative;
            width: 100%;
        }

        jso-table {
            box-shadow: 0px 0px 2px 0px rgba(0, 0, 0, 0.2);
        }

        label.jso {
            display: block;
            margin-left: 10px;
            font-size: 15px;
        }
    </style>
    <template>
        <label class="jso">Cosmic:</label>
        <jso-table id="cosmicTable" hidden$="{{isCosmicEmpty}}"></jso-table>
        <div hidden$="{{!isCosmicEmpty}}" style="padding:20px 50px;">
            Not found.
        </div>
        <br>
        <label class="jso">GWAS:</label>
        <jso-table id="gwasTable" hidden$="{{isGwasEmpty}}"></jso-table>
        <div hidden$="{{!isGwasEmpty}}" style="padding:20px 50px;">
            Not found.
        </div>
        <br>
        <label class="jso">Clinvar:</label>
        <jso-table id="clinvarTable" hidden$="{{isClinvarEmpty}}"></jso-table>
        <div hidden$="{{!isClinvarEmpty}}" style="padding:20px 50px;">
            Not found.
        </div>
    </template>
</dom-module>
<script>
    Polymer({
        is: 'jso-variant-phenotype-grid',
        properties: {
            row: {
                type: Object,
                observer: 'rowChanged'
            },
            isCosmicEmpty: {
                value: false,
                type: Boolean
            },
            isGwasEmpty: {
                value: false,
                type: Boolean
            },
            isClinvarEmpty: {
                value: false,
                type: Boolean
            }
        },
        ready: function () {
            this.$.cosmicTable.columns = this._cosmicColumns;
            this.$.gwasTable.columns = this._gwasColumns;
            this.$.clinvarTable.columns = this._clinvarColumns;
        },
        _cosmicColumns: [
            {
                name: "geneName",
                title: "Gene name"
            },
            {
                name: "histologySubtype",
                title: "Histology subtype"
            },
            {
                name: "mutationID",
                title: "Mutation ID"
            },
            {
                name: "mutationSomaticStatus",
                title: "Muutation somatic status"
            },
            {
                name: "primaryHistology",
                title: "Primary histology"
            },
            {
                name: "primarySite",
                title: "Primary site"
            },
            {
                name: "sampleSource",
                title: "Sample source"
            },
            {
                name: "siteSubtype",
                title: "Site subtype"
            },
            {
                name: "tumourOrigin",
                title: "Tumour origin"
            }
        ],
        _gwasColumns: [
            {
                name: "reportedGenes",
                title: "R eported genes"
            },
            {
                name: "riskAlleleFrequency",
                title: "Risk allele frequency",
            },
            {
                name: "snpIdCurrent",
                title: "snp ID current"
            },
            {
                name: "traits",
                title: "Traits",
//                formula: function (row) {
//                    return row.traits.join(', ');
//                }
            }
        ],
        _clinvarColumns: [
            {
                name: "acc",
                title: "Accession"
            },
            {
                name: "clinicalSignificance",
                title: "Clinical significance"
            },
            {
                name: "geneName",
                title: "Gene name",
//                formula: function (row) {
//                    return row.geneName.join(', ');
//                }
            },
            {
                name: "reviewStatus",
                title: "Review status"
            },
            {
                name: "traits",
                title: "Traits",
//                formula: function (row) {
//                    return row.traits.join(', ');
//                }
            }
        ],
        rowChanged: function (neo, old) {
            var me = this;

            this.$.cosmicTable.currentPage = 1;
            this.$.gwasTable.currentPage = 1;
            this.$.clinvarTable.currentPage = 1;

            if (neo) {
                var variant = neo.chromosome + ":" + neo.start + ":" + neo.reference + ":" + neo.alternate;
                CellBaseManager.get({
//                    host: 'http://wwwdev.ebi.ac.uk/cellbase/webservices/rest',
                    version: 'v3',
                    species: 'hsapiens',
                    category: 'genomic',
                    subCategory: 'variant',
                    resource: 'full_annotation',
                    query: variant,
//                    query: '19:45411941:T:C',
                    async: false,
                    success: function (response) {
                        try {
                            var dataCosmic = [];
                            var dataGwas = [];
                            var dataClinvar = [];

                            var clinicalData = response.response[0].result[0].clinicalData;
                            console.log(clinicalData)

                            if (clinicalData.Cosmic != null) {
                                for (var i = 0; i < clinicalData.Cosmic.length; i++) {
                                    var cosmic = clinicalData.Cosmic[i];
                                    dataCosmic.push(cosmic);
                                }
                            }
                            if (clinicalData.Gwas != null) {
                                for (var i = 0; i < clinicalData.Gwas.length; i++) {
                                    var gwas = clinicalData.Gwas[i];
                                    dataGwas.push(gwas);
                                }
                            }
                            if (clinicalData.Clinvar != null) {
                                for (var i = 0; i < clinicalData.Clinvar.length; i++) {
                                    var clinvar = clinicalData.Clinvar[i];
                                    dataClinvar.push(clinvar);
                                }
                            }
                            me.$.cosmicTable.data = dataCosmic;
                            me.$.gwasTable.data = dataGwas;
                            me.$.clinvarTable.data = dataClinvar;

                            me.isCosmicEmpty = (me.$.cosmicTable.data.length > 0) ? false : true;
                            me.isGwasEmpty = (me.$.gwasTable.data.length > 0) ? false : true;
                            me.isClinvarEmpty = (me.$.clinvarTable.data.length > 0) ? false : true;

                        } catch (e) {
                            console.log(e);
                            me.$.cosmicTable.data = [];
                            me.$.gwasTable.data = [];
                            me.$.clinvarTable.data = [];

                            me.isCosmicEmpty = true;
                            me.isGwasEmpty = true;
                            me.isClinvarEmpty = true;
                        }
                    }
                });
            }
        }
    });
</script>
