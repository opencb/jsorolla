<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel="import" href="variant-browser-grid.html">
<link rel="import" href="variant-active-filters.html">
<link rel="import" href="../../cellbase/variation/cellbase-variantannotation-view.html">
<link rel="import" href="../../cellbase/genome-context.html">

<dom-module id="variant-browser-view">
    <template>
        <style is="custom-style" include="jso-styles"></style>
        <style>
            .variant-tab-title {
                font-size: 115%;
                font-weight: bold;
            }
        </style>

        <div>
            <br>
            <variant-active-filters opencga-client="{{opencgaClient}}" query="{{query}}" filters="{{config.filters}}" search="{{search}}"></variant-active-filters>
            <!--<h3 style="margin-bottom: 2px">Results</h3>-->
            <!--<template is="dom-if" if="{{study.name != ''}}">-->
            <!--<h2>{{title}}</h2>-->
            <!--</template>-->

            <!-- Variant Browser Grid -->
            <variant-browser-grid study="{{study}}" project="{{project}}" prefix="{{prefix}}" opencga-client="{{opencgaClient}}" cellbase-client="{{cellbaseClient}}"
                                  population-frequencies="{{populationFrequencies}}" protein-substitution-scores="{{proteinSubstitutionScores}}"
                                  consequence-types="{{consequenceTypes}}" query="[[query]]" search="[[search]]" variant="{{variant}}" on-selected="selectedGene" style="font-size: 12px">
            </variant-browser-grid>

            <!-- Bottom tabs withspecific variant information -->
            <h3>Variant: {{variant}}</h3>
            <div style="padding-top: 20px">
                <ul id="{{prefix}}ViewTabs" class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#{{prefix}}Annotation" role="tab" data-toggle="tab" class="variant-tab-title">Advanced Annotation</a></li>
                    <li role="presentation"><a href="#{{prefix}}GenomeView" role="tab" data-toggle="tab" class="variant-tab-title">Genome Context</a></li>
                    <li role="presentation"><a href="#{{prefix}}Genotype" role="tab" data-toggle="tab" class="variant-tab-title">Genotypes & Files</a></li>
                </ul>

                <div class="tab-content" style="height: 680px">

                    <!--Annotation Tab-->
                    <div role="tabpanel" class="tab-pane active" id="{{prefix}}Annotation">
                        <cellbase-variantannotation-view data="{{variant}}" prefix="{{prefix}}" cellbase-client="{{cellbaseClient}}" mode="vertical" style="font-size: 12px"></cellbase-variantannotation-view>
                    </div>

                    <!--Genome Context Tab-->
                    <div role="tabpanel" class="tab-pane" id="{{prefix}}GenomeView">
                        <br>
                        <genome-context></genome-context>
                    </div>

                    <!--Genotypes & Files Tab-->
                    <div role="tabpanel" class="tab-pane" id="{{prefix}}Genotype">
                        Not implemented yet!
                    </div>
                </div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'variant-browser-view',
            properties: {
                title: {
                    type: String
                },
                project: {
                    type: String
                },
                study: {
                    type: Object
                },
                data: {
                    type: Array,
                    value: []
                },
                opencgaClient: {
                    type: Object
                },
                cellbaseClient: {
                    type: Object
                },
                populationFrequencies: {
                    type: Object
                },
                proteinSubstitutionScores: {
                    type: Object
                },
                query: {
                    type: Object,
                    notify: true
                },
//                _filters: {
//                    type: Object,
//                    notify: true
//                },
                search: {
                    type: Object
                },
                variant: {
                    type: String,
                    value: "No variant selected"
                },
                prefix: {
                    type: String
                },
                config: {
                    type: Object
                },
            },
            ready: function () {
                if (typeof this.prefix === "undefined" || this.prefix == "") {
                    this.prefix = "view" + Utils.randomString(6);
                }
            },
            selectedGene: function (e) {
                this.fire('propagate', {gene: e.detail.gene});
            }
        });
    </script>
</dom-module>
