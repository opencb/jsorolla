<!--
  ~ Copyright 2015 OpenCB
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<link rel="import" href="variant-browser-grid.html">
<link rel="import" href="../../cellbase/variation/cellbase-variantannotation-view.html">
<link rel="import" href="../../cellbase/genome-context.html">

<dom-module id="variant-prioritization-view">
    <template>
        <style is="custom-style" include="jso-styles"></style>
        <style>
            .nav-pills > .highlight {
                background: whitesmoke;
            }

            .variant-menu-link:hover {
                cursor: pointer;
                background-color: #EEEEEE;
                text-decoration: none;
            }

            .variant-tab-title {
                font-size: 115%;
                font-weight: bold;
            }
        </style>

        <div>
            <h4>Results</h4>
            <!--<template is="dom-if" if="{{study.name != ''}}">-->
            <!--<h2>{{title}}</h2>-->
            <!--</template>-->

            <div style="float: left" aria-label="...">
                <!--<span>-->
                <!--&lt;!&ndash;<i class="fa fa-area-chart"></i>&ndash;&gt;-->
                <!--<i class="fa fa-credit-card"></i>-->
                <!--<a id="{{prefix}}GenomeContext" class="variant-menu-link" on-click="_triggerChange">GENOME CONTEXT</a>-->
                <!--</span>-->
                <!--<span>&nbsp;</span>-->
                <!--<span>-->
                <!--<i class="fa fa-search-plus"></i>-->
                <!--<a id="{{prefix}}Annotation" class="variant-menu-link" on-click="_triggerChange">ADVANCED ANNOTATION</a>-->
                <!--</span>-->
                <!--<span>&nbsp;</span>-->
                <span>
                    <i class="fa fa-file-text-o"></i>
                    <a id="{{prefix}}Files" class="variant-menu-link" on-click="_triggerChange">FILE INFO</a>
                </span>
                <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                <span>
                    <i class="fa fa-user-md"></i>
                    <a id="{{prefix}}Family" class="variant-menu-link" on-click="_triggerChange">FAMILY DATA</a>
                </span>
                <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                <span>
                    <i class="fa fa-save"></i>
                    <a id="{{prefix}}Save" class="variant-menu-link" on-click="_triggerChange">SAVE</a>
                </span>
            </div>



            <template is="dom-if" if="{{!resultsViewActive}}">
                <br>
                <div class="btn-group" role="group" aria-label="...">
                    <button id="{{prefix}}Results" type="button" class="btn btn-primary" on-click="_triggerChange">Back to Results</button>
                </div>
            </template>

            <!--Files Tab-->
            <div class$="{{prefix}}Content" id="{{prefix}}FilesDiv" style="display: none">
                <br>
                Files
            </div>

            <!--Sample comparator-->
            <div class$="{{prefix}}Content" id="{{prefix}}SampleComparatorDiv" style="display: none">
                <br>
                Sample Comparator
            </div>



            <!-- Variant Browser Grid -->
            <template is="dom-if" if="{{resultsViewActive}}">
                <variant-browser-grid mode="{{mode}}" study="{{study}}" project="{{project}}" prefix="{{prefix}}" opencga-client="{{opencgaClient}}"
                                      cellbase-client="{{cellbaseClient}}" population-frequencies="{{populationFrequencies}}"
                                      samples="{{samples}}" protein-substitution-scores="{{proteinSubstitutionScores}}"
                                      query="{{query}}" variant="{{variant}}" on-selected="selectedGene">
                </variant-browser-grid>
            </template>

            <!-- Bottom tabs withspecific variant information -->
            <template is="dom-if" if="{{resultsViewActive}}">
                <h3>Variant: {{variant}}</h3>
                <div style="padding-top: 20px">
                    <ul id="{{prefix}}ViewTabs" class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#{{prefix}}GenomeView" role="tab" data-toggle="tab" class="variant-tab-title">Genome Context</a></li>
                        <li role="presentation"><a href="#{{prefix}}Annotation" role="tab" data-toggle="tab" class="variant-tab-title">Advanced Annotation</a></li>
                        <li role="presentation"><a href="#{{prefix}}Genotype" role="tab" data-toggle="tab" class="variant-tab-title">Genotypes & Files</a></li>
                    </ul>

                    <div class="tab-content" style="height: 680px">
                        <!--Genome Context Tab-->
                        <div role="tabpanel" class="tab-pane active" id="{{prefix}}GenomeView">
                            <br>
                            <!--<genome-context></genome-context>-->
                        </div>

                        <!--Annotation Tab-->
                        <div role="tabpanel" class="tab-pane" id="{{prefix}}Annotation">
                            <cellbase-variantannotation-view data="{{variant}}" prefix="{{prefix}}" cellbase-client="{{cellbaseClient}}" mode="vertical"></cellbase-variantannotation-view>
                        </div>

                        <!--Genotypes & Files Tab-->
                        <div role="tabpanel" class="tab-pane" id="{{prefix}}Genotype">
                            Genotypes and files
                        </div>
                    </div>
                </div>
            </template>
        </div>

    </template>
    <script>
        Polymer({
            is: 'variant-prioritization-view',
            properties: {
                mode: {
                    type: String
                },
                title: {
                    type: String
                },
                project: {
                    type: String
                },
                study: {
                    type: Object
                },
                data: {
                    type: Array,
                    value: []
                },
                opencgaClient: {
                    type: Object
                },
                samples: {
                    type: Array
                },
                cellbaseClient: {
                    type: Object
                },
                populationFrequencies: {
                    type: Object
                },
                proteinSubstitutionScores: {
                    type: Object
                },
                query: {
                    type: Object
                },
                prefix: {
                    type: String
                },
                variant: {
                    type: String,
                    value: "No variant selected"
                }
//                variantList: {
//                    type: Array,
//                    value: [],
//                    notify: true
//                },
//                changeToDefault: {
//                    type: String,
//                    notify: true
//                },
//                changeVariantTab: {
//                    type: String,
//                    notify: true
//                }
            },
            ready: function () {

                // To allow more than 'prioritization instance in the same web application we add a prefix to all elements ID
                if (typeof this.prefix === "undefined" || this.prefix == "") {
                    this.prefix = Utils.randomString(6);
                }

                this.resultsViewActive = true;

            },
            _triggerChange: function (e) {
                e.preventDefault(); // prevents the hash change to "#" and allows to manipulate the hash fragment as needed
                $('.' + this.prefix + 'Content').hide(); // hides all content divs
                if (typeof e.srcElement.id !== "undefined") {
                    $('#' + e.srcElement.id + 'Div').show(); // get the href and use it find which div to show
                }

                // Set Results view button visible or hidden
                this.resultsViewActive = (e.srcElement.id == this.prefix + "Results");

                if (e.srcElement.id == (this.prefix + "Annotation")) {
                    this.changeVariantTab = Utils.randomString(6);
                } else {
                    this.changeToDefault = Utils.randomString(6);
                }
            },
            _triggerChangeVariantTab: function (e) {
                this.changeVariantTab = Utils.randomString(6);
            },
            selectedGene: function (e) {
                this.fire('propagate', {gene: e.detail.gene});
            }
        });
    </script>
</dom-module>
